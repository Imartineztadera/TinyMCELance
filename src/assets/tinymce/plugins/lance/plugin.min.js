/*!
 * Source version: 1.8.02 
 * Copyright (C) 2024 LoopIndex - All Rights Reserved
 * You should have received a copy of the LoopIndex Comments plugin license with
 * this file. If not, please write to: loopindex@gmail.com, or visit http://www.loopindex.com
 *
 * Third party licenses:
 *
 * jQuery Library
 * Copyright OpenJS Foundation and other contributors, https://openjsf.org/
 * license: MIT (See Below)
 *
 * MIT License
 * ===========
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 * 
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.====
 *
 * written by (David *)Frenkiel (https://github.com/imdfl) 
 */!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){var o;!function(){"use strict";var e={};
/*!
 * jQuery JavaScript Library v3.5.0 -ajax,-ajax/jsonp,-ajax/load,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-deprecated/ajax-event-alias,-effects,-effects/Tween,-effects/animatedSelector
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2020-04-10T15:07Z
 */!function(t){var e=window.LOOPINDEX;e&&"object"==typeof e&&e.$&&e.VERSION||(e={},Object.defineProperties(e,{VERSION:{value:"1.6.7",enumerable:!0,writable:!1,configurable:!1}}));var n=window.LOOPINDEX=e;n.$&&n.$.fn&&n.$.fn.jquery||Object.defineProperty(e,"$",{value:t,enumerable:!0,writable:!1,configurable:!1})}(function(n){var i="3.5.0 -ajax,-ajax/jsonp,-ajax/load,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-deprecated/ajax-event-alias,-effects,-effects/Tween,-effects/animatedSelector",r=[],s=Object.getPrototypeOf,a=r.slice,l=r.flat?function(t){return r.flat.call(t)}:function(t){return r.concat.apply([],t)},c=r.push,d=r.indexOf,u={},h=u.toString,f=u.hasOwnProperty,m=f.toString,g=m.call(Object),p={},v=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},_=function(t){return null!=t&&t===t.window},y=n.document,b={type:!0,src:!0,nonce:!0,noModule:!0};function w(t,e,n){var o,i,r=(n=n||y).createElement("script");if(r.text=t,e)for(o in b)(i=e[o]||e.getAttribute&&e.getAttribute(o))&&r.setAttribute(o,i);n.head.appendChild(r).parentNode.removeChild(r)}function A(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?u[h.call(t)]||"object":typeof t}var E=function(t,e){return new E.fn.init(t,e)};function C(t){var e=!!t&&"length"in t&&t.length,n=A(t);return!v(t)&&!_(t)&&("array"===n||0===e||"number"==typeof e&&e>0&&e-1 in t)}E.fn=E.prototype={jquery:i,constructor:E,length:0,toArray:function(){return a.call(this)},get:function(t){return null==t?a.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=E.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return E.each(this,t)},map:function(t){return this.pushStack(E.map(this,(function(e,n){return t.call(e,n,e)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(E.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(E.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,n=+t+(t<0?e:0);return this.pushStack(n>=0&&n<e?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:r.sort,splice:r.splice},E.extend=E.fn.extend=function(){var t,e,n,o,i,r,s=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||v(s)||(s={}),a===l&&(s=this,a--);a<l;a++)if(null!=(t=arguments[a]))for(e in t)o=t[e],"__proto__"!==e&&s!==o&&(c&&o&&(E.isPlainObject(o)||(i=Array.isArray(o)))?(n=s[e],r=i&&!Array.isArray(n)?[]:i||E.isPlainObject(n)?n:{},i=!1,s[e]=E.extend(c,r,o)):void 0!==o&&(s[e]=o));return s},E.extend({expando:"jQuery"+(i+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,n;return!(!t||"[object Object]"!==h.call(t))&&(!(e=s(t))||"function"==typeof(n=f.call(e,"constructor")&&e.constructor)&&m.call(n)===g)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,n){w(t,{nonce:e&&e.nonce},n)},each:function(t,e){var n,o=0;if(C(t))for(n=t.length;o<n&&!1!==e.call(t[o],o,t[o]);o++);else for(o in t)if(!1===e.call(t[o],o,t[o]))break;return t},makeArray:function(t,e){var n=e||[];return null!=t&&(C(Object(t))?E.merge(n,"string"==typeof t?[t]:t):c.call(n,t)),n},inArray:function(t,e,n){return null==e?-1:d.call(e,t,n)},merge:function(t,e){for(var n=+e.length,o=0,i=t.length;o<n;o++)t[i++]=e[o];return t.length=i,t},grep:function(t,e,n){for(var o=[],i=0,r=t.length,s=!n;i<r;i++)!e(t[i],i)!==s&&o.push(t[i]);return o},map:function(t,e,n){var o,i,r=0,s=[];if(C(t))for(o=t.length;r<o;r++)null!=(i=e(t[r],r,n))&&s.push(i);else for(r in t)null!=(i=e(t[r],r,n))&&s.push(i);return l(s)},guid:1,support:p}),"function"==typeof Symbol&&(E.fn[Symbol.iterator]=r[Symbol.iterator]),E.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){u["[object "+e+"]"]=e.toLowerCase()}));var N=
/*!
		 * Sizzle CSS Selector Engine v2.3.5
		 * https://sizzlejs.com/
		 *
		 * Copyright JS Foundation and other contributors
		 * Released under the MIT license
		 * https://js.foundation/
		 *
		 * Date: 2020-03-14
		 */
function(t){var e,n,o,i,r,s,a,l,c,d,u,h,f,m,g,p,v,_,y,b="sizzle"+1*new Date,w=t.document,A=0,E=0,C=lt(),N=lt(),S=lt(),T=lt(),x=function(t,e){return t===e&&(u=!0),0},I={}.hasOwnProperty,O=[],L=O.pop,D=O.push,M=O.push,$=O.slice,R=function(t,e){for(var n=0,o=t.length;n<o;n++)if(t[n]===e)return n;return-1},k="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",U="[\\x20\\t\\r\\n\\f]",P="(?:\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",B="\\["+U+"*("+P+")(?:"+U+"*([*^$|!~]?=)"+U+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+P+"))|)"+U+"*\\]",j=":("+P+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+B+")*)|.*)\\)|)",F=new RegExp(U+"+","g"),H=new RegExp("^"+U+"+|((?:^|[^\\\\])(?:\\\\.)*)"+U+"+$","g"),V=new RegExp("^"+U+"*,"+U+"*"),z=new RegExp("^"+U+"*([>+~]|"+U+")"+U+"*"),q=new RegExp(U+"|>"),W=new RegExp(j),G=new RegExp("^"+P+"$"),X={ID:new RegExp("^#("+P+")"),CLASS:new RegExp("^\\.("+P+")"),TAG:new RegExp("^("+P+"|[*])"),ATTR:new RegExp("^"+B),PSEUDO:new RegExp("^"+j),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+U+"*(even|odd|(([+-]|)(\\d*)n|)"+U+"*(?:([+-]|)"+U+"*(\\d+)|))"+U+"*\\)|)","i"),bool:new RegExp("^(?:"+k+")$","i"),needsContext:new RegExp("^"+U+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+U+"*((?:-\\d)?\\d*)"+U+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,K=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/[+~]/,et=new RegExp("\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\([^\\r\\n\\f])","g"),nt=function(t,e){var n="0x"+t.slice(1)-65536;return e||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},ot=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,it=function(t,e){return e?"\0"===t?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},rt=function(){h()},st=bt((function(t){return!0===t.disabled&&"fieldset"===t.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{M.apply(O=$.call(w.childNodes),w.childNodes),O[w.childNodes.length].nodeType}catch(t){M={apply:O.length?function(t,e){D.apply(t,$.call(e))}:function(t,e){for(var n=t.length,o=0;t[n++]=e[o++];);t.length=n-1}}}function at(t,e,o,i){var r,a,c,d,u,m,v,_=e&&e.ownerDocument,w=e?e.nodeType:9;if(o=o||[],"string"!=typeof t||!t||1!==w&&9!==w&&11!==w)return o;if(!i&&(h(e),e=e||f,g)){if(11!==w&&(u=Z.exec(t)))if(r=u[1]){if(9===w){if(!(c=e.getElementById(r)))return o;if(c.id===r)return o.push(c),o}else if(_&&(c=_.getElementById(r))&&y(e,c)&&c.id===r)return o.push(c),o}else{if(u[2])return M.apply(o,e.getElementsByTagName(t)),o;if((r=u[3])&&n.getElementsByClassName&&e.getElementsByClassName)return M.apply(o,e.getElementsByClassName(r)),o}if(n.qsa&&!T[t+" "]&&(!p||!p.test(t))&&(1!==w||"object"!==e.nodeName.toLowerCase())){if(v=t,_=e,1===w&&(q.test(t)||z.test(t))){for((_=tt.test(t)&&vt(e.parentNode)||e)===e&&n.scope||((d=e.getAttribute("id"))?d=d.replace(ot,it):e.setAttribute("id",d=b)),a=(m=s(t)).length;a--;)m[a]=(d?"#"+d:":scope")+" "+yt(m[a]);v=m.join(",")}try{return M.apply(o,_.querySelectorAll(v)),o}catch(e){T(t,!0)}finally{d===b&&e.removeAttribute("id")}}}return l(t.replace(H,"$1"),e,o,i)}function lt(){var t=[];return function e(n,i){return t.push(n+" ")>o.cacheLength&&delete e[t.shift()],e[n+" "]=i}}function ct(t){return t[b]=!0,t}function dt(t){var e=f.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ut(t,e){for(var n=t.split("|"),i=n.length;i--;)o.attrHandle[n[i]]=e}function ht(t,e){var n=e&&t,o=n&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(o)return o;if(n)for(;n=n.nextSibling;)if(n===e)return-1;return t?1:-1}function ft(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function mt(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}function gt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&st(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function pt(t){return ct((function(e){return e=+e,ct((function(n,o){for(var i,r=t([],n.length,e),s=r.length;s--;)n[i=r[s]]&&(n[i]=!(o[i]=n[i]))}))}))}function vt(t){return t&&void 0!==t.getElementsByTagName&&t}for(e in n=at.support={},r=at.isXML=function(t){var e=t.namespaceURI,n=(t.ownerDocument||t).documentElement;return!Y.test(e||n&&n.nodeName||"HTML")},h=at.setDocument=function(t){var e,i,s=t?t.ownerDocument||t:w;return s!=f&&9===s.nodeType&&s.documentElement?(m=(f=s).documentElement,g=!r(f),w!=f&&(i=f.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",rt,!1):i.attachEvent&&i.attachEvent("onunload",rt)),n.scope=dt((function(t){return m.appendChild(t).appendChild(f.createElement("div")),void 0!==t.querySelectorAll&&!t.querySelectorAll(":scope fieldset div").length})),n.attributes=dt((function(t){return t.className="i",!t.getAttribute("className")})),n.getElementsByTagName=dt((function(t){return t.appendChild(f.createComment("")),!t.getElementsByTagName("*").length})),n.getElementsByClassName=J.test(f.getElementsByClassName),n.getById=dt((function(t){return m.appendChild(t).id=b,!f.getElementsByName||!f.getElementsByName(b).length})),n.getById?(o.filter.ID=function(t){var e=t.replace(et,nt);return function(t){return t.getAttribute("id")===e}},o.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var n=e.getElementById(t);return n?[n]:[]}}):(o.filter.ID=function(t){var e=t.replace(et,nt);return function(t){var n=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return n&&n.value===e}},o.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var n,o,i,r=e.getElementById(t);if(r){if((n=r.getAttributeNode("id"))&&n.value===t)return[r];for(i=e.getElementsByName(t),o=0;r=i[o++];)if((n=r.getAttributeNode("id"))&&n.value===t)return[r]}return[]}}),o.find.TAG=n.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):n.qsa?e.querySelectorAll(t):void 0}:function(t,e){var n,o=[],i=0,r=e.getElementsByTagName(t);if("*"===t){for(;n=r[i++];)1===n.nodeType&&o.push(n);return o}return r},o.find.CLASS=n.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&g)return e.getElementsByClassName(t)},v=[],p=[],(n.qsa=J.test(f.querySelectorAll))&&(dt((function(t){var e;m.appendChild(t).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&p.push("[*^$]="+U+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||p.push("\\["+U+"*(?:value|"+k+")"),t.querySelectorAll("[id~="+b+"-]").length||p.push("~="),(e=f.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||p.push("\\["+U+"*name"+U+"*="+U+"*(?:''|\"\")"),t.querySelectorAll(":checked").length||p.push(":checked"),t.querySelectorAll("a#"+b+"+*").length||p.push(".#.+[+~]"),t.querySelectorAll("\\\f"),p.push("[\\r\\n\\f]")})),dt((function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=f.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&p.push("name"+U+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&p.push(":enabled",":disabled"),m.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&p.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),p.push(",.*:")}))),(n.matchesSelector=J.test(_=m.matches||m.webkitMatchesSelector||m.mozMatchesSelector||m.oMatchesSelector||m.msMatchesSelector))&&dt((function(t){n.disconnectedMatch=_.call(t,"*"),_.call(t,"[s!='']:x"),v.push("!=",j)})),p=p.length&&new RegExp(p.join("|")),v=v.length&&new RegExp(v.join("|")),e=J.test(m.compareDocumentPosition),y=e||J.test(m.contains)?function(t,e){var n=9===t.nodeType?t.documentElement:t,o=e&&e.parentNode;return t===o||!(!o||1!==o.nodeType||!(n.contains?n.contains(o):t.compareDocumentPosition&&16&t.compareDocumentPosition(o)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},x=e?function(t,e){if(t===e)return u=!0,0;var o=!t.compareDocumentPosition-!e.compareDocumentPosition;return o||(1&(o=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!n.sortDetached&&e.compareDocumentPosition(t)===o?t==f||t.ownerDocument==w&&y(w,t)?-1:e==f||e.ownerDocument==w&&y(w,e)?1:d?R(d,t)-R(d,e):0:4&o?-1:1)}:function(t,e){if(t===e)return u=!0,0;var n,o=0,i=t.parentNode,r=e.parentNode,s=[t],a=[e];if(!i||!r)return t==f?-1:e==f?1:i?-1:r?1:d?R(d,t)-R(d,e):0;if(i===r)return ht(t,e);for(n=t;n=n.parentNode;)s.unshift(n);for(n=e;n=n.parentNode;)a.unshift(n);for(;s[o]===a[o];)o++;return o?ht(s[o],a[o]):s[o]==w?-1:a[o]==w?1:0},f):f},at.matches=function(t,e){return at(t,null,null,e)},at.matchesSelector=function(t,e){if(h(t),n.matchesSelector&&g&&!T[e+" "]&&(!v||!v.test(e))&&(!p||!p.test(e)))try{var o=_.call(t,e);if(o||n.disconnectedMatch||t.document&&11!==t.document.nodeType)return o}catch(t){T(e,!0)}return at(e,f,null,[t]).length>0},at.contains=function(t,e){return(t.ownerDocument||t)!=f&&h(t),y(t,e)},at.attr=function(t,e){(t.ownerDocument||t)!=f&&h(t);var i=o.attrHandle[e.toLowerCase()],r=i&&I.call(o.attrHandle,e.toLowerCase())?i(t,e,!g):void 0;return void 0!==r?r:n.attributes||!g?t.getAttribute(e):(r=t.getAttributeNode(e))&&r.specified?r.value:null},at.escape=function(t){return(t+"").replace(ot,it)},at.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},at.uniqueSort=function(t){var e,o=[],i=0,r=0;if(u=!n.detectDuplicates,d=!n.sortStable&&t.slice(0),t.sort(x),u){for(;e=t[r++];)e===t[r]&&(i=o.push(r));for(;i--;)t.splice(o[i],1)}return d=null,t},i=at.getText=function(t){var e,n="",o=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=i(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[o++];)n+=i(e);return n},(o=at.selectors={cacheLength:50,createPseudo:ct,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(et,nt),t[3]=(t[3]||t[4]||t[5]||"").replace(et,nt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||at.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&at.error(t[0]),t},PSEUDO:function(t){var e,n=!t[6]&&t[2];return X.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":n&&W.test(n)&&(e=s(n,!0))&&(e=n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(et,nt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=C[t+" "];return e||(e=new RegExp("(^|"+U+")"+t+"("+U+"|$)"))&&C(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,n){return function(o){var i=at.attr(o,t);return null==i?"!="===e:!e||(i+="","="===e?i===n:"!="===e?i!==n:"^="===e?n&&0===i.indexOf(n):"*="===e?n&&i.indexOf(n)>-1:"$="===e?n&&i.slice(-n.length)===n:"~="===e?(" "+i.replace(F," ")+" ").indexOf(n)>-1:"|="===e&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,n,o,i){var r="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===o&&0===i?function(t){return!!t.parentNode}:function(e,n,l){var c,d,u,h,f,m,g=r!==s?"nextSibling":"previousSibling",p=e.parentNode,v=a&&e.nodeName.toLowerCase(),_=!l&&!a,y=!1;if(p){if(r){for(;g;){for(h=e;h=h[g];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;m=g="only"===t&&!m&&"nextSibling"}return!0}if(m=[s?p.firstChild:p.lastChild],s&&_){for(y=(f=(c=(d=(u=(h=p)[b]||(h[b]={}))[h.uniqueID]||(u[h.uniqueID]={}))[t]||[])[0]===A&&c[1])&&c[2],h=f&&p.childNodes[f];h=++f&&h&&h[g]||(y=f=0)||m.pop();)if(1===h.nodeType&&++y&&h===e){d[t]=[A,f,y];break}}else if(_&&(y=f=(c=(d=(u=(h=e)[b]||(h[b]={}))[h.uniqueID]||(u[h.uniqueID]={}))[t]||[])[0]===A&&c[1]),!1===y)for(;(h=++f&&h&&h[g]||(y=f=0)||m.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++y||(_&&((d=(u=h[b]||(h[b]={}))[h.uniqueID]||(u[h.uniqueID]={}))[t]=[A,y]),h!==e)););return(y-=i)===o||y%o==0&&y/o>=0}}},PSEUDO:function(t,e){var n,i=o.pseudos[t]||o.setFilters[t.toLowerCase()]||at.error("unsupported pseudo: "+t);return i[b]?i(e):i.length>1?(n=[t,t,"",e],o.setFilters.hasOwnProperty(t.toLowerCase())?ct((function(t,n){for(var o,r=i(t,e),s=r.length;s--;)t[o=R(t,r[s])]=!(n[o]=r[s])})):function(t){return i(t,0,n)}):i}},pseudos:{not:ct((function(t){var e=[],n=[],o=a(t.replace(H,"$1"));return o[b]?ct((function(t,e,n,i){for(var r,s=o(t,null,i,[]),a=t.length;a--;)(r=s[a])&&(t[a]=!(e[a]=r))})):function(t,i,r){return e[0]=t,o(e,null,r,n),e[0]=null,!n.pop()}})),has:ct((function(t){return function(e){return at(t,e).length>0}})),contains:ct((function(t){return t=t.replace(et,nt),function(e){return(e.textContent||i(e)).indexOf(t)>-1}})),lang:ct((function(t){return G.test(t||"")||at.error("unsupported lang: "+t),t=t.replace(et,nt).toLowerCase(),function(e){var n;do{if(n=g?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(n=n.toLowerCase())===t||0===n.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var n=t.location&&t.location.hash;return n&&n.slice(1)===e.id},root:function(t){return t===m},focus:function(t){return t===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:gt(!1),disabled:gt(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!o.pseudos.empty(t)},header:function(t){return Q.test(t.nodeName)},input:function(t){return K.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:pt((function(){return[0]})),last:pt((function(t,e){return[e-1]})),eq:pt((function(t,e,n){return[n<0?n+e:n]})),even:pt((function(t,e){for(var n=0;n<e;n+=2)t.push(n);return t})),odd:pt((function(t,e){for(var n=1;n<e;n+=2)t.push(n);return t})),lt:pt((function(t,e,n){for(var o=n<0?n+e:n>e?e:n;--o>=0;)t.push(o);return t})),gt:pt((function(t,e,n){for(var o=n<0?n+e:n;++o<e;)t.push(o);return t}))}}).pseudos.nth=o.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[e]=ft(e);for(e in{submit:!0,reset:!0})o.pseudos[e]=mt(e);function _t(){}function yt(t){for(var e=0,n=t.length,o="";e<n;e++)o+=t[e].value;return o}function bt(t,e,n){var o=e.dir,i=e.next,r=i||o,s=n&&"parentNode"===r,a=E++;return e.first?function(e,n,i){for(;e=e[o];)if(1===e.nodeType||s)return t(e,n,i);return!1}:function(e,n,l){var c,d,u,h=[A,a];if(l){for(;e=e[o];)if((1===e.nodeType||s)&&t(e,n,l))return!0}else for(;e=e[o];)if(1===e.nodeType||s)if(d=(u=e[b]||(e[b]={}))[e.uniqueID]||(u[e.uniqueID]={}),i&&i===e.nodeName.toLowerCase())e=e[o]||e;else{if((c=d[r])&&c[0]===A&&c[1]===a)return h[2]=c[2];if(d[r]=h,h[2]=t(e,n,l))return!0}return!1}}function wt(t){return t.length>1?function(e,n,o){for(var i=t.length;i--;)if(!t[i](e,n,o))return!1;return!0}:t[0]}function At(t,e,n,o,i){for(var r,s=[],a=0,l=t.length,c=null!=e;a<l;a++)(r=t[a])&&(n&&!n(r,o,i)||(s.push(r),c&&e.push(a)));return s}function Et(t,e,n,o,i,r){return o&&!o[b]&&(o=Et(o)),i&&!i[b]&&(i=Et(i,r)),ct((function(r,s,a,l){var c,d,u,h=[],f=[],m=s.length,g=r||function(t,e,n){for(var o=0,i=e.length;o<i;o++)at(t,e[o],n);return n}(e||"*",a.nodeType?[a]:a,[]),p=!t||!r&&e?g:At(g,h,t,a,l),v=n?i||(r?t:m||o)?[]:s:p;if(n&&n(p,v,a,l),o)for(c=At(v,f),o(c,[],a,l),d=c.length;d--;)(u=c[d])&&(v[f[d]]=!(p[f[d]]=u));if(r){if(i||t){if(i){for(c=[],d=v.length;d--;)(u=v[d])&&c.push(p[d]=u);i(null,v=[],c,l)}for(d=v.length;d--;)(u=v[d])&&(c=i?R(r,u):h[d])>-1&&(r[c]=!(s[c]=u))}}else v=At(v===s?v.splice(m,v.length):v),i?i(null,s,v,l):M.apply(s,v)}))}function Ct(t){for(var e,n,i,r=t.length,s=o.relative[t[0].type],a=s||o.relative[" "],l=s?1:0,d=bt((function(t){return t===e}),a,!0),u=bt((function(t){return R(e,t)>-1}),a,!0),h=[function(t,n,o){var i=!s&&(o||n!==c)||((e=n).nodeType?d(t,n,o):u(t,n,o));return e=null,i}];l<r;l++)if(n=o.relative[t[l].type])h=[bt(wt(h),n)];else{if((n=o.filter[t[l].type].apply(null,t[l].matches))[b]){for(i=++l;i<r&&!o.relative[t[i].type];i++);return Et(l>1&&wt(h),l>1&&yt(t.slice(0,l-1).concat({value:" "===t[l-2].type?"*":""})).replace(H,"$1"),n,l<i&&Ct(t.slice(l,i)),i<r&&Ct(t=t.slice(i)),i<r&&yt(t))}h.push(n)}return wt(h)}return _t.prototype=o.filters=o.pseudos,o.setFilters=new _t,s=at.tokenize=function(t,e){var n,i,r,s,a,l,c,d=N[t+" "];if(d)return e?0:d.slice(0);for(a=t,l=[],c=o.preFilter;a;){for(s in n&&!(i=V.exec(a))||(i&&(a=a.slice(i[0].length)||a),l.push(r=[])),n=!1,(i=z.exec(a))&&(n=i.shift(),r.push({value:n,type:i[0].replace(H," ")}),a=a.slice(n.length)),o.filter)!(i=X[s].exec(a))||c[s]&&!(i=c[s](i))||(n=i.shift(),r.push({value:n,type:s,matches:i}),a=a.slice(n.length));if(!n)break}return e?a.length:a?at.error(t):N(t,l).slice(0)},a=at.compile=function(t,e){var n,i=[],r=[],a=S[t+" "];if(!a){for(e||(e=s(t)),n=e.length;n--;)(a=Ct(e[n]))[b]?i.push(a):r.push(a);(a=S(t,function(t,e){var n=e.length>0,i=t.length>0,r=function(r,s,a,l,d){var u,m,p,v=0,_="0",y=r&&[],b=[],w=c,E=r||i&&o.find.TAG("*",d),C=A+=null==w?1:Math.random()||.1,N=E.length;for(d&&(c=s==f||s||d);_!==N&&null!=(u=E[_]);_++){if(i&&u){for(m=0,s||u.ownerDocument==f||(h(u),a=!g);p=t[m++];)if(p(u,s||f,a)){l.push(u);break}d&&(A=C)}n&&((u=!p&&u)&&v--,r&&y.push(u))}if(v+=_,n&&_!==v){for(m=0;p=e[m++];)p(y,b,s,a);if(r){if(v>0)for(;_--;)y[_]||b[_]||(b[_]=L.call(l));b=At(b)}M.apply(l,b),d&&!r&&b.length>0&&v+e.length>1&&at.uniqueSort(l)}return d&&(A=C,c=w),y};return n?ct(r):r}(r,i))).selector=t}return a},l=at.select=function(t,e,n,i){var r,l,c,d,u,h="function"==typeof t&&t,f=!i&&s(t=h.selector||t);if(n=n||[],1===f.length){if((l=f[0]=f[0].slice(0)).length>2&&"ID"===(c=l[0]).type&&9===e.nodeType&&g&&o.relative[l[1].type]){if(!(e=(o.find.ID(c.matches[0].replace(et,nt),e)||[])[0]))return n;h&&(e=e.parentNode),t=t.slice(l.shift().value.length)}for(r=X.needsContext.test(t)?0:l.length;r--&&(c=l[r],!o.relative[d=c.type]);)if((u=o.find[d])&&(i=u(c.matches[0].replace(et,nt),tt.test(l[0].type)&&vt(e.parentNode)||e))){if(l.splice(r,1),!(t=i.length&&yt(l)))return M.apply(n,i),n;break}}return(h||a(t,f))(i,e,!g,n,!e||tt.test(t)&&vt(e.parentNode)||e),n},n.sortStable=b.split("").sort(x).join("")===b,n.detectDuplicates=!!u,h(),n.sortDetached=dt((function(t){return 1&t.compareDocumentPosition(f.createElement("fieldset"))})),dt((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||ut("type|href|height|width",(function(t,e,n){if(!n)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),n.attributes&&dt((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||ut("value",(function(t,e,n){if(!n&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),dt((function(t){return null==t.getAttribute("disabled")}))||ut(k,(function(t,e,n){var o;if(!n)return!0===t[e]?e.toLowerCase():(o=t.getAttributeNode(e))&&o.specified?o.value:null})),at}(n);E.find=N,E.expr=N.selectors,E.expr[":"]=E.expr.pseudos,E.uniqueSort=E.unique=N.uniqueSort,E.text=N.getText,E.isXMLDoc=N.isXML,E.contains=N.contains,E.escapeSelector=N.escape;var S=function(t,e,n){for(var o=[],i=void 0!==n;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(i&&E(t).is(n))break;o.push(t)}return o},T=function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n},x=E.expr.match.needsContext;function I(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}var O=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function L(t,e,n){return v(e)?E.grep(t,(function(t,o){return!!e.call(t,o,t)!==n})):e.nodeType?E.grep(t,(function(t){return t===e!==n})):"string"!=typeof e?E.grep(t,(function(t){return d.call(e,t)>-1!==n})):E.filter(e,t,n)}E.filter=function(t,e,n){var o=e[0];return n&&(t=":not("+t+")"),1===e.length&&1===o.nodeType?E.find.matchesSelector(o,t)?[o]:[]:E.find.matches(t,E.grep(e,(function(t){return 1===t.nodeType})))},E.fn.extend({find:function(t){var e,n,o=this.length,i=this;if("string"!=typeof t)return this.pushStack(E(t).filter((function(){for(e=0;e<o;e++)if(E.contains(i[e],this))return!0})));for(n=this.pushStack([]),e=0;e<o;e++)E.find(t,i[e],n);return o>1?E.uniqueSort(n):n},filter:function(t){return this.pushStack(L(this,t||[],!1))},not:function(t){return this.pushStack(L(this,t||[],!0))},is:function(t){return!!L(this,"string"==typeof t&&x.test(t)?E(t):t||[],!1).length}});var D,M=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(E.fn.init=function(t,e,n){var o,i;if(!t)return this;if(n=n||D,"string"==typeof t){if(!(o="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:M.exec(t))||!o[1]&&e)return!e||e.jquery?(e||n).find(t):this.constructor(e).find(t);if(o[1]){if(e=e instanceof E?e[0]:e,E.merge(this,E.parseHTML(o[1],e&&e.nodeType?e.ownerDocument||e:y,!0)),O.test(o[1])&&E.isPlainObject(e))for(o in e)v(this[o])?this[o](e[o]):this.attr(o,e[o]);return this}return(i=y.getElementById(o[2]))&&(this[0]=i,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):v(t)?void 0!==n.ready?n.ready(t):t(E):E.makeArray(t,this)}).prototype=E.fn,D=E(y);var $=/^(?:parents|prev(?:Until|All))/,R={children:!0,contents:!0,next:!0,prev:!0};function k(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}E.fn.extend({has:function(t){var e=E(t,this),n=e.length;return this.filter((function(){for(var t=0;t<n;t++)if(E.contains(this,e[t]))return!0}))},closest:function(t,e){var n,o=0,i=this.length,r=[],s="string"!=typeof t&&E(t);if(!x.test(t))for(;o<i;o++)for(n=this[o];n&&n!==e;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&E.find.matchesSelector(n,t))){r.push(n);break}return this.pushStack(r.length>1?E.uniqueSort(r):r)},index:function(t){return t?"string"==typeof t?d.call(E(t),this[0]):d.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(E.uniqueSort(E.merge(this.get(),E(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),E.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return S(t,"parentNode")},parentsUntil:function(t,e,n){return S(t,"parentNode",n)},next:function(t){return k(t,"nextSibling")},prev:function(t){return k(t,"previousSibling")},nextAll:function(t){return S(t,"nextSibling")},prevAll:function(t){return S(t,"previousSibling")},nextUntil:function(t,e,n){return S(t,"nextSibling",n)},prevUntil:function(t,e,n){return S(t,"previousSibling",n)},siblings:function(t){return T((t.parentNode||{}).firstChild,t)},children:function(t){return T(t.firstChild)},contents:function(t){return null!=t.contentDocument&&s(t.contentDocument)?t.contentDocument:(I(t,"template")&&(t=t.content||t),E.merge([],t.childNodes))}},(function(t,e){E.fn[t]=function(n,o){var i=E.map(this,e,n);return"Until"!==t.slice(-5)&&(o=n),o&&"string"==typeof o&&(i=E.filter(o,i)),this.length>1&&(R[t]||E.uniqueSort(i),$.test(t)&&i.reverse()),this.pushStack(i)}}));var U=/[^\x20\t\r\n\f]+/g;function P(t){return t}function B(t){throw t}function j(t,e,n,o){var i;try{t&&v(i=t.promise)?i.call(t).done(e).fail(n):t&&v(i=t.then)?i.call(t,e,n):e.apply(void 0,[t].slice(o))}catch(t){n.apply(void 0,[t])}}E.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return E.each(t.match(U)||[],(function(t,n){e[n]=!0})),e}(t):E.extend({},t);var e,n,o,i,r=[],s=[],a=-1,l=function(){for(i=i||t.once,o=e=!0;s.length;a=-1)for(n=s.shift();++a<r.length;)!1===r[a].apply(n[0],n[1])&&t.stopOnFalse&&(a=r.length,n=!1);t.memory||(n=!1),e=!1,i&&(r=n?[]:"")},c={add:function(){return r&&(n&&!e&&(a=r.length-1,s.push(n)),function e(n){E.each(n,(function(n,o){v(o)?t.unique&&c.has(o)||r.push(o):o&&o.length&&"string"!==A(o)&&e(o)}))}(arguments),n&&!e&&l()),this},remove:function(){return E.each(arguments,(function(t,e){for(var n;(n=E.inArray(e,r,n))>-1;)r.splice(n,1),n<=a&&a--})),this},has:function(t){return t?E.inArray(t,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return i=s=[],r=n="",this},disabled:function(){return!r},lock:function(){return i=s=[],n||e||(r=n=""),this},locked:function(){return!!i},fireWith:function(t,n){return i||(n=[t,(n=n||[]).slice?n.slice():n],s.push(n),e||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!o}};return c},E.extend({Deferred:function(t){var e=[["notify","progress",E.Callbacks("memory"),E.Callbacks("memory"),2],["resolve","done",E.Callbacks("once memory"),E.Callbacks("once memory"),0,"resolved"],["reject","fail",E.Callbacks("once memory"),E.Callbacks("once memory"),1,"rejected"]],o="pending",i={state:function(){return o},always:function(){return r.done(arguments).fail(arguments),this},catch:function(t){return i.then(null,t)},pipe:function(){var t=arguments;return E.Deferred((function(n){E.each(e,(function(e,o){var i=v(t[o[4]])&&t[o[4]];r[o[1]]((function(){var t=i&&i.apply(this,arguments);t&&v(t.promise)?t.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[o[0]+"With"](this,i?[t]:arguments)}))})),t=null})).promise()},then:function(t,o,i){var r=0;function s(t,e,o,i){return function(){var a=this,l=arguments,c=function(){var n,c;if(!(t<r)){if((n=o.apply(a,l))===e.promise())throw new TypeError("Thenable self-resolution");c=n&&("object"==typeof n||"function"==typeof n)&&n.then,v(c)?i?c.call(n,s(r,e,P,i),s(r,e,B,i)):(r++,c.call(n,s(r,e,P,i),s(r,e,B,i),s(r,e,P,e.notifyWith))):(o!==P&&(a=void 0,l=[n]),(i||e.resolveWith)(a,l))}},d=i?c:function(){try{c()}catch(n){E.Deferred.exceptionHook&&E.Deferred.exceptionHook(n,d.stackTrace),t+1>=r&&(o!==B&&(a=void 0,l=[n]),e.rejectWith(a,l))}};t?d():(E.Deferred.getStackHook&&(d.stackTrace=E.Deferred.getStackHook()),n.setTimeout(d))}}return E.Deferred((function(n){e[0][3].add(s(0,n,v(i)?i:P,n.notifyWith)),e[1][3].add(s(0,n,v(t)?t:P)),e[2][3].add(s(0,n,v(o)?o:B))})).promise()},promise:function(t){return null!=t?E.extend(t,i):i}},r={};return E.each(e,(function(t,n){var s=n[2],a=n[5];i[n[1]]=s.add,a&&s.add((function(){o=a}),e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),s.add(n[3].fire),r[n[0]]=function(){return r[n[0]+"With"](this===r?void 0:this,arguments),this},r[n[0]+"With"]=s.fireWith})),i.promise(r),t&&t.call(r,r),r},when:function(t){var e=arguments.length,n=e,o=Array(n),i=a.call(arguments),r=E.Deferred(),s=function(t){return function(n){o[t]=this,i[t]=arguments.length>1?a.call(arguments):n,--e||r.resolveWith(o,i)}};if(e<=1&&(j(t,r.done(s(n)).resolve,r.reject,!e),"pending"===r.state()||v(i[n]&&i[n].then)))return r.then();for(;n--;)j(i[n],s(n),r.reject);return r.promise()}});var F=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;E.Deferred.exceptionHook=function(t,e){n.console&&n.console.warn&&t&&F.test(t.name)&&n.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},E.readyException=function(t){n.setTimeout((function(){throw t}))};var H=E.Deferred();function V(){y.removeEventListener("DOMContentLoaded",V),n.removeEventListener("load",V),E.ready()}E.fn.ready=function(t){return H.then(t).catch((function(t){E.readyException(t)})),this},E.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--E.readyWait:E.isReady)||(E.isReady=!0,!0!==t&&--E.readyWait>0||H.resolveWith(y,[E]))}}),E.ready.then=H.then,"complete"===y.readyState||"loading"!==y.readyState&&!y.documentElement.doScroll?n.setTimeout(E.ready):(y.addEventListener("DOMContentLoaded",V),n.addEventListener("load",V));var z=function(t,e,n,o,i,r,s){var a=0,l=t.length,c=null==n;if("object"===A(n))for(a in i=!0,n)z(t,e,a,n[a],!0,r,s);else if(void 0!==o&&(i=!0,v(o)||(s=!0),c&&(s?(e.call(t,o),e=null):(c=e,e=function(t,e,n){return c.call(E(t),n)})),e))for(;a<l;a++)e(t[a],n,s?o:o.call(t[a],a,e(t[a],n)));return i?t:c?e.call(t):l?e(t[0],n):r},q=/^-ms-/,W=/-([a-z])/g;function G(t,e){return e.toUpperCase()}function X(t){return t.replace(q,"ms-").replace(W,G)}var Y=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function K(){this.expando=E.expando+K.uid++}K.uid=1,K.prototype={cache:function(t){var e=t[this.expando];return e||(e=Object.create(null),Y(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,n){var o,i=this.cache(t);if("string"==typeof e)i[X(e)]=n;else for(o in e)i[X(o)]=e[o];return i},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][X(e)]},access:function(t,e,n){return void 0===e||e&&"string"==typeof e&&void 0===n?this.get(t,e):(this.set(t,e,n),void 0!==n?n:e)},remove:function(t,e){var n,o=t[this.expando];if(void 0!==o){if(void 0!==e){n=(e=Array.isArray(e)?e.map(X):(e=X(e))in o?[e]:e.match(U)||[]).length;for(;n--;)delete o[e[n]]}(void 0===e||E.isEmptyObject(o))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!E.isEmptyObject(e)}};var Q=new K,J=new K,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,tt=/[A-Z]/g;function et(t,e,n){var o;if(void 0===n&&1===t.nodeType)if(o="data-"+e.replace(tt,"-$&").toLowerCase(),"string"==typeof(n=t.getAttribute(o))){try{n=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:Z.test(t)?JSON.parse(t):t)}(n)}catch(t){}J.set(t,e,n)}else n=void 0;return n}E.extend({hasData:function(t){return J.hasData(t)||Q.hasData(t)},data:function(t,e,n){return J.access(t,e,n)},removeData:function(t,e){J.remove(t,e)},_data:function(t,e,n){return Q.access(t,e,n)},_removeData:function(t,e){Q.remove(t,e)}}),E.fn.extend({data:function(t,e){var n,o,i,r=this[0],s=r&&r.attributes;if(void 0===t){if(this.length&&(i=J.get(r),1===r.nodeType&&!Q.get(r,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&0===(o=s[n].name).indexOf("data-")&&(o=X(o.slice(5)),et(r,o,i[o]));Q.set(r,"hasDataAttrs",!0)}return i}return"object"==typeof t?this.each((function(){J.set(this,t)})):z(this,(function(e){var n;if(r&&void 0===e)return void 0!==(n=J.get(r,t))||void 0!==(n=et(r,t))?n:void 0;this.each((function(){J.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){J.remove(this,t)}))}}),E.extend({queue:function(t,e,n){var o;if(t)return e=(e||"fx")+"queue",o=Q.get(t,e),n&&(!o||Array.isArray(n)?o=Q.access(t,e,E.makeArray(n)):o.push(n)),o||[]},dequeue:function(t,e){e=e||"fx";var n=E.queue(t,e),o=n.length,i=n.shift(),r=E._queueHooks(t,e);"inprogress"===i&&(i=n.shift(),o--),i&&("fx"===e&&n.unshift("inprogress"),delete r.stop,i.call(t,(function(){E.dequeue(t,e)}),r)),!o&&r&&r.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return Q.get(t,n)||Q.access(t,n,{empty:E.Callbacks("once memory").add((function(){Q.remove(t,[e+"queue",n])}))})}}),E.fn.extend({queue:function(t,e){var n=2;return"string"!=typeof t&&(e=t,t="fx",n--),arguments.length<n?E.queue(this[0],t):void 0===e?this:this.each((function(){var n=E.queue(this,t,e);E._queueHooks(this,t),"fx"===t&&"inprogress"!==n[0]&&E.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){E.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var n,o=1,i=E.Deferred(),r=this,s=this.length,a=function(){--o||i.resolveWith(r,[r])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";s--;)(n=Q.get(r[s],t+"queueHooks"))&&n.empty&&(o++,n.empty.add(a));return a(),i.promise(e)}});var nt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ot=new RegExp("^(?:([+-])=|)("+nt+")([a-z%]*)$","i"),it=["Top","Right","Bottom","Left"],rt=y.documentElement,st=function(t){return E.contains(t.ownerDocument,t)},at={composed:!0};rt.getRootNode&&(st=function(t){return E.contains(t.ownerDocument,t)||t.getRootNode(at)===t.ownerDocument});var lt=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&st(t)&&"none"===E.css(t,"display")};function ct(t,e,n,o){var i,r,s=20,a=o?function(){return o.cur()}:function(){return E.css(t,e,"")},l=a(),c=n&&n[3]||(E.cssNumber[e]?"":"px"),d=t.nodeType&&(E.cssNumber[e]||"px"!==c&&+l)&&ot.exec(E.css(t,e));if(d&&d[3]!==c){for(l/=2,c=c||d[3],d=+l||1;s--;)E.style(t,e,d+c),(1-r)*(1-(r=a()/l||.5))<=0&&(s=0),d/=r;d*=2,E.style(t,e,d+c),n=n||[]}return n&&(d=+d||+l||0,i=n[1]?d+(n[1]+1)*n[2]:+n[2],o&&(o.unit=c,o.start=d,o.end=i)),i}var dt={};function ut(t){var e,n=t.ownerDocument,o=t.nodeName,i=dt[o];return i||(e=n.body.appendChild(n.createElement(o)),i=E.css(e,"display"),e.parentNode.removeChild(e),"none"===i&&(i="block"),dt[o]=i,i)}function ht(t,e){for(var n,o,i=[],r=0,s=t.length;r<s;r++)(o=t[r]).style&&(n=o.style.display,e?("none"===n&&(i[r]=Q.get(o,"display")||null,i[r]||(o.style.display="")),""===o.style.display&&lt(o)&&(i[r]=ut(o))):"none"!==n&&(i[r]="none",Q.set(o,"display",n)));for(r=0;r<s;r++)null!=i[r]&&(t[r].style.display=i[r]);return t}E.fn.extend({show:function(){return ht(this,!0)},hide:function(){return ht(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){lt(this)?E(this).show():E(this).hide()}))}});var ft,mt,gt=/^(?:checkbox|radio)$/i,pt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,vt=/^$|^module$|\/(?:java|ecma)script/i;ft=y.createDocumentFragment().appendChild(y.createElement("div")),(mt=y.createElement("input")).setAttribute("type","radio"),mt.setAttribute("checked","checked"),mt.setAttribute("name","t"),ft.appendChild(mt),p.checkClone=ft.cloneNode(!0).cloneNode(!0).lastChild.checked,ft.innerHTML="<textarea>x</textarea>",p.noCloneChecked=!!ft.cloneNode(!0).lastChild.defaultValue,ft.innerHTML="<option></option>",p.option=!!ft.lastChild;var _t={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function yt(t,e){var n;return n=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&I(t,e)?E.merge([t],n):n}function bt(t,e){for(var n=0,o=t.length;n<o;n++)Q.set(t[n],"globalEval",!e||Q.get(e[n],"globalEval"))}_t.tbody=_t.tfoot=_t.colgroup=_t.caption=_t.thead,_t.th=_t.td,p.option||(_t.optgroup=_t.option=[1,"<select multiple='multiple'>","</select>"]);var wt=/<|&#?\w+;/;function At(t,e,n,o,i){for(var r,s,a,l,c,d,u=e.createDocumentFragment(),h=[],f=0,m=t.length;f<m;f++)if((r=t[f])||0===r)if("object"===A(r))E.merge(h,r.nodeType?[r]:r);else if(wt.test(r)){for(s=s||u.appendChild(e.createElement("div")),a=(pt.exec(r)||["",""])[1].toLowerCase(),l=_t[a]||_t._default,s.innerHTML=l[1]+E.htmlPrefilter(r)+l[2],d=l[0];d--;)s=s.lastChild;E.merge(h,s.childNodes),(s=u.firstChild).textContent=""}else h.push(e.createTextNode(r));for(u.textContent="",f=0;r=h[f++];)if(o&&E.inArray(r,o)>-1)i&&i.push(r);else if(c=st(r),s=yt(u.appendChild(r),"script"),c&&bt(s),n)for(d=0;r=s[d++];)vt.test(r.type||"")&&n.push(r);return u}var Et=/^key/,Ct=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Nt=/^([^.]*)(?:\.(.+)|)/;function St(){return!0}function Tt(){return!1}function xt(t,e){return t===function(){try{return y.activeElement}catch(t){}}()==("focus"===e)}function It(t,e,n,o,i,r){var s,a;if("object"==typeof e){for(a in"string"!=typeof n&&(o=o||n,n=void 0),e)It(t,a,n,o,e[a],r);return t}if(null==o&&null==i?(i=n,o=n=void 0):null==i&&("string"==typeof n?(i=o,o=void 0):(i=o,o=n,n=void 0)),!1===i)i=Tt;else if(!i)return t;return 1===r&&(s=i,(i=function(t){return E().off(t),s.apply(this,arguments)}).guid=s.guid||(s.guid=E.guid++)),t.each((function(){E.event.add(this,e,i,o,n)}))}function Ot(t,e,n){n?(Q.set(t,e,!1),E.event.add(t,e,{namespace:!1,handler:function(t){var o,i,r=Q.get(this,e);if(1&t.isTrigger&&this[e]){if(r.length)(E.event.special[e]||{}).delegateType&&t.stopPropagation();else if(r=a.call(arguments),Q.set(this,e,r),o=n(this,e),this[e](),r!==(i=Q.get(this,e))||o?Q.set(this,e,!1):i={},r!==i)return t.stopImmediatePropagation(),t.preventDefault(),i.value}else r.length&&(Q.set(this,e,{value:E.event.trigger(E.extend(r[0],E.Event.prototype),r.slice(1),this)}),t.stopImmediatePropagation())}})):void 0===Q.get(t,e)&&E.event.add(t,e,St)}E.event={global:{},add:function(t,e,n,o,i){var r,s,a,l,c,d,u,h,f,m,g,p=Q.get(t);if(Y(t))for(n.handler&&(n=(r=n).handler,i=r.selector),i&&E.find.matchesSelector(rt,i),n.guid||(n.guid=E.guid++),(l=p.events)||(l=p.events=Object.create(null)),(s=p.handle)||(s=p.handle=function(e){return void 0!==E&&E.event.triggered!==e.type?E.event.dispatch.apply(t,arguments):void 0}),c=(e=(e||"").match(U)||[""]).length;c--;)f=g=(a=Nt.exec(e[c])||[])[1],m=(a[2]||"").split(".").sort(),f&&(u=E.event.special[f]||{},f=(i?u.delegateType:u.bindType)||f,u=E.event.special[f]||{},d=E.extend({type:f,origType:g,data:o,handler:n,guid:n.guid,selector:i,needsContext:i&&E.expr.match.needsContext.test(i),namespace:m.join(".")},r),(h=l[f])||((h=l[f]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(t,o,m,s)||t.addEventListener&&t.addEventListener(f,s)),u.add&&(u.add.call(t,d),d.handler.guid||(d.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,d):h.push(d),E.event.global[f]=!0)},remove:function(t,e,n,o,i){var r,s,a,l,c,d,u,h,f,m,g,p=Q.hasData(t)&&Q.get(t);if(p&&(l=p.events)){for(c=(e=(e||"").match(U)||[""]).length;c--;)if(f=g=(a=Nt.exec(e[c])||[])[1],m=(a[2]||"").split(".").sort(),f){for(u=E.event.special[f]||{},h=l[f=(o?u.delegateType:u.bindType)||f]||[],a=a[2]&&new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=r=h.length;r--;)d=h[r],!i&&g!==d.origType||n&&n.guid!==d.guid||a&&!a.test(d.namespace)||o&&o!==d.selector&&("**"!==o||!d.selector)||(h.splice(r,1),d.selector&&h.delegateCount--,u.remove&&u.remove.call(t,d));s&&!h.length&&(u.teardown&&!1!==u.teardown.call(t,m,p.handle)||E.removeEvent(t,f,p.handle),delete l[f])}else for(f in l)E.event.remove(t,f+e[c],n,o,!0);E.isEmptyObject(l)&&Q.remove(t,"handle events")}},dispatch:function(t){var e,n,o,i,r,s,a=new Array(arguments.length),l=E.event.fix(t),c=(Q.get(this,"events")||Object.create(null))[l.type]||[],d=E.event.special[l.type]||{};for(a[0]=l,e=1;e<arguments.length;e++)a[e]=arguments[e];if(l.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,l)){for(s=E.event.handlers.call(this,l,c),e=0;(i=s[e++])&&!l.isPropagationStopped();)for(l.currentTarget=i.elem,n=0;(r=i.handlers[n++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==r.namespace&&!l.rnamespace.test(r.namespace)||(l.handleObj=r,l.data=r.data,void 0!==(o=((E.event.special[r.origType]||{}).handle||r.handler).apply(i.elem,a))&&!1===(l.result=o)&&(l.preventDefault(),l.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,l),l.result}},handlers:function(t,e){var n,o,i,r,s,a=[],l=e.delegateCount,c=t.target;if(l&&c.nodeType&&!("click"===t.type&&t.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(r=[],s={},n=0;n<l;n++)void 0===s[i=(o=e[n]).selector+" "]&&(s[i]=o.needsContext?E(i,this).index(c)>-1:E.find(i,this,null,[c]).length),s[i]&&r.push(o);r.length&&a.push({elem:c,handlers:r})}return c=this,l<e.length&&a.push({elem:c,handlers:e.slice(l)}),a},addProp:function(t,e){Object.defineProperty(E.Event.prototype,t,{enumerable:!0,configurable:!0,get:v(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[E.expando]?t:new E.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return gt.test(e.type)&&e.click&&I(e,"input")&&Ot(e,"click",St),!1},trigger:function(t){var e=this||t;return gt.test(e.type)&&e.click&&I(e,"input")&&Ot(e,"click"),!0},_default:function(t){var e=t.target;return gt.test(e.type)&&e.click&&I(e,"input")&&Q.get(e,"click")||I(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},E.removeEvent=function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n)},E.Event=function(t,e){if(!(this instanceof E.Event))return new E.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?St:Tt,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&E.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[E.expando]=!0},E.Event.prototype={constructor:E.Event,isDefaultPrevented:Tt,isPropagationStopped:Tt,isImmediatePropagationStopped:Tt,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=St,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=St,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=St,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},E.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&Et.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&Ct.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},E.event.addProp),E.each({focus:"focusin",blur:"focusout"},(function(t,e){E.event.special[t]={setup:function(){return Ot(this,t,xt),!1},trigger:function(){return Ot(this,t),!0},delegateType:e}})),E.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){E.event.special[t]={delegateType:e,bindType:e,handle:function(t){var n,o=this,i=t.relatedTarget,r=t.handleObj;return i&&(i===o||E.contains(o,i))||(t.type=r.origType,n=r.handler.apply(this,arguments),t.type=e),n}}})),E.fn.extend({on:function(t,e,n,o){return It(this,t,e,n,o)},one:function(t,e,n,o){return It(this,t,e,n,o,1)},off:function(t,e,n){var o,i;if(t&&t.preventDefault&&t.handleObj)return o=t.handleObj,E(t.delegateTarget).off(o.namespace?o.origType+"."+o.namespace:o.origType,o.selector,o.handler),this;if("object"==typeof t){for(i in t)this.off(i,e,t[i]);return this}return!1!==e&&"function"!=typeof e||(n=e,e=void 0),!1===n&&(n=Tt),this.each((function(){E.event.remove(this,t,n,e)}))}});var Lt=/<script|<style|<link/i,Dt=/checked\s*(?:[^=]|=\s*.checked.)/i,Mt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function $t(t,e){return I(t,"table")&&I(11!==e.nodeType?e:e.firstChild,"tr")&&E(t).children("tbody")[0]||t}function Rt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function kt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Ut(t,e){var n,o,i,r,s,a;if(1===e.nodeType){if(Q.hasData(t)&&(a=Q.get(t).events))for(i in Q.remove(e,"handle events"),a)for(n=0,o=a[i].length;n<o;n++)E.event.add(e,i,a[i][n]);J.hasData(t)&&(r=J.access(t),s=E.extend({},r),J.set(e,s))}}function Pt(t,e){var n=e.nodeName.toLowerCase();"input"===n&&gt.test(t.type)?e.checked=t.checked:"input"!==n&&"textarea"!==n||(e.defaultValue=t.defaultValue)}function Bt(t,e,n,o){e=l(e);var i,r,s,a,c,d,u=0,h=t.length,f=h-1,m=e[0],g=v(m);if(g||h>1&&"string"==typeof m&&!p.checkClone&&Dt.test(m))return t.each((function(i){var r=t.eq(i);g&&(e[0]=m.call(this,i,r.html())),Bt(r,e,n,o)}));if(h&&(r=(i=At(e,t[0].ownerDocument,!1,t,o)).firstChild,1===i.childNodes.length&&(i=r),r||o)){for(a=(s=E.map(yt(i,"script"),Rt)).length;u<h;u++)c=i,u!==f&&(c=E.clone(c,!0,!0),a&&E.merge(s,yt(c,"script"))),n.call(t[u],c,u);if(a)for(d=s[s.length-1].ownerDocument,E.map(s,kt),u=0;u<a;u++)c=s[u],vt.test(c.type||"")&&!Q.access(c,"globalEval")&&E.contains(d,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?E._evalUrl&&!c.noModule&&E._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},d):w(c.textContent.replace(Mt,""),c,d))}return t}function jt(t,e,n){for(var o,i=e?E.filter(e,t):t,r=0;null!=(o=i[r]);r++)n||1!==o.nodeType||E.cleanData(yt(o)),o.parentNode&&(n&&st(o)&&bt(yt(o,"script")),o.parentNode.removeChild(o));return t}E.extend({htmlPrefilter:function(t){return t},clone:function(t,e,n){var o,i,r,s,a=t.cloneNode(!0),l=st(t);if(!(p.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||E.isXMLDoc(t)))for(s=yt(a),o=0,i=(r=yt(t)).length;o<i;o++)Pt(r[o],s[o]);if(e)if(n)for(r=r||yt(t),s=s||yt(a),o=0,i=r.length;o<i;o++)Ut(r[o],s[o]);else Ut(t,a);return(s=yt(a,"script")).length>0&&bt(s,!l&&yt(t,"script")),a},cleanData:function(t){for(var e,n,o,i=E.event.special,r=0;void 0!==(n=t[r]);r++)if(Y(n)){if(e=n[Q.expando]){if(e.events)for(o in e.events)i[o]?E.event.remove(n,o):E.removeEvent(n,o,e.handle);n[Q.expando]=void 0}n[J.expando]&&(n[J.expando]=void 0)}}}),E.fn.extend({detach:function(t){return jt(this,t,!0)},remove:function(t){return jt(this,t)},text:function(t){return z(this,(function(t){return void 0===t?E.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return Bt(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||$t(this,t).appendChild(t)}))},prepend:function(){return Bt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=$t(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return Bt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return Bt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(E.cleanData(yt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return E.clone(this,t,e)}))},html:function(t){return z(this,(function(t){var e=this[0]||{},n=0,o=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Lt.test(t)&&!_t[(pt.exec(t)||["",""])[1].toLowerCase()]){t=E.htmlPrefilter(t);try{for(;n<o;n++)1===(e=this[n]||{}).nodeType&&(E.cleanData(yt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return Bt(this,arguments,(function(e){var n=this.parentNode;E.inArray(this,t)<0&&(E.cleanData(yt(this)),n&&n.replaceChild(e,this))}),t)}}),E.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){E.fn[t]=function(t){for(var n,o=[],i=E(t),r=i.length-1,s=0;s<=r;s++)n=s===r?this:this.clone(!0),E(i[s])[e](n),c.apply(o,n.get());return this.pushStack(o)}}));var Ft=new RegExp("^("+nt+")(?!px)[a-z%]+$","i"),Ht=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=n),e.getComputedStyle(t)},Vt=function(t,e,n){var o,i,r={};for(i in e)r[i]=t.style[i],t.style[i]=e[i];for(i in o=n.call(t),e)t.style[i]=r[i];return o},zt=new RegExp(it.join("|"),"i");function qt(t,e,n){var o,i,r,s,a=t.style;return(n=n||Ht(t))&&(""!==(s=n.getPropertyValue(e)||n[e])||st(t)||(s=E.style(t,e)),!p.pixelBoxStyles()&&Ft.test(s)&&zt.test(e)&&(o=a.width,i=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=o,a.minWidth=i,a.maxWidth=r)),void 0!==s?s+"":s}function Wt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function t(){if(d){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",rt.appendChild(c).appendChild(d);var t=n.getComputedStyle(d);o="1%"!==t.top,l=12===e(t.marginLeft),d.style.right="60%",s=36===e(t.right),i=36===e(t.width),d.style.position="absolute",r=12===e(d.offsetWidth/3),rt.removeChild(c),d=null}}function e(t){return Math.round(parseFloat(t))}var o,i,r,s,a,l,c=y.createElement("div"),d=y.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",p.clearCloneStyle="content-box"===d.style.backgroundClip,E.extend(p,{boxSizingReliable:function(){return t(),i},pixelBoxStyles:function(){return t(),s},pixelPosition:function(){return t(),o},reliableMarginLeft:function(){return t(),l},scrollboxSize:function(){return t(),r},reliableTrDimensions:function(){var t,e,o,i;return null==a&&(t=y.createElement("table"),e=y.createElement("tr"),o=y.createElement("div"),t.style.cssText="position:absolute;left:-11111px",e.style.height="1px",o.style.height="9px",rt.appendChild(t).appendChild(e).appendChild(o),i=n.getComputedStyle(e),a=parseInt(i.height)>3,rt.removeChild(t)),a}}))}();var Gt=["Webkit","Moz","ms"],Xt=y.createElement("div").style,Yt={};function Kt(t){var e=E.cssProps[t]||Yt[t];return e||(t in Xt?t:Yt[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),n=Gt.length;n--;)if((t=Gt[n]+e)in Xt)return t}(t)||t)}var Qt=/^(none|table(?!-c[ea]).+)/,Jt=/^--/,Zt={position:"absolute",visibility:"hidden",display:"block"},te={letterSpacing:"0",fontWeight:"400"};function ee(t,e,n){var o=ot.exec(e);return o?Math.max(0,o[2]-(n||0))+(o[3]||"px"):e}function ne(t,e,n,o,i,r){var s="width"===e?1:0,a=0,l=0;if(n===(o?"border":"content"))return 0;for(;s<4;s+=2)"margin"===n&&(l+=E.css(t,n+it[s],!0,i)),o?("content"===n&&(l-=E.css(t,"padding"+it[s],!0,i)),"margin"!==n&&(l-=E.css(t,"border"+it[s]+"Width",!0,i))):(l+=E.css(t,"padding"+it[s],!0,i),"padding"!==n?l+=E.css(t,"border"+it[s]+"Width",!0,i):a+=E.css(t,"border"+it[s]+"Width",!0,i));return!o&&r>=0&&(l+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-r-l-a-.5))||0),l}function oe(t,e,n){var o=Ht(t),i=(!p.boxSizingReliable()||n)&&"border-box"===E.css(t,"boxSizing",!1,o),r=i,s=qt(t,e,o),a="offset"+e[0].toUpperCase()+e.slice(1);if(Ft.test(s)){if(!n)return s;s="auto"}return(!p.boxSizingReliable()&&i||!p.reliableTrDimensions()&&I(t,"tr")||"auto"===s||!parseFloat(s)&&"inline"===E.css(t,"display",!1,o))&&t.getClientRects().length&&(i="border-box"===E.css(t,"boxSizing",!1,o),(r=a in t)&&(s=t[a])),(s=parseFloat(s)||0)+ne(t,e,n||(i?"border":"content"),r,o,s)+"px"}E.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=qt(t,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,n,o){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var i,r,s,a=X(e),l=Jt.test(e),c=t.style;if(l||(e=Kt(a)),s=E.cssHooks[e]||E.cssHooks[a],void 0===n)return s&&"get"in s&&void 0!==(i=s.get(t,!1,o))?i:c[e];"string"===(r=typeof n)&&(i=ot.exec(n))&&i[1]&&(n=ct(t,e,i),r="number"),null!=n&&n==n&&("number"!==r||l||(n+=i&&i[3]||(E.cssNumber[a]?"":"px")),p.clearCloneStyle||""!==n||0!==e.indexOf("background")||(c[e]="inherit"),s&&"set"in s&&void 0===(n=s.set(t,n,o))||(l?c.setProperty(e,n):c[e]=n))}},css:function(t,e,n,o){var i,r,s,a=X(e);return Jt.test(e)||(e=Kt(a)),(s=E.cssHooks[e]||E.cssHooks[a])&&"get"in s&&(i=s.get(t,!0,n)),void 0===i&&(i=qt(t,e,o)),"normal"===i&&e in te&&(i=te[e]),""===n||n?(r=parseFloat(i),!0===n||isFinite(r)?r||0:i):i}}),E.each(["height","width"],(function(t,e){E.cssHooks[e]={get:function(t,n,o){if(n)return!Qt.test(E.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?oe(t,e,o):Vt(t,Zt,(function(){return oe(t,e,o)}))},set:function(t,n,o){var i,r=Ht(t),s=!p.scrollboxSize()&&"absolute"===r.position,a=(s||o)&&"border-box"===E.css(t,"boxSizing",!1,r),l=o?ne(t,e,o,a,r):0;return a&&s&&(l-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(r[e])-ne(t,e,"border",!1,r)-.5)),l&&(i=ot.exec(n))&&"px"!==(i[3]||"px")&&(t.style[e]=n,n=E.css(t,e)),ee(0,n,l)}}})),E.cssHooks.marginLeft=Wt(p.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(qt(t,"marginLeft"))||t.getBoundingClientRect().left-Vt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),E.each({margin:"",padding:"",border:"Width"},(function(t,e){E.cssHooks[t+e]={expand:function(n){for(var o=0,i={},r="string"==typeof n?n.split(" "):[n];o<4;o++)i[t+it[o]+e]=r[o]||r[o-2]||r[0];return i}},"margin"!==t&&(E.cssHooks[t+e].set=ee)})),E.fn.extend({css:function(t,e){return z(this,(function(t,e,n){var o,i,r={},s=0;if(Array.isArray(e)){for(o=Ht(t),i=e.length;s<i;s++)r[e[s]]=E.css(t,e[s],!1,o);return r}return void 0!==n?E.style(t,e,n):E.css(t,e)}),t,e,arguments.length>1)}}),E.fn.delay=function(t,e){return t=E.fx&&E.fx.speeds[t]||t,e=e||"fx",this.queue(e,(function(e,o){var i=n.setTimeout(e,t);o.stop=function(){n.clearTimeout(i)}}))},function(){var t=y.createElement("input"),e=y.createElement("select").appendChild(y.createElement("option"));t.type="checkbox",p.checkOn=""!==t.value,p.optSelected=e.selected,(t=y.createElement("input")).value="t",t.type="radio",p.radioValue="t"===t.value}();var ie,re=E.expr.attrHandle;E.fn.extend({attr:function(t,e){return z(this,E.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){E.removeAttr(this,t)}))}}),E.extend({attr:function(t,e,n){var o,i,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return void 0===t.getAttribute?E.prop(t,e,n):(1===r&&E.isXMLDoc(t)||(i=E.attrHooks[e.toLowerCase()]||(E.expr.match.bool.test(e)?ie:void 0)),void 0!==n?null===n?void E.removeAttr(t,e):i&&"set"in i&&void 0!==(o=i.set(t,n,e))?o:(t.setAttribute(e,n+""),n):i&&"get"in i&&null!==(o=i.get(t,e))?o:null==(o=E.find.attr(t,e))?void 0:o)},attrHooks:{type:{set:function(t,e){if(!p.radioValue&&"radio"===e&&I(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}}},removeAttr:function(t,e){var n,o=0,i=e&&e.match(U);if(i&&1===t.nodeType)for(;n=i[o++];)t.removeAttribute(n)}}),ie={set:function(t,e,n){return!1===e?E.removeAttr(t,n):t.setAttribute(n,n),n}},E.each(E.expr.match.bool.source.match(/\w+/g),(function(t,e){var n=re[e]||E.find.attr;re[e]=function(t,e,o){var i,r,s=e.toLowerCase();return o||(r=re[s],re[s]=i,i=null!=n(t,e,o)?s:null,re[s]=r),i}}));var se=/^(?:input|select|textarea|button)$/i,ae=/^(?:a|area)$/i;function le(t){return(t.match(U)||[]).join(" ")}function ce(t){return t.getAttribute&&t.getAttribute("class")||""}function de(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(U)||[]}E.fn.extend({prop:function(t,e){return z(this,E.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[E.propFix[t]||t]}))}}),E.extend({prop:function(t,e,n){var o,i,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&E.isXMLDoc(t)||(e=E.propFix[e]||e,i=E.propHooks[e]),void 0!==n?i&&"set"in i&&void 0!==(o=i.set(t,n,e))?o:t[e]=n:i&&"get"in i&&null!==(o=i.get(t,e))?o:t[e]},propHooks:{tabIndex:{get:function(t){var e=E.find.attr(t,"tabindex");return e?parseInt(e,10):se.test(t.nodeName)||ae.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),p.optSelected||(E.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),E.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){E.propFix[this.toLowerCase()]=this})),E.fn.extend({addClass:function(t){var e,n,o,i,r,s,a,l=0;if(v(t))return this.each((function(e){E(this).addClass(t.call(this,e,ce(this)))}));if((e=de(t)).length)for(;n=this[l++];)if(i=ce(n),o=1===n.nodeType&&" "+le(i)+" "){for(s=0;r=e[s++];)o.indexOf(" "+r+" ")<0&&(o+=r+" ");i!==(a=le(o))&&n.setAttribute("class",a)}return this},removeClass:function(t){var e,n,o,i,r,s,a,l=0;if(v(t))return this.each((function(e){E(this).removeClass(t.call(this,e,ce(this)))}));if(!arguments.length)return this.attr("class","");if((e=de(t)).length)for(;n=this[l++];)if(i=ce(n),o=1===n.nodeType&&" "+le(i)+" "){for(s=0;r=e[s++];)for(;o.indexOf(" "+r+" ")>-1;)o=o.replace(" "+r+" "," ");i!==(a=le(o))&&n.setAttribute("class",a)}return this},toggleClass:function(t,e){var n=typeof t,o="string"===n||Array.isArray(t);return"boolean"==typeof e&&o?e?this.addClass(t):this.removeClass(t):v(t)?this.each((function(n){E(this).toggleClass(t.call(this,n,ce(this),e),e)})):this.each((function(){var e,i,r,s;if(o)for(i=0,r=E(this),s=de(t);e=s[i++];)r.hasClass(e)?r.removeClass(e):r.addClass(e);else void 0!==t&&"boolean"!==n||((e=ce(this))&&Q.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":Q.get(this,"__className__")||""))}))},hasClass:function(t){var e,n,o=0;for(e=" "+t+" ";n=this[o++];)if(1===n.nodeType&&(" "+le(ce(n))+" ").indexOf(e)>-1)return!0;return!1}});var ue=/\r/g;E.fn.extend({val:function(t){var e,n,o,i=this[0];return arguments.length?(o=v(t),this.each((function(n){var i;1===this.nodeType&&(null==(i=o?t.call(this,n,E(this).val()):t)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=E.map(i,(function(t){return null==t?"":t+""}))),(e=E.valHooks[this.type]||E.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,i,"value")||(this.value=i))}))):i?(e=E.valHooks[i.type]||E.valHooks[i.nodeName.toLowerCase()])&&"get"in e&&void 0!==(n=e.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(ue,""):null==n?"":n:void 0}}),E.extend({valHooks:{option:{get:function(t){var e=E.find.attr(t,"value");return null!=e?e:le(E.text(t))}},select:{get:function(t){var e,n,o,i=t.options,r=t.selectedIndex,s="select-one"===t.type,a=s?null:[],l=s?r+1:i.length;for(o=r<0?l:s?r:0;o<l;o++)if(((n=i[o]).selected||o===r)&&!n.disabled&&(!n.parentNode.disabled||!I(n.parentNode,"optgroup"))){if(e=E(n).val(),s)return e;a.push(e)}return a},set:function(t,e){for(var n,o,i=t.options,r=E.makeArray(e),s=i.length;s--;)((o=i[s]).selected=E.inArray(E.valHooks.option.get(o),r)>-1)&&(n=!0);return n||(t.selectedIndex=-1),r}}}}),E.each(["radio","checkbox"],(function(){E.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=E.inArray(E(t).val(),e)>-1}},p.checkOn||(E.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})})),p.focusin="onfocusin"in n;var he=/^(?:focusinfocus|focusoutblur)$/,fe=function(t){t.stopPropagation()};E.extend(E.event,{trigger:function(t,e,o,i){var r,s,a,l,c,d,u,h,m=[o||y],g=f.call(t,"type")?t.type:t,p=f.call(t,"namespace")?t.namespace.split("."):[];if(s=h=a=o=o||y,3!==o.nodeType&&8!==o.nodeType&&!he.test(g+E.event.triggered)&&(g.indexOf(".")>-1&&(p=g.split("."),g=p.shift(),p.sort()),c=g.indexOf(":")<0&&"on"+g,(t=t[E.expando]?t:new E.Event(g,"object"==typeof t&&t)).isTrigger=i?2:3,t.namespace=p.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=o),e=null==e?[t]:E.makeArray(e,[t]),u=E.event.special[g]||{},i||!u.trigger||!1!==u.trigger.apply(o,e))){if(!i&&!u.noBubble&&!_(o)){for(l=u.delegateType||g,he.test(l+g)||(s=s.parentNode);s;s=s.parentNode)m.push(s),a=s;a===(o.ownerDocument||y)&&m.push(a.defaultView||a.parentWindow||n)}for(r=0;(s=m[r++])&&!t.isPropagationStopped();)h=s,t.type=r>1?l:u.bindType||g,(d=(Q.get(s,"events")||Object.create(null))[t.type]&&Q.get(s,"handle"))&&d.apply(s,e),(d=c&&s[c])&&d.apply&&Y(s)&&(t.result=d.apply(s,e),!1===t.result&&t.preventDefault());return t.type=g,i||t.isDefaultPrevented()||u._default&&!1!==u._default.apply(m.pop(),e)||!Y(o)||c&&v(o[g])&&!_(o)&&((a=o[c])&&(o[c]=null),E.event.triggered=g,t.isPropagationStopped()&&h.addEventListener(g,fe),o[g](),t.isPropagationStopped()&&h.removeEventListener(g,fe),E.event.triggered=void 0,a&&(o[c]=a)),t.result}},simulate:function(t,e,n){var o=E.extend(new E.Event,n,{type:t,isSimulated:!0});E.event.trigger(o,null,e)}}),E.fn.extend({trigger:function(t,e){return this.each((function(){E.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var n=this[0];if(n)return E.event.trigger(t,e,n,!0)}}),p.focusin||E.each({focus:"focusin",blur:"focusout"},(function(t,e){var n=function(t){E.event.simulate(e,t.target,E.event.fix(t))};E.event.special[e]={setup:function(){var o=this.ownerDocument||this.document||this,i=Q.access(o,e);i||o.addEventListener(t,n,!0),Q.access(o,e,(i||0)+1)},teardown:function(){var o=this.ownerDocument||this.document||this,i=Q.access(o,e)-1;i?Q.access(o,e,i):(o.removeEventListener(t,n,!0),Q.remove(o,e))}}})),E.parseXML=function(t){var e;if(!t||"string"!=typeof t)return null;try{e=(new n.DOMParser).parseFromString(t,"text/xml")}catch(t){e=void 0}return e&&!e.getElementsByTagName("parsererror").length||E.error("Invalid XML: "+t),e};var me,ge=/\[\]$/,pe=/\r?\n/g,ve=/^(?:submit|button|image|reset|file)$/i,_e=/^(?:input|select|textarea|keygen)/i;function ye(t,e,n,o){var i;if(Array.isArray(e))E.each(e,(function(e,i){n||ge.test(t)?o(t,i):ye(t+"["+("object"==typeof i&&null!=i?e:"")+"]",i,n,o)}));else if(n||"object"!==A(e))o(t,e);else for(i in e)ye(t+"["+i+"]",e[i],n,o)}E.param=function(t,e){var n,o=[],i=function(t,e){var n=v(e)?e():e;o[o.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==n?"":n)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!E.isPlainObject(t))E.each(t,(function(){i(this.name,this.value)}));else for(n in t)ye(n,t[n],e,i);return o.join("&")},E.fn.extend({serialize:function(){return E.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=E.prop(this,"elements");return t?E.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!E(this).is(":disabled")&&_e.test(this.nodeName)&&!ve.test(t)&&(this.checked||!gt.test(t))})).map((function(t,e){var n=E(this).val();return null==n?null:Array.isArray(n)?E.map(n,(function(t){return{name:e.name,value:t.replace(pe,"\r\n")}})):{name:e.name,value:n.replace(pe,"\r\n")}})).get()}}),E.fn.extend({wrapAll:function(t){var e;return this[0]&&(v(t)&&(t=t.call(this[0])),e=E(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return v(t)?this.each((function(e){E(this).wrapInner(t.call(this,e))})):this.each((function(){var e=E(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)}))},wrap:function(t){var e=v(t);return this.each((function(n){E(this).wrapAll(e?t.call(this,n):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){E(this).replaceWith(this.childNodes)})),this}}),E.expr.pseudos.hidden=function(t){return!E.expr.pseudos.visible(t)},E.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},p.createHTMLDocument=((me=y.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===me.childNodes.length),E.parseHTML=function(t,e,n){return"string"!=typeof t?[]:("boolean"==typeof e&&(n=e,e=!1),e||(p.createHTMLDocument?((o=(e=y.implementation.createHTMLDocument("")).createElement("base")).href=y.location.href,e.head.appendChild(o)):e=y),r=!n&&[],(i=O.exec(t))?[e.createElement(i[1])]:(i=At([t],e,r),r&&r.length&&E(r).remove(),E.merge([],i.childNodes)));var o,i,r},E.offset={setOffset:function(t,e,n){var o,i,r,s,a,l,c=E.css(t,"position"),d=E(t),u={};"static"===c&&(t.style.position="relative"),a=d.offset(),r=E.css(t,"top"),l=E.css(t,"left"),("absolute"===c||"fixed"===c)&&(r+l).indexOf("auto")>-1?(s=(o=d.position()).top,i=o.left):(s=parseFloat(r)||0,i=parseFloat(l)||0),v(e)&&(e=e.call(t,n,E.extend({},a))),null!=e.top&&(u.top=e.top-a.top+s),null!=e.left&&(u.left=e.left-a.left+i),"using"in e?e.using.call(t,u):("number"==typeof u.top&&(u.top+="px"),"number"==typeof u.left&&(u.left+="px"),d.css(u))}},E.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){E.offset.setOffset(this,t,e)}));var e,n,o=this[0];return o?o.getClientRects().length?(e=o.getBoundingClientRect(),n=o.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,n,o=this[0],i={top:0,left:0};if("fixed"===E.css(o,"position"))e=o.getBoundingClientRect();else{for(e=this.offset(),n=o.ownerDocument,t=o.offsetParent||n.documentElement;t&&(t===n.body||t===n.documentElement)&&"static"===E.css(t,"position");)t=t.parentNode;t&&t!==o&&1===t.nodeType&&((i=E(t).offset()).top+=E.css(t,"borderTopWidth",!0),i.left+=E.css(t,"borderLeftWidth",!0))}return{top:e.top-i.top-E.css(o,"marginTop",!0),left:e.left-i.left-E.css(o,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===E.css(t,"position");)t=t.offsetParent;return t||rt}))}}),E.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var n="pageYOffset"===e;E.fn[t]=function(o){return z(this,(function(t,o,i){var r;if(_(t)?r=t:9===t.nodeType&&(r=t.defaultView),void 0===i)return r?r[e]:t[o];r?r.scrollTo(n?r.pageXOffset:i,n?i:r.pageYOffset):t[o]=i}),t,o,arguments.length)}})),E.each(["top","left"],(function(t,e){E.cssHooks[e]=Wt(p.pixelPosition,(function(t,n){if(n)return n=qt(t,e),Ft.test(n)?E(t).position()[e]+"px":n}))})),E.each({Height:"height",Width:"width"},(function(t,e){E.each({padding:"inner"+t,content:e,"":"outer"+t},(function(n,o){E.fn[o]=function(i,r){var s=arguments.length&&(n||"boolean"!=typeof i),a=n||(!0===i||!0===r?"margin":"border");return z(this,(function(e,n,i){var r;return _(e)?0===o.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):void 0===i?E.css(e,n,a):E.style(e,n,i,a)}),e,s?i:void 0,s)}}))})),E.fn.extend({bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,n,o){return this.on(e,t,n,o)},undelegate:function(t,e,n){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),E.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){E.fn[e]=function(t,n){return arguments.length>0?this.on(e,null,t,n):this.trigger(e)}}));var be=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;E.proxy=function(t,e){var n,o,i;if("string"==typeof e&&(n=t[e],e=t,t=n),v(t))return o=a.call(arguments,2),(i=function(){return t.apply(e||this,o.concat(a.call(arguments)))}).guid=t.guid=t.guid||E.guid++,i},E.holdReady=function(t){t?E.readyWait++:E.ready(!0)},E.isArray=Array.isArray,E.parseJSON=JSON.parse,E.nodeName=I,E.isFunction=v,E.isWindow=_,E.camelCase=X,E.type=A,E.now=Date.now,E.isNumeric=function(t){var e=E.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},E.trim=function(t){return null==t?"":(t+"").replace(be,"")},void 0===(o=function(){return E}.apply(e,[]))||(t.exports=o);var we=n.jQuery,Ae=n.$;E.noConflict=function(t){return n.$===E&&(n.$=Ae),t&&n.jQuery===E&&(n.jQuery=we),E};var Ee,Ce,Ne=/^(?:toggle|show|hide)$/,Se=/queueHooks$/;function Te(){Ce&&(!1===y.hidden&&n.requestAnimationFrame?n.requestAnimationFrame(Te):n.setTimeout(Te,E.fx.interval),E.fx.tick())}function xe(){return n.setTimeout((function(){Ee=void 0})),Ee=Date.now()}function Ie(t,e){var n,o=0,i={height:t};for(e=e?1:0;o<4;o+=2-e)i["margin"+(n=it[o])]=i["padding"+n]=t;return e&&(i.opacity=i.width=t),i}function Oe(t,e,n,o,i){return new Oe.prototype.init(t,e,n,o,i)}function Le(t,e,n){for(var o,i=(De.tweeners[e]||[]).concat(De.tweeners["*"]),r=0,s=i.length;r<s;r++)if(o=i[r].call(n,e,t))return o}function De(t,e,n){var o,i,r=0,s=De.prefilters.length,a=E.Deferred().always((function(){delete l.elem})),l=function(){if(i)return!1;for(var e=Ee||xe(),n=Math.max(0,c.startTime+c.duration-e),o=1-(n/c.duration||0),r=0,s=c.tweens.length;r<s;r++)c.tweens[r].run(o);return a.notifyWith(t,[c,o,n]),o<1&&s?n:(s||a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c]),!1)},c=a.promise({elem:t,props:E.extend({},e),opts:E.extend(!0,{specialEasing:{},easing:E.easing._default},n),originalProperties:e,originalOptions:n,startTime:Ee||xe(),duration:n.duration,tweens:[],createTween:function(e,n){var o=E.Tween(t,c.opts,e,n,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(o),o},stop:function(e){var n=0,o=e?c.tweens.length:0;if(i)return this;for(i=!0;n<o;n++)c.tweens[n].run(1);return e?(a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c,e])):a.rejectWith(t,[c,e]),this}}),d=c.props;for(!function(t,e){var n,o,i,r,s;for(n in t)if(i=e[o=X(n)],r=t[n],Array.isArray(r)&&(i=r[1],r=t[n]=r[0]),n!==o&&(t[o]=r,delete t[n]),(s=E.cssHooks[o])&&"expand"in s)for(n in r=s.expand(r),delete t[o],r)n in t||(t[n]=r[n],e[n]=i);else e[o]=i}(d,c.opts.specialEasing);r<s;r++)if(o=De.prefilters[r].call(c,t,d,c.opts))return v(o.stop)&&(E._queueHooks(c.elem,c.opts.queue).stop=o.stop.bind(o)),o;return E.map(d,Le,c),v(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),E.fx.timer(E.extend(l,{elem:t,anim:c,queue:c.opts.queue})),c}return E.Tween=Oe,Oe.prototype={constructor:Oe,init:function(t,e,n,o,i,r){this.elem=t,this.prop=n,this.easing=i||E.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=o,this.unit=r||(E.cssNumber[n]?"":"px")},cur:function(){var t=Oe.propHooks[this.prop];return t&&t.get?t.get(this):Oe.propHooks._default.get(this)},run:function(t){var e,n=Oe.propHooks[this.prop];return this.options.duration?this.pos=e=E.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Oe.propHooks._default.set(this),this}},Oe.prototype.init.prototype=Oe.prototype,Oe.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=E.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){E.fx.step[t.prop]?E.fx.step[t.prop](t):1!==t.elem.nodeType||!E.cssHooks[t.prop]&&null==t.elem.style[Kt(t.prop)]?t.elem[t.prop]=t.now:E.style(t.elem,t.prop,t.now+t.unit)}}},Oe.propHooks.scrollTop=Oe.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},E.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},E.fx=Oe.prototype.init,E.fx.step={},E.Animation=E.extend(De,{tweeners:{"*":[function(t,e){var n=this.createTween(t,e);return ct(n.elem,t,ot.exec(e),n),n}]},tweener:function(t,e){v(t)?(e=t,t=["*"]):t=t.match(U);for(var n,o=0,i=t.length;o<i;o++)n=t[o],De.tweeners[n]=De.tweeners[n]||[],De.tweeners[n].unshift(e)},prefilters:[function(t,e,n){var o,i,r,s,a,l,c,d,u="width"in e||"height"in e,h=this,f={},m=t.style,g=t.nodeType&&lt(t),p=Q.get(t,"fxshow");for(o in n.queue||(null==(s=E._queueHooks(t,"fx")).unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,h.always((function(){h.always((function(){s.unqueued--,E.queue(t,"fx").length||s.empty.fire()}))}))),e)if(i=e[o],Ne.test(i)){if(delete e[o],r=r||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!p||void 0===p[o])continue;g=!0}f[o]=p&&p[o]||E.style(t,o)}if((l=!E.isEmptyObject(e))||!E.isEmptyObject(f))for(o in u&&1===t.nodeType&&(n.overflow=[m.overflow,m.overflowX,m.overflowY],null==(c=p&&p.display)&&(c=Q.get(t,"display")),"none"===(d=E.css(t,"display"))&&(c?d=c:(ht([t],!0),c=t.style.display||c,d=E.css(t,"display"),ht([t]))),("inline"===d||"inline-block"===d&&null!=c)&&"none"===E.css(t,"float")&&(l||(h.done((function(){m.display=c})),null==c&&(d=m.display,c="none"===d?"":d)),m.display="inline-block")),n.overflow&&(m.overflow="hidden",h.always((function(){m.overflow=n.overflow[0],m.overflowX=n.overflow[1],m.overflowY=n.overflow[2]}))),l=!1,f)l||(p?"hidden"in p&&(g=p.hidden):p=Q.access(t,"fxshow",{display:c}),r&&(p.hidden=!g),g&&ht([t],!0),h.done((function(){for(o in g||ht([t]),Q.remove(t,"fxshow"),f)E.style(t,o,f[o])}))),l=Le(g?p[o]:0,o,h),o in p||(p[o]=l.start,g&&(l.end=l.start,l.start=0))}],prefilter:function(t,e){e?De.prefilters.unshift(t):De.prefilters.push(t)}}),E.speed=function(t,e,n){var o=t&&"object"==typeof t?E.extend({},t):{complete:n||!n&&e||v(t)&&t,duration:t,easing:n&&e||e&&!v(e)&&e};return E.fx.off?o.duration=0:"number"!=typeof o.duration&&(o.duration in E.fx.speeds?o.duration=E.fx.speeds[o.duration]:o.duration=E.fx.speeds._default),null!=o.queue&&!0!==o.queue||(o.queue="fx"),o.old=o.complete,o.complete=function(){v(o.old)&&o.old.call(this),o.queue&&E.dequeue(this,o.queue)},o},E.fn.extend({fadeTo:function(t,e,n,o){return this.filter(lt).css("opacity",0).show().end().animate({opacity:e},t,n,o)},animate:function(t,e,n,o){var i=E.isEmptyObject(t),r=E.speed(e,n,o),s=function(){var e=De(this,E.extend({},t),r);(i||Q.get(this,"finish"))&&e.stop(!0)};return s.finish=s,i||!1===r.queue?this.each(s):this.queue(r.queue,s)},stop:function(t,e,n){var o=function(t){var e=t.stop;delete t.stop,e(n)};return"string"!=typeof t&&(n=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,i=null!=t&&t+"queueHooks",r=E.timers,s=Q.get(this);if(i)s[i]&&s[i].stop&&o(s[i]);else for(i in s)s[i]&&s[i].stop&&Se.test(i)&&o(s[i]);for(i=r.length;i--;)r[i].elem!==this||null!=t&&r[i].queue!==t||(r[i].anim.stop(n),e=!1,r.splice(i,1));!e&&n||E.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,n=Q.get(this),o=n[t+"queue"],i=n[t+"queueHooks"],r=E.timers,s=o?o.length:0;for(n.finish=!0,E.queue(this,t,[]),i&&i.stop&&i.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===t&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;e<s;e++)o[e]&&o[e].finish&&o[e].finish.call(this);delete n.finish}))}}),E.each(["toggle","show","hide"],(function(t,e){var n=E.fn[e];E.fn[e]=function(t,o,i){return null==t||"boolean"==typeof t?n.apply(this,arguments):this.animate(Ie(e,!0),t,o,i)}})),E.each({slideDown:Ie("show"),slideUp:Ie("hide"),slideToggle:Ie("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){E.fn[t]=function(t,n,o){return this.animate(e,t,n,o)}})),E.timers=[],E.fx.tick=function(){var t,e=0,n=E.timers;for(Ee=Date.now();e<n.length;e++)(t=n[e])()||n[e]!==t||n.splice(e--,1);n.length||E.fx.stop(),Ee=void 0},E.fx.timer=function(t){E.timers.push(t),E.fx.start()},E.fx.interval=13,E.fx.start=function(){Ce||(Ce=!0,Te())},E.fx.stop=function(){Ce=null},E.fx.speeds={slow:600,fast:200,_default:400},E}(window)),Object.defineProperty(e,"__esModule",{value:!0}),function(t,e){const n=e;if(!n||!n.VERSION||!n.$)return void console.error("Loopindex Utils: window.LOOPINDEX must be properly defined");const o=t=>{const e={major:0,minor:0,build:0};if(!t||["string","number"].indexOf(typeof t)<0)return e;if(!(t=String(t||"").trim()))return e;function n(t){if(!t)return 0;const e=parseInt(t.replace(/[^\d]+/g,""));return isNaN(e)?0:e}const o=t.match(/(\d+)(\.\d+)?(\.\d+)?/);return o?{major:n(o[1]),minor:n(o[2]),build:n(o[3])}:e},i=(t,e)=>{const n=o(t),i=o(e);return Math.sign(n.major-i.major)||Math.sign(n.minor-i.minor)||Math.sign(n.build-i.build)};if(n.utils&&i("1.7.3",n.utils.VERSION)<1)return;const r=n.$,s=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,a=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d\.\%]+)\s*\)/,l=function(){const t=function(...t){return 1};return t.acceptNode=function(...t){return 1},t}(),c=new Set(["TEXTAREA","INPUT","OL","UL","TABLE","TR","IMG","SCRIPT","LINK","svg","BR"]);class d{constructor(t){this._config={log:!1,debug:!1,warn:!1,error:!0,trace:!1,prefix:"LoopIndex "},this._logs=[],this.timeout=null,t&&this.config(t)}config(t){if(t){const e={};Object.entries(this._config).forEach(([n,o])=>{const i=t[n];typeof o==typeof i&&(e[n]=i)}),r.extend(this._config,e)}return r.extend({},this._config)}ignore(){}log(...t){this._config.log&&this._log("log",Array.from(t))}error(...t){this._config.error&&this._log("error",Array.from(t))}debug(...t){this._config.debug&&this._log("log",Array.from(t))}trace(...t){if(this._config.trace){const t=Error().stack,e=t?[t.replace("Error","Debug:"),"\n"]:[];this._log("log",e.concat(Array.from(e)))}}warn(...t){this._log("warn",Array.from(t))}_log(t,e){const n=new Date,o=[n.getMinutes(),n.getSeconds(),n.getMilliseconds()].join(":");e.unshift(o+">"),this._config.prefix&&e.unshift(this._config.prefix),"error"===t||"warn"===t?console[t].apply(console,e):(this._logs.push({method:t,logs:e}),this.scheduleDump())}dump(){const t=this._logs.slice();this._logs.length=0,t.forEach((function(t){console[t.method].apply(console,t.logs)}))}scheduleDump(){this.timeout||(this.timeout=setTimeout(function(){this.timeout=null,this.dump()}.bind(this),100))}}class u{merge(t,e,o,i=!1){const r=null===o?(t,e)=>t===e:(t,e)=>t===e||t&&e&&t[o]===e[o];t=t||[];const s=[];return(e=e||[]).forEach(e=>{let o=!1;for(let s=0,a=t.length;!o&&s<a;++s){const a=t[s];r(a,e)&&(t[s]=i&&a&&e?n.$.extend(a,e):e,o=!0)}o||s.push(e)}),t.push(...s),t}firstIndex(t,e){const n=null==t?void 0:t.length;if(!n||!e)return-1;if(Array.isArray(t))return t.findIndex(e);for(let o=0;o<n;++o)if(e(t[o],o,t))return o;return-1}first(t,e){const n=this.firstIndex(t,e);return n<0?null:t[n]}remove(t,e){if(!(null==t?void 0:t.length))return Array.isArray(t)?t:[];const o=e.element,i=e.test;if(void 0!==o===Boolean(i))return n.logger.warn("provide exactly one of element/test in array remove"),t;const r=!1!==e.inPlace&&Array.isArray(t)?t:Array.from(t);let s=0;void 0!==e.from&&(e.from>=0&&e.from<r.length?s=Math.floor(e.from):n.logger.warn("Invalid from field in array remove "+e.from));const a=!1===e.all?1:r.length;if(0===s&&1===a){const t=i?r.findIndex(i):r.indexOf(o);return t>=0&&r.splice(t,1),r}for(let t=r.length-1,e=0;t>=s&&e<a;--t){(i?i(r[t],t,r):r[t]===o)&&(r.splice(t,1),++e)}return r}}class h{validateEnum(t,e,o){if(null==t)return o;const i=`Invalid config value ${t}, allowed values: ${e}`;if("string"!=typeof t)return n.logger.warn(i),o;const r=t.trim().toLowerCase();for(let t of e)if(t.trim().toLowerCase()===r)return t;return n.logger.warn(i),o}compareVersions(t,e){const n=i(t,e);return n>0?1:0===n?0:-1}parseVersion(t){return o(t)}getRealTextLength(t){if(!t)return 0;let e=t.length;for(;e&&n.utils.strings.isEmptyString(t[e-1]);)--e;return e}toMap(t,e,n){const o={};let i;const r=Boolean(e),s=Boolean(n);let a;for(let l=0,c=t&&t.length||0;l<c;++l)a=t[l],null!=a&&(i="*"===n?a:s?a[n]:1,r?o[String(a[e])]=i:o[String(a)]=1);return o}toStringMap(t,e){const n={},o=e?"upper"===e?t=>t.toUpperCase():t=>t.toLowerCase():null;for(let e=0,i=t&&t.length||0;e<i;++e)n[String(o?o(t[e]):t[e])]=1;return n}toStringArray(t,e){if(!(null==t?void 0:t.length))return[];"string"==typeof e&&(e={transform:e});let o,i="upper"===(null==e?void 0:e.transform)?String.prototype.toUpperCase:"lower"===(null==e?void 0:e.transform)?String.prototype.toLowerCase:null;const r=!1!==(null==e?void 0:e.trim);if("string"==typeof t)o=t.split(",");else{if(!Array.isArray(t))return n.logger.warn("illegal format of string array"),[];o=t}if(o.forEach((t,e)=>{null==t&&(t=""),t=String(t),r&&(t=t.trim()),i&&(t=i.apply(t)),o[e]=t}),null==e?void 0:e.unique){const t=new Set(o);return Array.from(t.values())}return o}padString(t,e,n,o){let i;i=null==t?"":String(t);const r=(n=String(n)).length,s=[i];for(let t=i.length;t<e;t+=r)o?s.push(n):s.unshift(n);return s.join("")}padNumber(t,e){return n.utils.strings.padString(t,e,"0",!1)}randomString(t){(!t||isNaN(t)||t<1)&&(t=6);const e=String((1+Math.random())*Date.now());let n=btoa(e).replace(/[^a-z]/gi,"");for(;n.length<t;)n+=n;return n.length>t&&(n=n.substring(n.length-t)),n}isEmptyString(t){let e,n=(null==t?void 0:t.length)||0;for(;n>0;)if(e=t[--n],e&&"â"!==e&&"\ufeff"!==e)return!1;return!0}getEffectiveStringLength(t){let e,n=t&&t.length||0,o=0;for(;n>0;)e=t.charCodeAt(--n),0!==e&&8203!==e&&65279!==e&&++o;return o}getEffectiveStringIndex(t,e){if(isNaN(e)||e<0)return 0;let n,o=t&&t.length||0;if(e>=o)return o;let i=0;for(let r=0;r<o;++r)if(n=t.charCodeAt(r),0!==n&&8203!==n&&65279!==n&&++i>e)return r;return o}}class f{constructor(){this._matchSelector=null}elementToHtml(t){const{el:e,xml:n,withRoot:o}=t;if(1!==(null==e?void 0:e.nodeType))return(null==e?void 0:e.data)||"";if(n){const t=new XMLSerializer,n=e=>{let n=t.serializeToString(e);return e.getAttribute("xmlns")||(n=n.replace(/\s*xmlns="[^"]+"/,"")),n};if(o)return n(e);const i=[];for(let t=e.firstChild;t;t=t.nextSibling)3===t.nodeType?i.push(t.data):1===t.nodeType&&i.push(n(t));return i.join("")}return o?e.outerHTML:e.innerHTML}attachCBToLink(t,e,o){if(!t||!e||"function"!=typeof o)return void n.logger.warn("attachCBToElement: bad input");const i=function(){t.removeEventListener("load",i),t.removeEventListener("error",r),o({url:e})};function r(n){t.removeEventListener("load",i),t.removeEventListener("error",r),o({url:e,error:String(n)||"error"})}"function"==typeof t.addEventListener?(t.addEventListener("load",i),t.addEventListener("error",r)):(t.onload=function(){i()},t.onerror=function(t){r(t)})}getElementOwnStyle(t,e){var n;const o=this.toElement(t),i=null===(n=null==o?void 0:o.style)||void 0===n?void 0:n[e];return null==i?null:i}getElementOwnIntStyle(t,e){const n=this.getElementOwnStyle(t,e);return null===n?NaN:parseInt(n)}getElementOwnFloatStyle(t,e){const n=this.getElementOwnStyle(t,e);return null===n?NaN:parseFloat(n)}static myNormalizeNode(t){if(!t||1!==t.nodeType)return;let e=t.firstChild;for(;e;){if(1===e.nodeType)f.myNormalizeNode(e);else if(3==e.nodeType){let n;for(;(n=e.nextSibling)&&3==n.nodeType;){const o=n.nodeValue;o&&(e.nodeValue=e.nodeValue+o),t.removeChild(n)}}e=e.nextSibling}}getPositioningParent(t){let e,n=this.toJQuery(t),o=n;for(;(n=n.parent()).length&&n[0].ownerDocument&&(o=n,e=o.css("position"),"relative"!==e&&"absolute"!==e&&"fixed"!==e););return o}addScriptToDocument(t,e){e=e||window.document;const o=n.utils.strings.toStringArray(t),i={ok:!0,failed:[],loaded:[]};return new Promise(r=>{const s=o=>{if(!(null==o?void 0:o.length))return r(i);const a=o[0];try{if(o=o.slice(1),!a)return n.logger.warn("null script found in addScriptToDocument input"),s(o);const t=e.createElement("script");t.setAttribute("type","text/javascript"),this.attachCBToLink(t,a,t=>{t.error?(i.ok=!1,i.failed.push({url:a,error:t.error}),n.logger.error(`Error loading script ${a}: ${t.error}`)):i.loaded.push(a),s(o)}),t.setAttribute("src",a),document.head.appendChild(t)}catch(e){n.logger.error(`Exception While loading script ${t}\n${e}`),i.ok=!1,i.failed.push({url:a,error:String(e)}),r(i)}};s(o)}).then(t=>t)}get NodeIteratorUniversalFunction(){return l}isContentEditable(t,e,n){let o;for(let n=t&&t.parentNode;n&&n!==e;n=n.parentNode)if(1===n.nodeType&&(o=n.getAttribute("contenteditable"),o)){if(o=o.toLowerCase(),"true"===o)return!0;if("false"===o)return!1}return n}createTreeWalker(t,e,o){const i=t&&t.ownerDocument;if(!i)return null;let r=o?function(){const t=t=>o(t);return t.acceptNode=()=>1,t}():n.browser.msie?l:null;return i.createTreeWalker(t,e,r,!1)}createNodeIterator(t,e,o){const i=t&&t.ownerDocument;if(!i)return null;let r=o?function(){const t=t=>o(t);return t["]acceptNode"]=()=>1,t}():n.browser.msie?l:null;return i.createNodeIterator(t,e,r,!1)}getNodeIndex(t){if(!t)return-1;let e=0;for(;t=t.previousSibling;)++e;return e}insertNodeAt(t,e,n){return!(!t||!e||1!==e.nodeType||n<0)&&(e.insertBefore(t,e.childNodes[n]),!0)}normalizeNode(t){return t?n.browser.msie||"function"!=typeof t.normalize?(f.myNormalizeNode(t),t):(t.normalize(),t):null}isEmptyTextNode(t){if(!t||3!==t.nodeType)return!1;const e=t;return 0===e.length||n.utils.strings.isEmptyString(e.nodeValue)}getNodeLength(t){const e=t&&t.nodeType;return 1===e?t.children.length:3===e?t.length:0}getNodeTextContent(t){return r(t).text()}isOnlyChild(t){const e=t&&t.parentNode;return Boolean(e&&e.firstChild===t&&e.lastChild===t)}insertAfter(t,e,n){return t?(n=n||e&&e.parentNode,e&&e.parentNode!==n&&(e=null),n?e?n.insertBefore(t,e.nextSibling):n.insertBefore(t,n.firstChild):void 0):null}contents(t){return r.makeArray(r(t).contents())}extractContent(t){for(var e,n=document.createDocumentFragment();e=t.firstChild;)n.appendChild(e);return n}toElement(t){return t&&"object"==typeof t?t[0]&&"string"==typeof t.jquery?t[0]:1===t.nodeType?t:null:null}toNode(t){return t&&"object"==typeof t?t[0]&&"string"==typeof t.jquery?t[0]:1===t.nodeType||3===t.nodeType?t:null:null}toJQuery(t,e=!1){if(!t)return n.$("");let o=t;return o instanceof n.$||(o=n.$(t)),!e&&o.length>1&&(o=o.eq(0)),o}getRealTextLength(t){return t&&t.data?n.utils.strings.getRealTextLength(t.data):0}isDescendantOf(t,e){if(!e||!t)return!1;const o="string"==typeof e&&e;if(!o){const t=e;if(9===t.nodeType)e=e.body;else if(1!==t.nodeType)return!1}try{for(;t&&t.parentNode;){if(o){if(n.utils.dom.matchesSelector(t.parentNode,o))return!0}else if(t.parentNode===e)return!0;t=t.parentNode}}catch(t){}return!1}clearNodeBackgroundImage(t){t&&t.style&&t.style["background-image"]&&(t.style["background-image"]=null)}getElementPageOffset(t,e){if(!t||!t.getBoundingClientRect)return{top:0,left:0};const n=t.getBoundingClientRect(),o=t.ownerDocument,i=o.defaultView,r=o.body,s=o.documentElement,a=i.pageYOffset||s.scrollTop||i.scrollY||r.scrollTop||0,l=i.pageXOffset||s.scrollLeft||i.scrollX||r.scrollLeft||0,c=s.clientTop||r.clientTop||0,d=s.clientLeft||r.clientLeft||0,u=n.top+a-c,h=n.left+l-d,f={top:Math.round(u),left:Math.round(h)};return e&&(f.top+=r.scrollTop||0,f.left+=r.scrollLeft||0),f}compareNodePosition(t,e){if(t===e)return 0;var n=t.compareDocumentPosition(e);return 4&n||8&n?-1:1}forAllTextChildren(t,e){if(t&&e&&1===t.nodeType)for(let n=t.firstChild,o=n&&n.nextSibling;n;n=o,o=n&&n.nextSibling)1===n.nodeType?this.forAllTextChildren(n,e):3===n.nodeType&&e(n)}getFirstNodeInRange(t){const e=t&&t.startContainer;if(!e)return null;if(3===e.nodeType)return e;var o=this.getNthChild(e,t.startOffset);if(o)return o;const i=n.utils.dom.createNodeIterator(e,NodeFilter.SHOW_TEXT||NodeFilter.SHOW_ELEMENT);return null==i?void 0:i.nextNode()}getLastNodeInRange(t){const e=t&&t.endContainer;if(!e)return null;if(3===e.nodeType)return e;var o=this.getNthChild(e,t.endOffset-1);if(o)return o;const i=n.utils.dom.createNodeIterator(e,NodeFilter.SHOW_TEXT||NodeFilter.SHOW_ELEMENT);return null==i?void 0:i.previousNode()}hasTextSelection(t){if(!t||t.collapsed)return!1;if(3===t.startContainer.nodeType&&t.startOffset<t.startContainer.length)return!0;if(3===t.endContainer.nodeType&&t.endOffset<t.endContainer.length)return!0;let e=!1;return this.walkRange(t,(t,n)=>!(3===t.nodeType&&t.length>0)||(e=!0,!1)),e}getNthChild(t,e){if(!t||1!==t.nodeType)return null;for(let n=t.firstChild;n&&e>=0;n=n.nextSibling,--e)if(0===e)return n;return null}getSelectedTextNodes(t){if(!t||t.collapsed)return[];const e=[];return this.walkRange(t,(t,n)=>{if(3===t.nodeType){const o=this.processTextNode(t,n);o&&e.push(o)}return!0}),e}extractTextNode(t){if(!t||!t.node)return null;if(!t.partial)return t.node;let e=t.node;return t.end<e.length&&e.splitText(t.end),t.start>0&&(e=e.splitText(t.start)),e}extractInlineNode(t){let e=null==t?void 0:t.node;if(3!==(null==e?void 0:e.nodeType))return n.logger.warn("extractInlinecontent: null or not text node"),null;const o=(t=>{for(;t.parentNode&&f.INLINE_RE.test(n.$(t.parentNode).css("display"));)t=t.parentNode;return t})(e);if(o===e)return n.utils.dom.extractTextNode(t);const i=o,r=n.utils.dom;if(!t.partial)return r.splitNode(i,t.node,t.end);let s=i;if(t.end<e.length){s=r.splitNode(s,e,t.end);let n=s.lastChild;for(;n&&1===n.nodeType;)n=n.lastChild;e=3===(null==n?void 0:n.nodeType)?n:null}return t.start>0&&e&&r.splitNode(s,e,t.start),s}splitNode(t,e,o){if(0===o&&(e===t||e===t.firstChild))return t;if(o>=n.utils.dom.getNodeLength(e)&&(e===t||e===t.lastChild))return t;const i=t.parentNode,r=n.utils.dom.getNodeIndex(t),s=e.ownerDocument.createRange();s.setStart(i,r),s.setEnd(e,o);const a=s.extractContents();return i.insertBefore(a,t),t.previousSibling||t}walkRange(t,e){if(!t||t.collapsed)return;let o;const i=this.getFirstNodeInRange(t),r=this.getLastNodeInRange(t);if(!i||!r)return;let s=!1,a=!1;const l=n.utils.dom.createNodeIterator(t.commonAncestorContainer,NodeFilter.SHOW_ALL);if(l)for(;(o=l.nextNode())&&(!a||n.utils.dom.isDescendantOf(o,r));){if(!s){if(o!=i)continue;s=!0}if(!e(o,t))return;o===r&&(a=!0)}}processTextNode(t,e){let n;if(!t||3!==t.nodeType||!(n=t.length))return null;const o={node:t,start:0,end:n,partial:!1};if(t===e.startContainer&&e.startOffset>0){if(e.startOffset>=n)return null;o.partial=!0,o.start=e.startOffset}return t===e.endContainer&&e.endOffset<n&&(o.partial=!0,o.end=e.endOffset),o}hasClass(t,e){if(!t||1!==t.nodeType)return!1;const n=t,o=n.classList||n.className&&n.className.split(/\s/);if(o&&o.length)for(let t=o.length-1;t>=0;--t)if(o[t]===e)return!0;return!1}getScrollParent(t){const e=r(t.node),n=e.css("position"),o="absolute"===n,i=t.hidden?/(auto|scroll|hidden)/:/(auto|scroll)/,s=e.parents().filter((function(){const t=r(this);return(!o||"static"!==t.css("position"))&&i.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))})).eq(0);return"fixed"!==n&&s.length?s[0]:e[0].ownerDocument||document}matchesSelector(t,e){if(!t||1!==t.nodeType||!e)return!1;if(!this._matchSelector){const e=t;let n;n="function"==typeof e.matches?(t,e)=>t.matches(e):"function"==typeof e.msMatchesSelector?(t,e)=>t.msMatchesSelector(e):"function"==typeof e.webkitMatchesSelector?(t,e)=>t.webkitMatchesSelector(e):(t,e)=>r(t).is(e),this._matchSelector=n}return this._matchSelector(t,e)}}f.INLINE_RE=/inline/i;class m{constructor(t){if(this._doc=t,!t)throw new Error("CSS Loader: null document");this._styleId=n.utils.strings.randomString(8),this._loadedStyleIds={}}get document(){return this._doc}getOwnStyleSheet(t){let e=this._doc.getElementById(this._styleId);return!e&&t&&(e=this._doc.createElement("style"),e.appendChild(this._doc.createTextNode("")),e.setAttribute("id",this._styleId),this._loadedStyleIds[this._styleId]=!0,this.$head.append(e)),e&&e.sheet}loadCSSString(t,e){if(!(t=null==t?void 0:t.trim()))return;const n="li-style-"+t.split("").reduce((t,e,n)=>t+n*e.charCodeAt(0),0),o=this.$head;if(o.find(`style[id='${n}']`).length)return;const i=this._doc.createElement("style");i.id=n,this._loadedStyleIds[n]=!0,i.appendChild(this._doc.createTextNode(t)),o.append(i)}loadCSS(t,e){const o=this.$head,i=this._doc,s=n.utils.strings.toStringArray(t),a={ok:!0,loaded:[],failed:[]},l=({url:t,error:e})=>{e?(a.ok=!1,a.failed.push({url:t,error:e}),n.logger.warn("Error loading css "+t)):a.loaded.push(t),c()},c=()=>{if(!s.length||!a.ok)return void(e&&setTimeout(()=>e(a),1));const t=s.shift();if(!t)return c();const d=`_loopindex-${t.replace(/[^0-9a-z]+/gi,"_")}_`;if(0===r(o).find(`link[data-loopindex-id='${d}']`).length){const e=i.createElement("link"),s=r(e);n.utils.dom.attachCBToLink(e,t,l),s.attr({rel:"stylesheet",type:"text/css","data-loopindex-id":d,href:t}),this._loadedStyleIds[d]=!0,o.append(s)}else l({url:t})};c()}addRule(t,e){if(!e||"object"!=typeof e)return;const o=this.getOwnStyleSheet(!0);if(!o)return void n.logger.warn("LoopIndex CSSLoader cannot create stylesheet");const i=o.rules&&o.rules.length||0,r=this._makeRule(e);"function"==typeof o.addRule?o.addRule(t,r,i):"function"==typeof o.insertRule?o.insertRule(`${t} ${this._makeRule(e)} }`,o.rules&&o.rules.length||0):n.logger.error("CSSLoader addRule: no matching function")}reset(){const t=this.getOwnStyleSheet(!1);if(t&&t.deleteRule)for(let e=t.cssRules.length-1;e>=0;--e)t.deleteRule(e)}dispose(){if(!this._doc)return;const t=this.$head;Object.keys(this._loadedStyleIds).forEach(e=>{setTimeout(()=>{try{t.find("#"+e).remove()}catch(t){}},0)}),this._loadedStyleIds={},this._doc=null}get $head(){return n.$(this._doc&&(this._doc.head||this._doc.getElementsByTagName("head")[0]))}_makeRule(t){return Object.keys(t||{}).map(e=>`${e}: ${t[e]};`).join("\n")}}class g{logEditorEvents(t,e,o,i){let r=e&&void 0!==i?{log:i,editor:e,exclude:o,plugin:t}:t;const s=r.editor,a=r.method||"fire",l=r.plugin;if(o=n.utils.strings.toStringArray(r.exclude),!s||!l)return n.logger.warn("logEditorEvents: missing params");if(!s[a])return n.logger.warn("logEditorEvents: editor doesn't include method "+a);if(Boolean(r.log)!==Boolean(l.savedEditorFireMethod))if(r.log){l.savedEditorFireMethod=s[a];const t=o.length?new RegExp(o.join("|"),"i"):/mouse|selection|click|focus|undo|redo|snapshot|resolvename/i,e=function(e){return!e||t.test(e)};s[a]=(...t)=>{var o;return e(t[0])||n.logger.debug("Editor event "+t[0]),null===(o=l.savedEditorFireMethod)||void 0===o?void 0:o.apply(s,t)}}else s[a]=l.savedEditorFireMethod,l.savedEditorFireMethod=null}}class p{constructor(){this._map=new Map,this._items=[]}get(t){var e,n;return null!==(n=null===(e=this._map.get(t))||void 0===e?void 0:e.item)&&void 0!==n?n:null}get length(){return this._items.length}hasId(t){return this._map.has(t)}clear(){return this._items.length=0,this._refresh(),this}firstIndex(t){for(let e=0,n=this.length;e<n;++e)if(t(this._items[e].item,e))return e;return-1}first(t){const e=this.firstIndex(t);return e>=0?this._items[e].item:null}filter(t){return this._items.reduce((e,n,o)=>(t(n.item,o)&&e.push(n.item),e),[])}count(t){let e=0;for(let n=0,o=this._items.length;n<o;++n)t(this._items[n].item,n)&&e++;return e}map(t){return this._items.map((e,n)=>t(e.item,n))}get asMap(){return this._items.reduce((t,e)=>(t.set(e.id,e.item),t),new Map)}get asObject(){const t={};return this._map.forEach((e,n)=>{t[n]=e}),t}get items(){return this._items.map(t=>t.item)}getItemIndex(t){var e;const n=this._map.get(t);return null!==(e=null==n?void 0:n.index)&&void 0!==e?e:-1}getAt(t){const e=this._validateIndex(t,!1);return e.error?(n.logger.error("getAt: "+e.error),null):this._items[e.index].item}move(t,e){const o=t?this._map.get(t):null;if(!o)return n.logger.error("maparray move: unkonw id "+t),this;const i=this._validateIndex(e,!1);if(i.error)return n.logger.error("maparray move: invalid index "+e),this;if(o.index!==i.index){const e=this._items[o.index];this._items.splice(o.index,1),this._items.splice(i.index,0,e),this._map.set(t,{item:o.item,index:i.index})}return this}moveBefore(t,e){if(!t||!e||t===e)return n.logger.error(`moveBefore: invalid input ${t}, ${e}`),!1;const o=this._map.get(t),i=this._map.get(e);if(!o||!i)return n.logger.error(`moveBefore: can't find items ${t} and/or ${e}`),!1;const r=i.index-1;if(o.index===r)return!1;let s=o.index<r?1:0;return this._items.splice(o.index,1),this._items.splice(i.index-s,0,{item:o.item,id:t}),this._refresh(),!0}moveAfter(t,e){return this.moveBefore(e,t)}push({item:t,id:e}){return this.add({item:t,id:e,index:this.length})}add({item:t,id:e,index:n,replace:o}){if(!t||!e)throw new Error("ArrayMap add: null element and/or id");if(!o&&this.get(e))throw new Error(`Element with id ${e} already in ArrayMap`);(void 0===n||isNaN(n))&&(n=this.length);const i=this._validateIndex(n,!0);if(i.error)throw new Error(`ArrayMap add: illegal index ${n} for id ${e}`);const r={id:e,item:t};return 0===(n=i.index)?this._items.unshift(r):n===this._items.length?this._items.push(r):this._items.splice(n,0,r),this._refresh(),this}removeById(t){const e=this._map.get(t);return e?(this._items.splice(e.index,1),this._refresh(),this):(n.logger.warn("ArrayMap.removeById: no item with id "+t),this)}forEach(t){const e=this._items.slice();for(let n=0,o=e.length;n<o;++n){const o=e[n];if(this.hasId(o.id)){if(!1===t(e[n].item,n))break}}}removeByIndex(t){const e=this._validateIndex(t,!1);return e.error?n.logger.error("Arraymap remove by index: "+e.error):(this._items.splice(e.index,1),this._refresh()),this}_refresh(){this._map.clear(),this._items.forEach((t,e)=>{this._map.set(t.id,{item:t.item,index:e})})}_validateIndex(t,e){const n=this._items.length-(e?0:1);return!isNaN(t)&&t>=0&&t<=n?{error:"",index:Math.floor(t)}:{error:"invalid index "+t}}}class v extends p{constructor(t){super(),this.idGet=t}pushItem(t){return this.addItem({item:t,index:this.length})}addItem(t){return this.add(Object.assign(Object.assign({},t),{id:this.idGet(t.item)}))}removeItem(t){return this.removeById(this.idGet(t))}}const _=/\[\[([^\]]+)\]\]/,y=t=>t?_.test(t)?t.replace(_,"$1"):t:"";class b{constructor(t,e){this.owner=t,this.domain=e.domain,this._locale=e.locale,this._localizer=t.getLocalizer(this.domain,this._locale)}get locale(){return this._locale}loadLocale(t){return this.owner.loadLocale(this.domain,t).then(e=>(e||(this._locale=t,this._localizer=this.owner.getLocalizer(this.domain,t)),e))}localizeString(t){return this._localizer(t)}localizeUI(t){const e=n.utils.dom.toJQuery(t);if(!(null==e?void 0:e.length))return e;const o=(t,...e)=>this._localizer(e[0]),i=(t,e)=>{const n="data-li-"+e,i="text"===e,r=t.getAttribute(n),s=r||(i?t.textContent:t.getAttribute(e));if(!s)return;if(!_.test(s))return void(s||(i?t.textContent=r:t.setAttribute(e,String(r))));let a=s;do{a=a.replace(_,o)}while(_.test(a));t.setAttribute(n,s),i?t.textContent=a:t.setAttribute(e,a)};return e.each((t,n)=>{i(n,"title"),i(n,"placeholder"),(t=>{if(1!==(null==t?void 0:t.nodeType))return!1;if(c.has(t.nodeName))return!1;let e=!1;for(let n=t.firstChild;n;n=n.nextSibling){if(3!==n.nodeType)return!1;e=!0}return e})(n)?i(n,"text"):e.children().each((t,e)=>{1!==e.nodeType||b.FINAL_TAGS.has(e.nodeName)||this.localizeUI(e)})}),e}}b.FINAL_TAGS=new Set(["svg","path","IMG","BR"]);class w{constructor(t){const e=this._dictionaries=new Map;t.locales.forEach(t=>e.set(t,{status:"none",dictionary:new Map})),this.assetPath=t.assetPath,this.defaultLocale=t.defaultLocale}isLoading(t){var e;return"loading"===(null===(e=this._dictionaries.get(t))||void 0===e?void 0:e.status)}isLoaded(t){var e;return"loaded"===(null===(e=this._dictionaries.get(t))||void 0===e?void 0:e.status)}getStatus(t){return this._dictionaries.get(t).status}setStatus(t,e){const n=this._dictionaries.get(t);this._dictionaries.set(t,{status:e,dictionary:n.dictionary})}setLoading(t){const e=this._dictionaries.get(t);this._dictionaries.set(t,{dictionary:e.dictionary,status:"loading"})}hasLocale(t){return this._dictionaries.has(t)}hasDictionary(t){var e;return"loaded"===(null===(e=this._dictionaries.get(t))||void 0===e?void 0:e.status)}getDictionary(t){const e=this._dictionaries.get(t);return(null==e?void 0:e.dictionary)||null}load(t,e,n){if(!e||"object"!=typeof e)return;const o=(t,e,n)=>{if(!e||"object"!=typeof e)return;const i=t?t+".":"";Object.keys(e).forEach(t=>{const r=e[t],s=typeof r;"string"===s||"number"===s||"boolean"===s?n.set(`${i}${t}`,String(r)):o(`${i}${t}`,r,n)})},i=this._dictionaries.get(t),r=i.dictionary;o("",e,r),this._dictionaries.set(t,{status:n?"loaded":i.status,dictionary:r})}}class A{constructor(){this._domainMap=new Map}hasDomain(t){return this._domainMap.has(t)}defineDomain({domain:t,locales:e,assetPath:o,defaultLocale:i}){if(this._domainMap.has(t))return n.logger.warn(`Localizer: client ${t} already defined`),this;if(!i||"string"!=typeof i)throw new Error("Localizer createClient: illegal default language "+i);let r=i.trim().toLowerCase();if(0===(e=n.utils.strings.toStringArray(e,{unique:!0,transform:"lower"})).length)throw new Error("Localizer createClient: no locales provided");if(e.indexOf(r)<0)if(e.indexOf(r.substring(0,2))>=0)r=r.substring(0,2);else{if(!(e.indexOf("en")>=0))throw new Error(`Localizer createClient: default language ${i} not found in ${e}`);n.logger.warn(`Setting default locale to English, locale ${i} not found`),r="en"}const s=new w({assetPath:o,locales:e,defaultLocale:r});return this._domainMap.set(t,s),this}loadLocales(t,e){if(!e||"object"!=typeof e)return n.logger.error("Load dictionary: null or invalid dictionaries object"),this;if(Array.isArray(e))return n.logger.error("Load dictionary: dictionaries can't be an array"),this;const o=this._domainMap.get(t);return o?(Object.entries(e).forEach(([t,e])=>{const i=this._validateLocale(o,t,!1);if(!i)return n.logger.warn("load locales: skipping unknown locale "+t);o.load(i,e,!1)}),this):(n.logger.error("Unknown domain "+t),this)}loadLocale(t,e){const o=this._domainMap.get(t);return o?(e=this._validateLocale(o,e),o.isLoaded(e)?Promise.resolve(""):o.isLoading(e)?this._waitFor(o,e):new Promise(i=>{o.setLoading(e);const r=n.utils.joinPath(o.assetPath,e+".json");fetch(r,{method:"GET"}).then(t=>t.json()).then(n=>n&&"object"==typeof n?(o.load(e,n,!0),i("")):i(`Invalid data in domain ${t} locale ${e}`)).catch(t=>{o.setStatus(e,"error"),i(String(t))})}).then(t=>t)):Promise.resolve(`Cannot load locale ${e} in unknown domain ${t}`)}createClient(t,e){const n=this._domainMap.get(t);if(!n)throw new Error("Unknown localization client "+t);return new b(this,{domain:t,locale:e||n.defaultLocale})}getLocalizer(t,e){const n=y;if(!t||!e)return n;const o=this._domainMap.get(t);if(!o)return n;e=this._validateLocale(o,e);const i=o.getDictionary(e);return i?t=>{const n=y(t);let r=i.get(n);if(r)return r;if(e!==o.defaultLocale){const t=o.getDictionary(o.defaultLocale);r=null==t?void 0:t.get(n)}return r||n}:n}_waitFor(t,e){return new Promise(n=>{let o,i=0;const r=t=>(clearInterval(o),n(t||""));o=setInterval(()=>t.isLoading(e)?++i>50?r("timed out"):void 0:r(),100)})}_validateLocale(t,e,n=!0){return e?(e=e.trim().toLowerCase(),t.hasLocale(e)||e.length>2&&(e=e.substring(0,2),t.hasLocale(e))?e:n?t.defaultLocale:""):t.defaultLocale}_getBaseLocale(t){return t.trim().toLowerCase().substring(0,2)}}class E{constructor(){this.VERSION="1.7.3",this.LocaleServer=new A,this.dom=new f,this.strings=new h,this.array=new u,this.pluginUtils=new g}createArrayMap(){return new p}createTypedArrayMap(t){return new v(t)}clearObject(t){return t?(Object.keys(t).forEach(e=>{try{delete t[e]}catch(t){}}),t):{}}getRelativeTimezoneOffset(t){if(!t)return 0;try{const e=new Date,n=e.toLocaleString("en-us",{timeZone:t});return Date.parse(n)-e.getTime()}catch(e){return n.logger.error("convertDateToTimezone",t,e),0}}convertDateToTimezone(t,e){if(t=t||new Date,!e)return t;try{const o=n.utils.getRelativeTimezoneOffset(e);return new Date(t.getTime()+o)}catch(o){return n.logger.error("convertDateToTimezone",e,o),t}}get CSSLoader(){return m}intensifyColor(t,e){const n=t.match(s);let o=n?null:t.match(a);const i=o||o;let r,l=10;i?r=[i[1],i[2],i[3]]:(l=16,(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),r=[t.substr(0,2),t.substr(2,2),t.substr(4,2)]),e=e||0;const c=[];let d;for(let t=0;t<3;t++)d=parseInt(r[t],l),c.push(Math.round(Math.min(Math.max(0,d+d*e),255)));return n?`rgb(${c[0]},${c[1]},${c[2]})`:o?`rgba(${c[0]},${c[1]},${c[2]}, ${o[4]})`:"#"+c.map(t=>t<16?"0"+t.toString(16):t.toString(16)).join("")}getUniqueNumber(){return E.nextId++}getUniqueId(t,e){return`${t}${n.utils.getUniqueNumber()}${e||""}`}yes(...t){return!0}no(...t){return!1}always(t){return function(...e){return t}}noop(...t){}getCurrentScriptPath(){const t=n.utils.getCurrentScriptURL();if(!t)return null;const e=/^(.+\/)[^\/]+\.js/i.exec(t);return e&&e[1]}getCurrentScriptURL(){try{const t=document&&document.currentScript;if(t)return t.src;const e=window.import,n=e&&e.meta;return void 0!==n&&n.url?n.url:null}catch(t){return null}}scrollToElement(t,e){const o=n.utils.dom.toJQuery(t);return o&&o.scrollintoview(e)}joinPath(...t){const e=t.length-1,n=t.map((t,n)=>t?(0!==n&&(t=t.replace(/^[\s\/]+/,"")),n<e&&(t=t.replace(/[\s\/]+$/,"")),t):"").filter(Boolean).join("/").split("/"),o=[];for(let t=0,e=n.length-1;t<=e;t++){const e=n[t];"."!==e&&(".."===e&&o.length>0?o.length--:o.push(e))}return o.join("/")}isAbsoluteUrl(t){return!!t&&("/"===t[0]||/^[a-z]+\:\/\//i.test(t)||/^data:/.test(t))}}E.nextId=Math.round(Date.now()%1e5);class C{constructor(){this._timeoutMap={}}clear(){Object.keys(this._timeoutMap).forEach(t=>this.removeTimer(t))}setTimer(t,e,n){const o="temp-"+Date.now()*Math.random();return this.createTimer(o,{callback:t,timeoutMSecs:e,repeatCount:n,autoDispose:!0}).start()}createTimer(t,e){if(!t)throw new Error("setTimer requires a timer id");let n=this._timeoutMap[t];if(n)n.update(e);else{if(!e.callback)throw new Error("setTimer: callback required");const o=this.upgradeOptions(e);n=this._timeoutMap[t]=new N(o,()=>{delete this._timeoutMap[t]})}return n}startTimer(t){const e=this._timeoutMap[t];return e&&e.start()}stopAll(){Object.keys(this._timeoutMap).forEach(t=>this.stopTimer(t))}stopTimer(t){const e=this._timeoutMap[t];return e&&e.stop(),e}removeTimer(t){const e=this._timeoutMap[t];return e&&e.dispose(),Boolean(e)}elapsed(t){const e=this._timeoutMap[t];return e&&e.elapsed||0}upgradeOptions(t){return n.$.extend({},{repeatCount:1,timeoutMSecs:-1,maxTimeSecs:0,autoDispose:!0},t)}}C.FOREVER=999999999;class N{constructor(t,e){if(this.done=e,this._elapsed=0,this._callCount=0,this._startTime=0,this._stop=null,!t.callback)throw new Error("Timeout constructor: callback required");this._options=n.$.extend({},t),this._callback=()=>{this._elapsed=Date.now()-this._startTime,this._options.maxTimeSecs>0&&1e3*this._options.maxTimeSecs<this._elapsed&&this.stop(),this._options.callback(this);const t=this._options.repeatCount;this._options&&(t<=0||++this._callCount>=t)&&(this.stop(),this._options.autoDispose&&this.dispose())}}get isRunning(){return Boolean(this._stop)}dispose(){if(this.stop(),Object.keys(this._options).forEach(t=>delete this._options[t]),this._callback=null,this.done){const t=this.done;this.done=null,t()}}start(){if(this.isRunning)return this;let t;this.reset();const e=this._options.repeatCount;return(isNaN(e)||"number"!=typeof e||e<0)&&(this._options.repeatCount=1),this._startTime=Date.now(),t=setInterval(this._callback,this._options.timeoutMSecs),this._stop=()=>clearInterval(t),this}reset(){return this._elapsed=0,this._callCount=0,this.isRunning&&(this.stop(),this.start()),this}stop(){if(this._stop){const t=this._stop;this._stop=null,t()}return this}update(t){const e=this._options;return t.repeatCount>0&&(e.repeatCount=t.repeatCount),t.timeoutMSecs>=0&&(e.timeoutMSecs=t.timeoutMSecs),t.maxTimeSecs>=0&&(e.maxTimeSecs=t.maxTimeSecs),void 0!==t.data&&(e.data=t.data),this}get elapsed(){return this._elapsed}get isRepeating(){return this._options.repeatCount>0}}const S={mixin:function(t){const e={};let o=!1;const i=function(t){return e[t]=e[t]||[]},s=function(){const t=e;Object.keys(t).forEach(e=>{const n=t[e];(null==n?void 0:n.length)||delete t[e]})},a=function(t,...e){if(!t)return void n.logger.warn("cannot trigger empty event");if(o)return;const r=i(t),a=r.length?r.slice():r,l=[];a.forEach(t=>{t.muted||t.callback.apply(t.scope,e),t.options&&t.options.count&&(--t.options.count,t.options.count<=0&&l.push(t))}),l.length&&(l.forEach((function(t){r.splice(r.indexOf(t),1)})),s())},l={on:function(t,e,o,s){if(!t)return n.logger.warn("cannot register to empty event"),this;if(r.isArray(t))t.forEach(t=>{this.addListener(t,e,o,s)});else if("function"==typeof e){i(t).push({scope:o,muted:!1,callback:e,options:s})}else n.logger.error("events mixin addListener: bad callback",e);return this},off:function(t,n){if(!t&&!n)return this.removeAllListeners();if(!n&&t&&"object"==typeof t&&(n=t,t=null),t&&t instanceof Array)return t.forEach(t=>{this.off(t,n)}),this;function o(t,e){return t&&(!n||t.scope===n||t.callback===n)}const i=e;return Object.keys(i).forEach(e=>{t&&t!==e||i[e].filter(o).forEach(t=>{const n=i[e].indexOf(t);n>=0&&i[e].splice(n,1)})}),s(),this},removeAllListeners:function(){return Object.keys(e).forEach(t=>delete e[t]),this},muteListener:function(t,n){if(!t)return this;n=Boolean(n);const o=e;return Object.keys(o).forEach(e=>{const i=o[e];i&&i.forEach(e=>{e&&e.scope===t&&(e.muted=n)})}),this},muteEvents:function(){return o=!0,this},unmuteEvents:function(){return o=!1,this},once:function(t,e,n,o){return(o=o||{}).count=1,this.on(t,e,n,o)},trigger:function(t,...e){return a.apply(this,[t].concat(e)),this}};Object.keys(l).forEach(e=>{const n=l[e];"function"==typeof n&&Object.defineProperty(t,e,{value:n,enumerable:!0,writable:!1,configurable:!1})});const c={fire:l.trigger,removeListener:l.off,bind:l.on,addListener:l.on};return Object.keys(c).forEach(e=>{Object.defineProperty(t,e,{enumerable:!0,value:c[e],writable:!1,configurable:!1})}),t}};!function(){if(!r||!r.fn)return console.warn("Cannot define scrollintoview: no $");if(r.fn.scrollintoview)return console.warn("$ scrollintoview already defined");var t={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}};const e={duration:"fast",direction:{x:!1,y:!0},margin:0},o=/^(?:html)$/i,i=function(t,e){var n;const o=null===(n=null==t?void 0:t.ownerDocument)||void 0===n?void 0:n.defaultView;if(!o)return{top:0,left:0,bottom:0,right:0,vertical:0,horizontal:0};const i=Boolean(o.getComputedStyle);e=e||i?o.getComputedStyle(t,null):t.currentStyle;const s=!!i,a={top:parseFloat(s?e.borderTopWidth:r.css(t,"borderTopWidth"))||0,left:parseFloat(s?e.borderLeftWidth:r.css(t,"borderLeftWidth"))||0,bottom:parseFloat(s?e.borderBottomWidth:r.css(t,"borderBottomWidth"))||0,right:parseFloat(s?e.borderRightWidth:r.css(t,"borderRightWidth"))||0};return{top:a.top,left:a.left,bottom:a.bottom,right:a.right,vertical:a.top+a.bottom,horizontal:a.left+a.right}},s=function(t,e){const n=r(window),s=t[0],a=o.test(s.nodeName);return{border:a?{top:0,left:0,bottom:0,right:0}:i(s,null),scroll:{top:(a?n:t).scrollTop(),left:(a?n:t).scrollLeft()},scrollbar:{right:a?0:t.innerWidth()-s.clientWidth,bottom:a?0:t.innerHeight()-s.clientHeight},rect:function(){const t=s.getBoundingClientRect(),n=2*(e+5),o=t.width>n?e:0,i=t.height>n?e:0;return{top:a?i:t.top+i,left:a?o:t.left+o,bottom:a?s.clientHeight-i:t.bottom-i,right:a?s.clientWidth-o:t.right-o}}()}};function a(t){if(t.scrollers.length<1)return this;const e=t.scrollers.slice();let n=r(e.pop());const i=t.$element,l=s(i,0),c=s(n,t.margin),d={top:l.rect.top-(c.rect.top+c.border.top),bottom:c.rect.bottom-c.border.bottom-c.scrollbar.bottom-l.rect.bottom,left:l.rect.left-(c.rect.left+c.border.left),right:c.rect.right-c.border.right-c.scrollbar.right-l.rect.right},u={};return t.direction.y&&(d.top<0?u.scrollTop=c.scroll.top+d.top:d.top>0&&d.bottom<0&&(u.scrollTop=c.scroll.top+Math.min(d.top,-d.bottom))),t.direction.x&&(d.left<0?u.scrollLeft=c.scroll.left+d.left:d.left>0&&d.right<0&&(u.scrollLeft=c.scroll.left+Math.min(d.left,-d.right))),r.isEmptyObject(u)?r.isFunction(t.complete)&&t.complete.call(n[0]):(o.test(n[0].nodeName)&&(n=r(n[0].ownerDocument).find("html,body")),n.animate(u,t.duration).eq(0).queue((function(o){e.length<1?r.isFunction(t.complete)&&t.complete.call(n[0]):a.call(this,Object.assign(Object.assign({},t),{scrollers:e})),o()}))),this}r.fn.extend({scrollintoview:function(o){const i=r.extend({},e,o),s=Object.assign({},i);s.direction="string"==typeof i.direction?t[i.direction.toLowerCase()]:i.direction;const l=s.direction.x?s.direction.y?"both":"horizontal":s.direction.y?"vertical":"";if(!l)return n.logger.warn("scrollintoview with no direction"),this;s.dirStr=l,s.margin&&!isNaN(s.margin)||(s.margin=0);const c=(s.$element=this.eq(0)).parents(":scrollable("+l+")").toArray().reverse();return c.length<1?this:a.call(this,Object.assign(Object.assign({},s),{scrollers:c}))}});const l={auto:!0,scroll:!0,visible:!1,hidden:!1};r.extend(r.expr[":"],{scrollable:function(e,n,i,r){const s=t[i&&"string"==typeof i[3]&&i[3].toLowerCase()]||t.both,a=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle,c={x:l[a.overflowX.toLowerCase()]||!1,y:l[a.overflowY.toLowerCase()]||!1,isRoot:o.test(e.nodeName)};if(!c.x&&!c.y&&!c.isRoot)return!1;const d={height:{scroll:e.scrollHeight,client:e.clientHeight},width:{scroll:e.scrollWidth,client:e.clientWidth},scrollableX:function(){return(c.x||c.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(c.y||c.isRoot)&&this.height.scroll>this.height.client}};return s.y&&d.scrollableY()||s.x&&d.scrollableX()}})}();const T=new class{constructor(){this.msie=!1,this.type="unknown",this.webkit=!1,this.chrome=!1,this.safari=!1,this.firefox=!1,this.webkitType=null;const t=navigator.userAgent.toLowerCase(),e=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}}(t);e.browser&&(this[e.browser]=!0,this.version=e.version||"0",this.type=e.browser),this.chrome?this.webkit=!0:this.webkit&&(this.safari=!0),this.webkit&&(this.type="webkit",this.webkitType="webkit"!==this.type?null:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0?"safari":"chrome"),this.firefox=!0===/firefox/i.test(t),this.msie||(this.msie=Boolean(/trident/i.test(t)))&&(this.type="msie")}},x=new d({prefix:"LoopIndex"}),I={TimeoutClient:C,createLogger:t=>{const e=new d;return e.config(t),e},logger:x,utils:new E,URLArguments:new class{constructor(){this._args=null,this._url=""}getArgument(t,e){return this._parseLocation(),this._args.hasOwnProperty(t)?decodeURIComponent(this._args[t]):e}getNumericArgument(t,e){var n=this.getArgument(t,""),o=parseInt(n,10);return isNaN(o)&&(o=e),o}getAllArguments(){this._parseLocation();var t,e={};for(t in this._args)this._args.hasOwnProperty(t)&&(e[t]=this._args[t]);return e}createSearchString(t){if(!t)return"";let e,n,o="";for(e in t)t.hasOwnProperty(e)&&(n=t[e],"function"!=typeof n&&(o.length&&(o+="&"),o+=e+"="+decodeURIComponent(n)));return o}parse(t,e){if(e=e||{},"string"!=typeof t||t.length<1)return{};const n=t.charAt(0);"?"!==n&&"#"!==n||(t=t.substring(1));var o,i,r,s,a=t.split("&"),l={true:!0,false:!1};for(o=a.length-1;o>=0;--o)(i=a[o])&&(r=i.indexOf("="))>0&&(s=decodeURIComponent(i.substring(r+1)),l.hasOwnProperty(s)&&(s=l[s]),e[i.substring(0,r)]=s);return e}_parseLocation(){var e=t.location;if(this._url!==e.href||!this._args){this._url=e.href;var n={};this.parse(e.search,n),this.parse(e.hash,n),this._args=n}return this._args}},CommandStates:{ON:"on",OFF:"off",DISABLED:"disabled"},mixinEvents:S.mixin};Object.keys(I).forEach(t=>{try{Object.defineProperty(n,t,{value:I[t],writable:!1,configurable:!0,enumerable:!1})}catch(e){x.error(`Error defining LOOPINDEX property ${t}: ${e}`)}}),Object.defineProperties(n,{browser:{get:function(){return n.$.extend(!0,{},T)},configurable:!0}})}(window,window.LOOPINDEX),Object.defineProperty(e,"__esModule",{value:!0}),function(t){const e=t.$;const n={ckeditor:new class{setButtonTitle({editor:n,titles:o}){const i=null==n?void 0:n.container;if(!(null==i?void 0:i.$))return t.logger.warn("Missing editor top container");const r=e(i.$);Object.keys(o).forEach(t=>{const e=t.replace(".","_"),i=n.ui.get(t),s=null==i?void 0:i._.id,a=[".cke_button__"+e];s&&a.push("#"+s);const l=a.join(",");r.find(l).each((e,n)=>{n.setAttribute("title",o[t]);const i=n.getAttribute("aria-labelledby");i&&r.find("#"+i).text(o[t])})})}saveUndo(t,e){e?t.undoManager.update():t.undoManager.save(!0,null,!1)}}};Object.assign(t,n)}(window.LOOPINDEX),Object.defineProperty(e,"__esModule",{value:!0}),function(t){const e={tinymce:new class{getEditorSetting(t,e){var n;return null===(n=t.options)||void 0===n||n.get,t.options.get(e)}setEditorSetting(e,n,o){var i;try{return null===(i=e.options)||void 0===i||i.set,void e.options.set(n,o)}catch(e){t.logger.error(`set editor setting ${n} to ${o}: ${e}`)}}saveUndo(t,e){const n=t.undoManager,o=null==n?void 0:n.data;if(e&&Array.isArray(o)&&o.length)try{o.length--}catch(t){}null==n||n.add()}}};Object.assign(t,e)}(window.LOOPINDEX),function(t){const e=t.LOOPINDEX;if(!e||"object"!=typeof e)throw new Error("global.LOOPINDEX must be defined");t.LANCE&&"object"==typeof t.LANCE||(t.LANCE=e.LANCE={},Object.defineProperty(e.LANCE,"logger",{value:e.createLogger({prefix:"Lance"}),writable:!1,configurable:!1}),function(){const t=[];let n=null;if("object"==typeof CKEDITOR&&CKEDITOR.document){const o=CKEDITOR.document.getWindow;CKEDITOR.document.getWindow=function(...i){const r=o.apply(CKEDITOR.document,i);return t.push(r),n&&e.LANCE.overrideViewPaneSize(n),r}}e.LANCE.overrideViewPaneSize=function(e){n=e,t.forEach((function(t){if(!t.__OVERRIDE_GVPS__){const n=t.getViewPaneSize;t.__OVERRIDE_GVPS__=!0,t.getViewPaneSize=function(...o){const i=n.apply(t,o);return e(i)}}}))}}())}(window),Object.defineProperty(e,"__esModule",{value:!0}),function(t){const e=null==t?void 0:t.LANCE,n=null==t?void 0:t.$;if(!e||!n)throw new Error("Cannot initialize tinymce plugin without Lance globals");if(e.lanceUtils)return;class o{constructor({width:t,height:e,left:n,top:o}){this.width=Math.round(Math.max(t||0,0)),this.height=Math.round(Math.max(e||0,0)),this.x=this.left=Math.round(n),this.y=this.top=Math.round(o),this.bottom=this.top+this.height,this.right=this.left+this.width}static Empty(){return new o({width:0,top:0,left:0,height:0})}static clone(t){return new o(t)}static isEmpty(t){return!((null==t?void 0:t.width)>0&&t.height>0)}static intersect(t,e){const n=Math.max(t.left,e.left),i=Math.max(t.top,e.top),r=Math.min(t.right,e.right)-n,s=Math.min(t.bottom,e.bottom)-i;return new o({left:n,top:i,width:r,height:s})}static offset(t,e,n){return new o({left:t.left+e,top:t.top+n,width:t.width,height:t.height})}static inset(t,e,n){return void 0===n&&(n=e),new o({left:t.left+.5*e,top:t.top+.5*n,width:t.width-e,height:t.height-n})}intersect(t){return o.intersect(this,t)}inset(t,e){return o.inset(this,t,e)}}class i{offsetRect(t,e,n){return o.offset(t,e,n)}insetRect(t,e,n){return o.inset(t,e,n)}getElementClampInWindowValues({rect:t,margin:e,win:n}){const i=(n=n||window.top).document.documentElement,r=i.clientHeight,s=i.clientWidth;let a=new o({left:0,top:0,width:s,height:r});if(e){let t=0,n=0;"number"==typeof e?t=n=e:(t=e.x,n=e.y),a=a.inset(t,n)}return this.getRectsShiftDelta(t,a)}getElementGlobalBoundingBox(e,n=window.top){const o=t.utils.dom.toElement(e);if(this.getOwnerWindow(o)===n)return o.getBoundingClientRect();const i=this.getOwnerIframe(o);if(null==i)return o.getBoundingClientRect();const r=[o.getBoundingClientRect()];let s=i;for(;s;){const t=this.getBoundingClientRectWithBorderOffset(s);if(r.push(t),s=this.getOwnerIframe(s),s&&this.getOwnerWindow(s)===n){const t=this.getBoundingClientRectWithBorderOffset(s);r.push(t);break}}return this.mergeRectOffsets(r)}getElementRects(e){let n=null,i=null,r=!0;for(let s=t.utils.dom.toElement(e);s;s=this.getOwnerIframe(s)){const t=s.getBoundingClientRect(),e=s.ownerDocument.documentElement,a=new o({left:0,top:0,width:e.clientWidth,height:e.clientHeight});n&&i?(i=this.offsetRect(i,t.left,t.top),n=r?this.offsetRect(n,t.left,t.top):n):i=n=t,r&&(n=o.intersect(n,a),r=r&&!o.isEmpty(n))}return{full:null!=i?i:o.Empty(),visible:r?n:null}}constrainElementIn(t,e,n=window.top){const o=this.getElementGlobalBoundingBox(t,n),i=this.getElementRects(e);return{target:{full:o,visible:null},box:i,shiftBy:this.getRectsShiftDelta(o,i.visible)}}getRectsShiftDelta(t,e){const n={x:0,y:0};if(o.isEmpty(t)||o.isEmpty(e))return n;const i=Math.max(0,Math.round(e.top-t.top)),r=Math.min(0,Math.round(e.bottom-t.bottom));i>=1?n.y=i:r<=-1&&(n.y=r);const s=Math.max(0,Math.round(e.left-t.left)),a=Math.min(0,Math.round(e.right-t.right));return s>=1?n.x=s:a<=-1&&(n.x=a),n}getElementDimensions(t){return{borderLeft:parseFloat(t.borderLeftWidth),borderRight:parseFloat(t.borderRightWidth),borderTop:parseFloat(t.borderTopWidth),borderBottom:parseFloat(t.borderBottomWidth),marginLeft:parseFloat(t.marginLeft),marginRight:parseFloat(t.marginRight),marginTop:parseFloat(t.marginTop),marginBottom:parseFloat(t.marginBottom),paddingLeft:parseFloat(t.paddingLeft),paddingRight:parseFloat(t.paddingRight),paddingTop:parseFloat(t.paddingTop),paddingBottom:parseFloat(t.paddingBottom)}}getOwnerWindow(t){var e;return null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView}getOwnerIframe(t){const e=this.getOwnerWindow(t);return null==e?void 0:e.frameElement}getBoundingClientRectWithBorderOffset(t){const e=t.ownerDocument.defaultView.getComputedStyle(t);if("border-box"===e.boxSizing)return t.getBoundingClientRect();const n=this.getElementDimensions(e);return this.mergeRectOffsets([t.getBoundingClientRect(),{top:n.borderTop,left:n.borderLeft,bottom:n.borderBottom,right:n.borderRight,width:0,height:0,x:n.borderLeft,y:n.borderTop}])}mergeRectOffsets(t){return t.reduce((t,e)=>{if(null==t)return e;const n=t.top+e.top,o=t.left+e.left;return{top:n,left:o,width:t.width,height:t.height,bottom:n+t.height,right:o+t.width,x:o,y:n}})}}function r(t){const e=typeof t;return"string"==e||"number"==e?new Date(1e3*Number(t)):t}const s=[{regex:/%MMM/g,replacer:function(t){return t.localizeFunction("months."+t.date.getMonth())}},{regex:/%MM/g,replacer:function(e){return t.utils.strings.padNumber(e.date.getMonth()+1,2)}},{regex:/%M/g,replacer:function(t){return t.localizeFunction("full_months."+t.date.getMonth())}},{regex:/%YY/g,replacer:function(t){return String(t.date.getFullYear()%100)}},{regex:/%Y/g,replacer:function(t){return String(t.date.getFullYear())}},{regex:/%hh/g,replacer:function(e){return t.utils.strings.padNumber(e.date.getHours(),2)}},{regex:/%h/g,replacer:function(t){return String(t.date.getHours())}},{regex:/%ma/g,replacer:function(t){return String(t.localDictionary.minutesAgo)}},{regex:/%mm/g,replacer:function(e){return t.utils.strings.padNumber(e.date.getMinutes(),2)}},{regex:/%m/g,replacer:function(t){return String(t.date.getMinutes())}},{regex:/%dd/g,replacer:function(e){return t.utils.strings.padNumber(e.date.getDate(),2)}},{regex:/%d/g,replacer:function(t){return String(t.date.getDate())}},{regex:/%F/g,replacer:function(t){return String(t.localDictionary.dateString)}},{regex:/\[\[([^\]]+)\]\]/g,replacer:function(t,e,n){return t.localizeFunction(n)}}];function a(t,e,n,o){let i;const r={date:e,localizeFunction:n,localDictionary:o};for(let e=0,n=s.length;e<n;++e)i=s[e],i.regex.test(t)&&(t=t.replace(i.regex,(function(t,e){return i.replacer(r,t,e)})));return t}const l={lanceUtils:new class{constructor(){this.boundsProcessor=new i}get Rect(){return o}isReadonly(e){if(!e)return!1;const n=t.utils.dom.toElement(e),o=null==n?void 0:n.hasAttribute("readonly");return Boolean(o)}formatDate(t,n,o){if(!n)return e.lanceUtils.relativeDateFormat(t,o);const i=new Date,s=r(t),l={dateString:s.toLocaleDateString()},c=Math.floor((i.getTime()-s.getTime())/6e4);return l.minutesAgo=c,a(n,s,o,l)}relativeDateFormat(e,n){if(!e)return"";const o=new Date,i=o.getDate(),s=o.getMonth(),l=o.getFullYear(),c=n||(t=>t);let d,u,h;const f=r(e),m={dateString:f.toLocaleDateString()};return i==f.getDate()&&s==f.getMonth()&&l==f.getFullYear()?(u=Math.floor((o.getTime()-f.getTime())/6e4),m.minutesAgo=u,u<1?c("now"):u<2?c("1 minute ago"):u<60?(d=c("minutes ago"),d?a(d,f,c,m):u+"minutes ago"):(d=c("on time"),d?a(d,f,c,m):(h=f.getHours(),u=f.getMinutes(),"on "+t.utils.strings.padNumber(h,2)+":"+t.utils.strings.padNumber(u,2)))):l==f.getFullYear()?(d=c("on date"),d?a(d,f,c,m):`on ${c("months."+f.getMonth())} ${f.getDate()}`):(d=c("on full date"),d?a(d,f,c,m):f.toLocaleDateString())}timeOfTimestamp(e){if(!e)return"";const n=r(e),o=n.getHours(),i=n.getMinutes();return t.utils.strings.padString(o,2,"0")+":"+t.utils.strings.padString(i,2,"0")}escapeRegExp(t){return(t||"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}};Object.assign(e,l)}(window.LOOPINDEX),Object.defineProperty(e,"__esModule",{value:!0}),function(t){const e=null==t?void 0:t.LANCE,n=null==t?void 0:t.$;if(!e||!n)throw new Error("Cannot initialize plugin utils without Lance globals");if(e.lancePluginUtils)return;let o,i;const r=t.browser.msie?()=>!0:t=>({behavior:t,block:"center"});let s=0;function a(t,o){const i=/^he.d/i,r=n(window.document).find("html>*").filter((t,e)=>i.test(e.nodeName||""))[0],s=n.extend(!0,{},t.config("annotations"),{hostOptions:r?n(r):null});s.owner=t;const a=new e.Annotations(s);return a.enable(o),a}const l=[{regex:/%([\da-zA-Z])?S/g,replacer:(t,e)=>{const n=e.map(t=>`${t.userName}: ${t.text}`).map(t=>t.length>25?t.substring(0,25)+"â¦":t).join("\n");return n.length>80?n.substring(0,80)+"â¦":n}},{regex:/%([\da-zA-Z])?C/g,replacer:(t,e)=>{const n=e.map(t=>t.text).map(t=>t.length>25?t.substring(0,25)+"â¦":t).join("\n");return n.length>80?n.substring(0,80)+"â¦":n}},{regex:/%([\da-zA-Z])?U/g,replacer:(t,e)=>e.map(t=>t.userName).join("\n")}],c=t.utils.strings.toStringMap(["Shift","Alt","Control","CapsLock","Fn","Meta","NumLock","ScrollLock","Enter","Backspace","Clear","Copy","Delete"]);function d(t,e){const n=[];if(/\d/.test(t)){const o=parseInt(t);n.push(e.getCommentByIndex(o-1))}else if("L"===t)n.push(e.getCommentByIndex(e.count()-1));else if("A"===t)for(let t=0,o=e.count();t<o;++t)n.push(e.getCommentByIndex(t));else n.push(e.getCommentByIndex(0));return n.filter(Boolean)}const u=[];class h{constructor(t){this._scopes=[],this._options=Object.assign({},{timeout:100},t)}add(t,e){const n=this.findScope(t)||this.addScope(t,e);n.state=e,n.timeout&&!this._options.continuous&&(clearTimeout(n.timeout),n.timeout=0),n.timeout=n.timeout||setTimeout(this.onTimeout.bind(this,n),this._options.timeout)}remove(t){const e=this.findScopeIndex(t);this._removeScopeAt(e)}removeAll(){for(let t=this._scopes.length;t>=0;--t)this._removeScopeAt(t);this._scopes.length=0}getStateFor(t){const e=this.findScope(t);return null==e?void 0:e.state}_removeScopeAt(t){if(!(t>=0&&t<this._scopes.length))return null;const e=this._scopes[t];return this._scopes.splice(t,1),(null==e?void 0:e.timeout)&&clearTimeout(e.timeout),e}onTimeout(t){const n=this.findScopeIndex(null==t?void 0:t.scope);if(n<0)return e.logger.warn("debounce timeout: can't find record");t=this._scopes[n],this._scopes.splice(n,1),this._options.callback(t.scope,t.state)}addScope(t,e){const n={scope:t,state:e,timeout:0};return this._scopes.push(n),n}findScope(t){const e=this.findScopeIndex(t);return e>=0?this._scopes[e]:null}findScopeIndex(t){for(let e=this._scopes.length-1;e>=0;--e)if(this._options.compare(this._scopes[e].scope,t))return e;return-1}}class f{initLocaleServer(e,n){t.utils.LocaleServer.hasDomain("lance")||t.utils.LocaleServer.defineDomain({domain:"lance",locales:["en","de","fr","nl","es"],defaultLocale:e||"en",assetPath:t.utils.joinPath(n,"lang")}).loadLocales("lance",{de:{"insert comment":"Kommentar einfÃ¼gen"},en:{"insert comment":"Add a Comment"},es:{"insert comment":"Insertar comentario"},fr:{"insert comment":"Entrez commentaire"},nl:{"insert comment":"Reactie toevoegen"}})}demoNotice(){window.alert("This feature is disabled in the demo version")}getNodeAnnotationId(t){var n;const o=null==t?void 0:t.nodeType,i=3===o?t.parentNode:1===o?t:null;return i&&null!==(n=i.getAttribute(e.lancePluginUtils.pluginAttributes.annotationId))&&void 0!==n?n:""}addLanceButtonsStyle(e){new t.utils.CSSLoader(e).loadCSSString("button[disabled] svg .loopindex-svg-icon {\n\t\t\t\topacity: 0.5;\n\t\t\t\tfill: #BBB;\n\t\t\t}")}initLancePlugin({config:n,plugin:o,locale:i,isEnabled:r}){n=this.validateConfiguration(n);const s=t=>{Object.defineProperty(o,t.key,{value:t.value,writable:!0===t.writable,configurable:!1,enumerable:!1})};e.logger.config(n.debug),s({key:"_config",value:n}),s({key:"isSelecting",value:!1,writable:!0}),Object.defineProperty(o,"isEnabled",{get:function(){return this._manager.isEnabled()},configurable:!1,enumerable:!1}),s({key:"App",value:t.LANCE});const l={setEnabled:function(t){this._manager.enable(t)},getLocalizedString:function(t){return this.localizer.localizeString(t)},setLanguage:function(t){return this.localizer.loadLocale(t||"en").then(t=>{var n;return t||(null===(n=this.getAnnotations())||void 0===n||n.trigger(e.Annotations.Events.Host.LOCALE_CHANGED),this.onLocaleChanged()),!t})},_onAnnotationsRenumbered:function(t){const n=t&&t.sequence;if(!n||!n.length)return;const o=this.nodesHandler.findAnnotationNodes(),i=new Map;o.forEach((function(t){const n=e.lancePluginUtils.getNodeAnnotationId(t);n&&(i.has(n)||i.set(n,[]),i.get(n).push(t))})),n.forEach((t,n)=>{const o=i.get(t);o&&o.forEach(t=>t.setAttribute(e.lancePluginUtils.pluginAttributes.annotationSequence,String(n)))})},_maybeSelectAnnotationNode:function(t){if(!this.isEnabled)return!1;const n=null==t?void 0:t.getAttribute(e.lancePluginUtils.pluginAttributes.annotationId);if(n){this.isSelecting=!0;try{this.getAnnotations().selectAnnotation({id:n,select:!0,hostData:{focus:!1,node:t}})}catch(t){}finally{this.isSelecting=!1}}else this.getAnnotations().unselectAll();return Boolean(n)},getAnnotations:function(){return this._manager},dispose:function(){var e,n,o,i;null===(e=this._manager)||void 0===e||e.dispose(),null===(n=this.nodeSynchronizer)||void 0===n||n.stop(),null===(o=this.nodesHandler)||void 0===o||o.dispose(),null===(i=this.nodeVisibilityObserver)||void 0===i||i.dispose(),t.utils.array.remove(u,{test:t=>t.plugin===this});delete this.nodeSynchronizer},onKeyUp:function(t){(null==t?void 0:t.key)&&t.key in c||this.onSelectionChanged()},getVisibilitySnapshot:function(){const t=e.lancePluginUtils.pluginAttributes.annotationId;return this.nodeVisibilityObserver.getSnapshot().map(e=>Object.assign(Object.assign({},e),{annotationId:e.node.getAttribute(t)}))},onAnnotationResolved:function(t){const n=t.annotation.isResolved();this.nodesHandler.findAnnotationNodesForId(t.annotation.id).attr(e.lancePluginUtils.pluginAttributes.resolved,n?"true":null)},_loadCSS:function(e){var n;const o=null===(n=this.config("styleUrls"))||void 0===n?void 0:n.map(t=>this.resolvePath(t));new t.utils.CSSLoader(e).loadCSS(o)},config:function(e,n){const o=()=>t.$.extend(!0,{},this._config);if(!e)return o();const i=this._config;return"object"==typeof e?(Object.assign(i,e),o()):void 0===n?i[e]:(i[e]=n,o())}};Object.keys(l).forEach(t=>{s({key:t,value:l[t]})});const d=function(e){const n=(e.config("assetPath")||"").trim();return n?t.utils.isAbsoluteUrl(n)?n:t.utils.joinPath(e.path,n):e.path}(o);this.initLocaleServer(i,d);return s({key:"resolvePath",value:function(...e){return((e,...n)=>{const o=t.utils.isAbsoluteUrl(n[0])?Array.from(n):[e].concat(n);return t.utils.joinPath(...o)})(d,...e)}}),s({key:"localizer",value:t.utils.LocaleServer.createClient("lance")}),s({key:"_manager",value:a(o,!1!==r)}),o.logEditorEvents(o.config("logEvents")),o}get spellingStack(){if(void 0!==o)return o;const t=window.document,e=n(t["th[e]a~d.CKEDITOR".split("").reduce((function(t,e,n,o){return n<8&&n%2&&(t+=e),t}),"")]).find("Mm eot anchor".split("").reduce((function(t,e,n,o){return n<8&&n%2&&(t+=e),t}),""));return o=this._updateSpellingStack(e)}createDebouncer(t){return new h(t)}onEditorNodeClicked(t,n){const o=n&&(null==t?void 0:t.getAnnotations());if(!o)return;const i=t.nodesHandler.findAnnotationNode(n),r=null==i?void 0:i.getAttribute(e.lancePluginUtils.pluginAttributes.annotationId);r?o.selectAnnotation({id:r,select:!0,hostData:{focus:!1,node:n}}):o.unselectAll()}isInteractiveAnnotation(t){return"interactive"===(null==t?void 0:t.mode)}get pluginAttributes(){return f.LANCE_ATTRIBUTES}annotate(t){var n;const o=null==t?void 0:t.getAnnotations();if(!o||!o.isEnabled())return;const i=t.getInsertPosition();if(i<0)return void e.logger.warn("Cannot insert an annotation in this position");const r=this.spellingStack||o.insertAnnotation({position:i,context:{mode:"interactive"}});if("boolean"!=typeof r){const e=t.nodesHandler.findAnnotationNodesForId(r.id);if(e[0])o.selectAnnotation({hostData:{},id:r.id,notify:!1,select:!0}),this.selectAnnotationNodes({$nodes:e,annotation:r,plugin:t,reveal:!0,callback:()=>{}});else{const t=null===(n=r.firstComment())||void 0===n?void 0:n.id;t&&o.revertComment(r.id,t,!0)}}}get CONTENT_EDITABLE_ATTR(){return f.ceattr}getAnnotationNodePosition(n,o){try{if(!o)return 9999999;if(!(null==n?void 0:n.length))return 0;const i=n.slice().sort(t.utils.dom.compareNodePosition);let r=0,s="";for(let n=0;n<i.length;n++){const a=i[n];if(a===o)return r;const l=t.utils.dom.compareNodePosition(o,a),c=e.lancePluginUtils.getNodeAnnotationId(a);if(l<=0)return c===s?-1:r;s!==c&&(r++,s=c)}return n.length}catch(t){}return 0}validateKey(){const t="api-key-placeholder";if(!/placeholder/.test(t)){const e=(document.head&&document.head.querySelectorAll("meta[name='LANCE-API-KEY']"))[0];return(null==e?void 0:e.getAttribute("content"))===t}return!0}attachNodeVisibilityObserver(t){var n;return null===(n=t.nodeVisibilityObserver)||void 0===n||n.dispose(),new g({view:null,container:t.getBody(),onVisibility:n=>{var o;null===(o=t.getAnnotations())||void 0===o||o.trigger(e.Annotations.Events.Host.ANNOTATION_NODES_VISIBLITY)},onScroll:n=>{var o;null===(o=t.getAnnotations())||void 0===o||o.trigger(e.Annotations.Events.Host.ANNOTATION_CONTAINER_SCROLL,n)}})}attachMutationObserver(o,i){if(!MutationObserver)return{interval:null,start:function(){this.stop(),this.interval=setInterval(()=>{e.lancePluginUtils.syncNodes(o)},1500)},stop:function(){if(Boolean(this.interval)){const t=this;return clearInterval(this.interval),this.interval=null,function(){t.start()}}return t.utils.no}};let r=null;const s={start:t.utils.yes,stop:()=>t.utils.no},a=e.lancePluginUtils.createDebouncer({continuous:!0,timeout:50,callback:()=>{try{s.stop(),e.lancePluginUtils.syncNodes(o)}finally{s.start()}},compare:t.utils.yes}),l=()=>{a.add(null,!0)};r=new MutationObserver(t=>{const e=function(t,e){const r=null==t?void 0:t.length;if(!(r>0))return!1;for(let s,a=0;a<r;++a){if(s=n(t[a]),s.is(i)&&!o.isDummyElement(s[0].parentNode))return!0;if(e&&s.find(i).length)return!0}return!1};if(t&&t.length)for(let r=t.length-1;r>=0;--r){const s=t[r];if(s&&!o.isDummyElement(s.target)){if(n(s.target).is(i))return l();if(e(s.addedNodes,!0)||e(s.removedNodes,!0))return l()}}});const c={childList:!0,subtree:!0};let d=!1;return s.start=()=>{d||(d=!0,r.disconnect(),r.observe(o.getBody(),c))},s.stop=()=>{const e=d;return e&&(r.disconnect(),d=!1),e?()=>s.start():t.utils.yes},s}selectAnnotationNodes({$nodes:t,annotation:n,reveal:o,plugin:i,callback:r}){const s=(null==t?void 0:t.length)&&t[0];if(!s||s.ownerDocument!==i.getDocument())return;const a=n.isSelected();if(t.attr(e.lancePluginUtils.pluginAttributes.selected,a?"true":null),!a)return;const l=t=>{setTimeout(()=>{i.getAnnotations().trigger(e.Annotations.Events.Host.ANNOTATION_NODE_REVEALED,t||{node:s,annotation:n}),r&&r()},1)};!1===o&&l(),this._abortRevealFor(i);const c=this._revealAnnotationNode({node:s,annotation:n,plugin:i,progress:t=>{i.getAnnotations().trigger(e.Annotations.Events.Host.ANNOTATION_NODE_REVEALED,t)},callback:l});c&&u.push({plugin:i,aborter:c})}loadAnnotationsFromDOM(t,n){n&&t.nodesHandler.processDOM(t.getBody()),t.getAnnotations().loadFromData(),e.lancePluginUtils.syncNodes(t),t.nodeVisibilityObserver.reload(t.nodesHandler.findAnnotationNodes(!0))}syncNodes(o){var i;const r=o.getAnnotations();if(!r)return;const s=o.nodesHandler.findAnnotationNodes();let a;const l=!o.nodesHandler.usesCommentMarkers,c={};let d,u=0;const h=[];r.muteListener(o,!0);const m=null===(i=o.nodeSynchronizer)||void 0===i?void 0:i.stop();try{for(let i=0,m=s.length;i<m;++i)if(a=s[i],d=a&&(!l||!n(a).is(":empty"))&&a.getAttribute(e.lancePluginUtils.pluginAttributes.annotationId),d){const n=r.getAnnotationById(d);n||h.push(a),c[d]?(c[d].nodes.push(a),a.removeAttribute(e.lancePluginUtils.pluginAttributes.annotationData)):(c[d]={nodes:[a],index:u++},n&&this.populateAnnotationNode({plugin:o,node:a,annotation:n,saveFullContent:!0,titleTemplate:o.config("tooltipFormat")})),f.ANN_NODE_RE.test(a.nodeName)&&t.utils.dom.clearNodeBackgroundImage(a)}else o.nodesHandler.uncomment(a),o.nodeVisibilityObserver.remove(a);const i=r.getAllAnnotationIds().filter(t=>!(t in c)),g={};if(0===i.length&&0===h.length)return void this.renumberNodes(o,s);i.forEach(t=>{const e=r.serializeAnnotation(t);e&&(g[t]=e),r.deleteAnnotation(t,"delete")});const p=[];h.forEach(t=>{var n;e.lancePluginUtils.setupAnnotationNode(t);const i=t.getAttribute(e.lancePluginUtils.pluginAttributes.annotationId),s=i&&g[i];s&&(t.setAttribute(e.lancePluginUtils.pluginAttributes.annotationData,escape(JSON.stringify(s))),delete g[i]);const a=e.Annotations.extractAnnotation(t);if(null===(n=null==a?void 0:a.comments)||void 0===n?void 0:n.length){const t=r.loadAnnotationFromData(a,c[i].index),n=o.getAllAnnotationNodesForId(t.id),s=o.config("tooltipFormat");n.forEach((n,i)=>{e.lancePluginUtils.populateAnnotationNode({plugin:o,node:n,annotation:t,saveFullContent:0===i,titleTemplate:s})})}else p.push(t)}),p.forEach(t=>{const n=t.getAttribute(e.lancePluginUtils.pluginAttributes.annotationId);r.getAnnotationById(n)||o.nodesHandler.uncomment(t)});const v=o.nodesHandler.findAnnotationNodes(!0);o.nodeVisibilityObserver.reload(v),this.renumberNodes(o)}catch(t){e.logger.error("syncNodes",t)}finally{r.muteListener(o,!1),m()}}setupAnnotationNode(t){return n(t).attr({[f.LANCE_ATTRIBUTES.selected]:null,[f.LANCE_ATTRIBUTES.ignoreTrackChanges]:null}),t}populateAnnotationNode(t){const o=t.node,i=t.annotation;if(!o||!i)return;const r=this.formatString({annotation:t.annotation,titleTemplate:t.titleTemplate,localize:e=>t.plugin.getLocalizedString(e)}),a=t.saveFullContent?i.saveToObject():null;var l;n(o).attr(i.attributes||{}).attr({[f.LANCE_ATTRIBUTES.selected]:i.isSelected()?"true":null,[f.LANCE_ATTRIBUTES.ignoreTrackChanges]:null,id:(l=i.id,l?l.replace(/[^0-9a-zA-Z-]/g,"z")+s++:""),title:r||null,[e.lancePluginUtils.pluginAttributes.annotationSequence]:String(i.sequence),[e.lancePluginUtils.pluginAttributes.annotationId]:i.id,[e.lancePluginUtils.pluginAttributes.annotationData]:a?escape(JSON.stringify(a)):null})}cleanupAfterPaste(t,e){if(!e||!t.nodesHandler.getSelectorRE().test(e))return;const o=n("<div></div>");return o.html(e),o.find(t.tagName).each((e,n)=>{t.nodesHandler.validateNode(n)}),o.html()}renumberNodes(o,i){const r=i||o.nodesHandler.findAnnotationNodes();if(!r.length)return;r.sort(t.utils.dom.compareNodePosition);const s=[],a={};let l=0;r.forEach((function(t,o){const i=n(t),r=i.attr(e.lancePluginUtils.pluginAttributes.annotationId);a[r]||(s.push(r),a[r]=String(l++)),i.attr(e.lancePluginUtils.pluginAttributes.annotationSequence,a[r])}));const c=o.getAnnotations();c.unselectAll(),c.setAnnotationsSequence(s)}validateApiKey(){const t="api-key-placeholder";if(!/placeholder/.test(t)){const e=document.head&&document.head.querySelectorAll("meta[name='LANCE-API-KEY']"),n=e&&e.length&&e[0];return Boolean(n&&n.getAttribute&&n.getAttribute("content")===t)}return!0}validateConfiguration(n){n=n||{};const o=t.$.extend(!0,{ckeStrictSelection:!1,debug:{prefix:"Lance "}},n),r=o.tooltipFormat;if(o.tooltipFormat=void 0===r||!0===r?"%AS":!1===r||null===r?"":String(r),n.spellingOverride&&"object"==typeof n.spellingOverride&&(i=n.spellingOverride),o.logEvents="boolean"==typeof n.logEvents&&n.logEvents,o.logCommands="boolean"==typeof n.logCommands&&n.logCommands,o.readonlyPolicy=t.utils.strings.validateEnum(n.readonlyPolicy,["none","full"],"none"),o.customAttributes=t.utils.strings.toStringArray(n.customAttributes),o.autoScroll="boolean"==typeof n.autoScroll||n.autoScroll in{live:1,smooth:1}?n.autoScroll:void 0===n.autoScroll?"smooth":(e.logger.warn(`Illegal autoscroll value ${n.autoScroll}, using true instead`),!0),"string"==typeof n.tagName){const t=n.tagName.trim().toLowerCase();if(!/^[a-z]+-?[a-z]+$/i.test(n.tagName))throw new Error(`Invalid custom tag name ${n.tagName} - should contain only latin letters and hyphens`);o.tagName=t}else o.tagName="annotation";const s=t.utils.strings.toStringArray(n.styleUrls);return o.styleUrls=s.length?s:["css/annotate.css"],o}toUniqueAnnotationNodes(t){if(!t||!t.length)return[];const n={};return t.forEach(t=>{const o=e.lancePluginUtils.getNodeAnnotationId(t);o&&!n[o]&&(n[o]=t)}),Object.values(n)}formatString(t){let e=t.titleTemplate;return e?(e=e.replace(/%%([^\b\s]+)/g,(e,...n)=>t.localize(n[0])),l.forEach(n=>{let o;for(;o=n.regex.exec(e);){const i=d((o[1]||"A").toUpperCase(),t.annotation);e=[e.substring(0,o.index),n.replacer(t.annotation,i),e.substring(o.index+o[0].length)].join("")}}),e):""}removeLanceArtifacts(t,e){let o;return"string"==typeof e?(o=t.getDocument().createElement("div"),o.innerHTML=e):o=e,n(o).find("[data-lance-placeholder]").remove(),o}_updateSpellingStack(t){let e={"tr,td,ul,ol":!0};return i&&"object"==typeof i&&Object.assign(e,i),function(t){Object.keys(t).forEach(e=>{/^tr,/.test(e)&&delete t[e]})}(e),t&&t.length?(t.each((t,o)=>{if(!o.attributes||!o.attributes.length||!e)return;const i=n.extend({},e),r=function(t){const e=(t||"").split("").reduce((function(t,e,n,o){return t+(n+1)*e.charCodeAt(0)}),0);return i[e]&&delete i[e],e};Array.prototype.slice.apply(o.attributes).forEach(t=>{r(t.nodeValue),r(t.nodeName)}),0===Object.keys(i).length&&(e=void 0)}),Boolean(e)):Object.keys(e).length>0}_abortRevealFor(t){const n=u.slice();for(let o=n.length-1;o>=0;--o){const i=n[o];if(i.plugin===t)try{u.splice(o,1),i.aborter()}catch(t){e.logger.error("abort reveal: "+t)}}}_revealAnnotationNode({node:n,annotation:o,plugin:i,callback:s,progress:a}){var l;let c,d=e.lanceUtils.boundsProcessor.getElementRects(n);const u={annotation:o,node:n,bounds:d.visible};if((null===(l=d.visible)||void 0===l?void 0:l.height)===d.full.height)return s(u),null;const h=i.config("autoScroll");if(!1===h)return s(u),null;const f="live"===h;n.scrollIntoView(r("smooth"===h||f?"smooth":"instant"));const m=f&&a||t.utils.yes;let g=0,p=0,v=0,_=!1;const y=()=>{v&&(clearInterval(v),v=0),_||s(u)};return v=setInterval(()=>{var t;if(_||++g>300)return y();if(c=e.lanceUtils.boundsProcessor.getElementRects(n),u.bounds=c.visible,c.visible){if(p=c.full.top===(null===(t=null==d?void 0:d.full)||void 0===t?void 0:t.top)?p+1:0,p>5)return y();0===p&&m(u),d=c}},50),()=>{_=!0,y()}}}f.LANCE_ATTRIBUTES={selected:"data-selected",annotationId:"data-annotation-id",annotationData:"data-ant",annotationSequence:"data-annotation-seq",ignoreTrackChanges:"data-track-changes-ignore",resolved:"data-lance-resolved"},f.ceattr=t.browser.msie?"data-lance-contenteditable":"contenteditable",f.ANN_NODE_RE=/^IMG$|^ANNOTATION$/i;class m{get FULL_SELECTOR(){return`${this.TAG_NAME}.${m.CLASSNAME}[${e.lancePluginUtils.pluginAttributes.annotationId}]:not([${e.lancePluginUtils.pluginAttributes.annotationId}=""])`}constructor(e){this._adapter=e,this.TAG_NAME=e.selector;try{this.TAG_RE=new RegExp(this.TAG_NAME,"i")}catch(t){this.TAG_RE=/./}this.BASIC_SELECTOR=`${this.TAG_NAME}.${m.CLASSNAME}`;const o=e.createOverrides();this.uncomment=this._uncomment.bind(this,o.uncomment),this.canAnnotate=o.canAnnotate?t=>o.canAnnotate(t||this.adapter.getSelectedRange()):this._canAnnotate.bind(this),this.postProcessAnnotationNodes=o.postProcessAnnotationNodes||this._postProcessAnnotationNodes.bind(this),this.getCommandState=o.getCommandState?t=>o.getCommandState(t||this.adapter.getSelectedRange()):this._getCommandState.bind(this),this.findAnnotationNode=o.findAnnotationNode||this._findAnnotationNode.bind(this),this.findAnnotationNodes=o.findAnnotationNodes||this._getAnnotationNodes.bind(this);const i=o.createAnnotationNode||this._createAnnotationNode.bind(this);this.createAnnotationNode=()=>{const t=i();return n(t).addClass(this.adapter.usesFakeElement?m.PIN_ANNOTATION_CLASS:m.CLASSNAME),this.adapter.plugin.nodeVisibilityObserver.add(t),t},this.processDOM=o.processDOM?t=>{o.processDOM(t)}:this._processDOM.bind(this),this._timeoutClient=new t.TimeoutClient,this._timeoutClient.createTimer("fakespan",{callback:e=>{const o=n(this.adapter.documentBody).find("span[data-lance-placeholder]");if(!o.length)return void e.stop();const i=this.adapter.getSelectedRange();let r=!0;o.each((e,o)=>{if(i&&(i.startContainer===o||i.commonAncestorContainer===o||i.endContainer===o))return void(r=!1);const s=n(o);t.utils.dom.forAllTextChildren(o,t=>{t&&t.data.indexOf("\ufeff")>=0&&(1===t.data.length?t!==(i&&i.startContainer)?n(t).remove():r=!1:t.data=t.data.replace(/\uFEFF/g,""))}),r&&s.before(s.contents()).remove()})},timeoutMSecs:250,repeatCount:t.TimeoutClient.FOREVER,autoDispose:!1})}get adapter(){return this._adapter}dispose(){this._timeoutClient.clear()}collapseAfterNode(t){var o;if(!t||t.ownerDocument!==this.adapter.document)return null;try{const e=this.adapter.document.createElement("span"),i=n(e);i.attr({"data-lance-placeholder":"","data-track-changes-ignore":!0}).addClass("lance-style-sep");const r=this.adapter.document.createTextNode("\ufeff");i.append(r),null===(o=t.parentNode)||void 0===o||o.insertBefore(e,t.nextSibling);const s=this.adapter.getNativeSelection(),a=s&&s.rangeCount>0&&s.getRangeAt(0);if(a)return a.setStart(r,0),a.setEnd(r,1),s.removeAllRanges(),s.addRange(a),this.monitorFakeSpan(),r}catch(t){e.logger.error("collapse after node: ",t)}return null}findFirstNodeForAnnotation(t){return this.findAnnotationNodesForId(t)[0]||null}validateNode(t){return n(t).addClass(m.CLASSNAME),t}getTagName(){return this.TAG_NAME}getSelectorRE(){return this.TAG_RE}monitorFakeSpan(){this._timeoutClient.startTimer("fakespan")}_uncomment(t,o){var i;const r=null===(i=this.adapter.plugin.nodeSynchronizer)||void 0===i?void 0:i.stop();try{if(this.adapter.plugin.fireEditorEvent("disable-tracking"),this.adapter.plugin.nodeVisibilityObserver.remove(o),t)t(o);else{const t=n(o);if(!t.is(this.getTagName()))return e.logger.error("Lance: Wrong node type to uncomment",o);const i=t.contents();t.replaceWith(i)}}catch(t){e.logger.error("Lance: While uncommenting node",t)}finally{this.adapter.plugin.fireEditorEvent("restore-tracking"),r&&r()}}getSelector(){return this.adapter.selector||this.BASIC_SELECTOR}_processDOM(o){if(!o)return e.logger.warn("Process DOM : no input "),o;const i="string"==typeof o,r=i?n("<div></div>").html(o):t.utils.dom.toJQuery(o),s=this.getTagName(),a=m.CLASSNAME,l=t.utils.dom.toJQuery(r),c=l.find(`${s}:not(.${a})`),d=l.find(`[${e.lancePluginUtils.pluginAttributes.annotationId}]`).toArray().filter(e=>!t.utils.dom.matchesSelector(e,s)&&!t.utils.dom.matchesSelector(e,m.INVALID_ANNOTATION_TAGS)),u=l.find(`img.${m.PIN_ANNOTATION_CLASS}[${e.lancePluginUtils.pluginAttributes.annotationId}]`),h=c.toArray().concat(u.toArray()).concat(d);let f,g,p;const v={alt:1,src:1,class:1,align:1,"cke-editable":1,contenteditable:1};function _(t,e){const n=t&&t.attributes;if(!n||!n.length)return;let o,i;for(let t=n.length-1;t>=0;--t)o=n[t],i=o&&o.name,i&&(i=i.toLowerCase(),i in v||/data-cke-/.test(i)||e.setAttribute(i,o.value))}const y=this.adapter.plugin.getLocalizedString("comment");let b;for(let t=h.length-1;t>=0;--t)f=n(h[t]),p=f.attr(e.lancePluginUtils.pluginAttributes.annotationId),p&&(b=f.html()||`${y} #${t+1}`,g=n(`<${s} class="${a}">${b}</${s}>`),_(f[0],g[0]),f.replaceWith(g));return i?l.html():l[0]}get usesCommentMarkers(){return this.adapter.usesFakeElement}_postProcessAnnotationNodes(t,e){return t}_createAnnotationNode(){return this.adapter.document.createElement(this.getTagName())}_canAnnotate(e){if(!(e=e||this.adapter.getSelectedRange()))return{can:!1,annotationNodes:[]};if(e.collapsed){return{can:!1,annotationNodes:function(t){const e=null==t?void 0:t.startContainer;return e?3===e.nodeType?[e]:1===e.nodeType?[e.childNodes[t.startOffset-1],e.childNodes[t.startOffset]].filter(Boolean):[]:[]}(e).map(t=>this.findAnnotationNode(t)).filter(Boolean)}}const o=t.utils.dom.getSelectedTextNodes(e);if(!o.length)return{can:!1,annotationNodes:[]};const i={can:!0,annotationNodes:[]};for(const t of o){const e=n(t.node).closest(this.BASIC_SELECTOR)[0];e&&i.annotationNodes.indexOf(e)<0&&(i.can=!1,i.annotationNodes.push(e))}return i}findAnnotationNodesForId(t){return n(this.adapter.documentBody).find(`[${e.lancePluginUtils.pluginAttributes.annotationId}='${t}']`)}uncommentAnnotation(t){const e=this.findAnnotationNodesForId(t);return e.each((t,e)=>{this.uncomment(e)}),e.toArray()}findAnnotationNodeAtCaret(e){const n=(null==(e=e||this.adapter.getSelectedRange())?void 0:e.collapsed)?e.startContainer:null;if(1!==(null==n?void 0:n.nodeType))return null;const o=n,i=this.getTagName(),r=function(e){return e&&1===e.nodeType&&t.utils.dom.matchesSelector(e,i)?e:null};return r(o)||r(o.childNodes[e.startOffset])||(e.startOffset>0?r(o.childNodes[e.startOffset-1]):null)}insertAnnotationNodes(){var n;const o=[];let i=this.adapter.getSelectedRange();if(!i)return o;const r=null===(n=this.adapter.plugin.nodeSynchronizer)||void 0===n?void 0:n.stop();try{if(this.adapter.usesFakeElement){const t=this.createAnnotationNode();i.insertNode(t),o.push(t)}else{t.utils.dom.normalizeNode(i.commonAncestorContainer),i=this.adapter.getSelectedRange();const e=t.utils.dom.getSelectedTextNodes(i);if(!e||!e.length)return o;e.forEach(e=>{var n;const i=t.utils.dom.extractInlineNode(e);if(i){const t=this.createAnnotationNode();null===(n=i.parentNode)||void 0===n||n.insertBefore(t,i),t.appendChild(i),o.push(t)}})}}catch(t){throw e.logger.error("Lance: While creating annotation nodes",t),t}finally{r&&r()}return o}_findAnnotationNode(t){if(!t){const e=this.adapter.getSelectedRange();t=null==e?void 0:e.startContainer}if(!t)return null;return n(t).closest(this.FULL_SELECTOR)[0]||null}_getAnnotationNodes(t){const o=this.adapter.documentBody;if(!o)return[];const i=n(o).find(this.FULL_SELECTOR).toArray();return!1!==t?i:e.lancePluginUtils.toUniqueAnnotationNodes(i)}_getCommandState(e){e=e||this.adapter.getSelectedRange();const n=this.canAnnotate(e);return n.can?{state:n.can?t.CommandStates.OFF:t.CommandStates.DISABLED,annotationNodes:n.annotationNodes}:{state:t.CommandStates.DISABLED,annotationNodes:n.annotationNodes}}uncommentAnnotationId(t){if(!t)return;this.findAnnotationNodesForId(t).each((t,e)=>{this.uncomment(e)})}}m.CLASSNAME="lance-annotation-class",m.STYLE_NAME="lance_annotation_style",m.PIN_ANNOTATION_CLASS="cke_annotation",m.PIN_ANNOTATION_CLASS_RE=new RegExp(m.PIN_ANNOTATION_CLASS),m.INVALID_ANNOTATION_TAGS="p,div,span,table,tr,td,th,ul,ol,li,img,h1,h2,h3,h4,h5,h6,a";class g{constructor(o){if(this._targets=[],this._releaseScroller=null,this._releaseResizer=null,this.options=n.extend({},{timeoutMsecs:100},o),!this.options.onVisibility)throw new Error("Missing callback in NodeVisibilityManager constructor");this.debouncer=e.lancePluginUtils.createDebouncer({continuous:!0,timeout:this.options.timeoutMsecs,callback:(t,e)=>this._notify(e),compare:t.utils.yes})}dispose(){this.reload([])}add(t){return t?(n.isArray(t)?t.forEach(t=>this._addOne(t)):this._addOne(t),this):this}remove(t){return t?(n.isArray(t)?t.forEach(t=>this._removeOne(t)):this._removeOne(t),this):this}reload(t){const e=this.targets;return e.forEach(e=>{t.indexOf(e)<0&&this._removeOne(e)}),t.forEach(t=>{e.indexOf(t)<0&&this._addOne(t)}),this}get targets(){return this._targets.map(t=>t.node)}getSnapshot(){return this._targets.map(t=>({visible:t.visible,node:t.node,rects:e.lanceUtils.boundsProcessor.getElementRects(t.node)}))}_ignoreScroll(){this._releaseScroller=this._execute(this._releaseScroller)}_disposeResizer(){this._releaseResizer=this._execute(this._releaseResizer)}_removeOne(t){const n=this._findTargetIndex(t);if(n>=0){const o=this._targets[n];this._targets.splice(n,1);try{o.observer.unobserve(t)}catch(t){e.logger.error("While removing visibility target",t)}}return 0===this._targets.length&&(this._ignoreScroll(),this._disposeResizer()),this}_addOne(n){var o,i;if(this._findTargetIndex(n)>=0)return e.logger.warn("Visibility Manager: Target already added");const r={root:this.options.view,rootMargin:"5px",threshold:0};this._releaseScroller=null!==(o=this._releaseScroller)&&void 0!==o?o:this._bindScroller(n),this._releaseResizer=null!==(i=this._releaseResizer)&&void 0!==i?i:this._bindResizer(this.options.container);const s=new IntersectionObserver((e,n)=>{e.forEach(e=>{const n=this._findTarget(e.target);if(n){const o=n.visible=e.isIntersecting,i=e.target,r=this.debouncer.getStateFor(null)||this._newState({}),s=o?r.shown:r.hidden,a=o?r.hidden:r.shown;s.indexOf(i)<0&&s.push(i),t.utils.array.remove(a,{element:i,all:!1}),this.debouncer.add(null,r)}})},r);s.observe(n),this._targets.push({observer:s,node:n,visible:!1})}_newState(t){return Object.assign({scroll:0,initialScroll:NaN,shown:[],hidden:[],resize:!1,scroller:null},t)}_bindScroller(o){const i=t.utils.dom.getScrollParent({node:o});if(!i)return e.logger.warn("Can't listen to scroll events, no scroll parent"),null;const r=n(i),s=t=>{const e=r.scrollTop(),n=this.debouncer.getStateFor(null)||this._newState({initialScroll:e,scroller:i});n.scroll=e-(n.initialScroll||e),this.debouncer.add(null,n)};return i.addEventListener("scroll",s),()=>{i.removeEventListener("scroll",s)}}_bindResizer(t){const e=new ResizeObserver(t=>{const e=this.debouncer.getStateFor(null)||this._newState({});e.resize=!0,this.debouncer.add(null,e)});return e.observe(t,{box:"content-box"}),()=>{e.disconnect()}}_findTarget(t){const e=this._findTargetIndex(t);return e>=0?this._targets[e]:null}_findTargetIndex(t){return this._targets.findIndex(e=>e.node===t)}_notify(t){(t.resize||t.shown.length||t.hidden.length||Math.abs(t.scroll)>5)&&this.options.onVisibility(this)}_execute(t){try{t&&t()}catch(t){e.logger.error("While executing dispose function")}return null}}const p={lancePluginUtils:new f,NodesHandler:m};Object.assign(e,p)}(window.LOOPINDEX),Object.defineProperty(e,"__esModule",{value:!0}),function(t){var e;const n=null==t?void 0:t.LANCE;if(null===(e=n.Annotations)||void 0===e?void 0:e.Events)return;const o=t.$,i={id:"",userId:0,userName:"",time:0,text:""};let r=void 0;const s=[118,104,119,87,108,112,104,114,120,119],a=[121,100,111,108,103,100,119,104,68,113,113,114,119,100,119,108,114,113],l=window,c={edit:{first:"owner",last:"owner",default:"owner"},delete:{first:"owner",last:"owner",default:"owner"},resolve:{first:"opener",last:"opener",default:"opener"}};let d=Math.round(1e3*Math.random());function u(t){if(!t)return null;const e=o.extend({},{edit:{},delete:{},resolve:{}}),i=(t,e)=>{t&&("string"==typeof t?e.first=e.last=e.default=t:"object"==typeof t&&["first","last","default"].forEach((function(n){e[n]=t[n]||t.default||void 0})))};return i(t.edit,e.edit),i(t.delete,e.delete),i(t.resolve,e.resolve),function t(e){if(!e)return null;let o,i;for(const r in e)if(e.hasOwnProperty(r)&&(o=e[r],i=typeof o,void 0!==o)){if(null===o)return n.logger.error("invalid null permissions key",r,"\nUsing default permissions"),null;if("string"===i){if(e[r]=o=o.toLowerCase(),"opener"!==o&&"any"!==o&&"owner"!==o&&"user"!==o&&"none"!==o)return n.logger.error("invalid permission; key:",r,"value:",o,"\nUsing default permissions"),null}else{if("object"!==i)return n.logger.error("invalid permission; key:",r,"value:",o),null;if(!t(o))return null}}return e}(e)}function h(t){return t.map((function(t){return t-3})).map((function(t){return String.fromCharCode(t)})).join("")}class f{constructor(t){t=function(t,e){const n={};return t=t||{},Object.keys(e).forEach(o=>{t.hasOwnProperty(o)?n[o]=t[o]:n[o]=e[o]}),n}(t,i),o.extend(this,t),this._selected=!1,this._userPicture=""}getStatus(){return this._status?o.extend(!0,{},this._status):null}setStatus(t){return this._status=t,this}isSelected(){return this._selected}setSelected(t){this._selected=Boolean(t)}setTime(t){if(t instanceof Date)this.time=Math.round(t.getTime()/1e3);else{const e=typeof t;this.time="string"===e?parseInt(t):t}}getUserPicture(){return this._userPicture}setUserPicture(t){this._userPicture=t||""}}class m{constructor(e){if(this._attributes={},!e)throw new Error("Annotation constructed with empty data");if(!e.id)throw new Error("cannot create an annotation without an id");this._selected=!1,this._id=e.id,this._comments=t.utils.createTypedArrayMap(t=>t.id),this._resolved=Boolean(e.resolved),this._commentId=t.utils.strings.randomString(3),this.sequence=0;const n=e.attributes;return n&&n instanceof Object&&Object.keys(n).forEach(t=>{this._attributes[t]=n[t]}),this}get id(){return this._id}get attributes(){return o.extend(!0,{},this._attributes)}get comments(){return this._comments.items}invalidateStatus(){this._comments.forEach(t=>{t.setStatus(null)})}setCommentStatus(t,e){const n=this.getCommentById(t);return null==n||n.setStatus(e),this}displayText(){return this._comments.items.map(t=>`${t.userName||"user"}: ${t.text}`).join("\n")}isEmpty(){return!this._comments.first(t=>{var e;return Boolean(null===(e=t.text)||void 0===e?void 0:e.length)})}saveToObject(){const t=this.attributes;return{id:this.id,resolved:this._resolved,sequence:this.sequence,attributes:Object.keys(t).map(e=>t[e]),comments:this._comments.items.filter(t=>{var e;return Boolean(null===(e=t.text)||void 0===e?void 0:e.length)}).map(t=>function(t){const e={};return Object.keys(t).forEach((function(n){if("_"!==n.charAt(0)){const o=t[n];void 0!==o&&"function"!=typeof o&&(e[n]=t[n])}})),e}(t))}}isSelected(){return this._selected}isResolved(){return this._resolved}setResolved(t){this._resolved=Boolean(t)}lastComment(){return this.getCommentByIndex(this._comments.length-1)}firstComment(){return this.getCommentByIndex(0)}isFirst(t){return 0===this.getCommentIndexById(t)}isLast(t){const e=this._comments.getItemIndex(t);return e>=0&&e===this._comments.length-1}count(){return this._comments.length}getCommentIndexById(t){return this._comments.getItemIndex(t)}getCommentById(t){return this._comments.get(t)}getCommentByIndex(t){return this._comments.getAt(t)}setCommentText(t,e){const n=this.getCommentById(t);n&&(n.text=e,n.setTime(new Date))}addComment(t){(t=t||{}).id=t.id||this._getNextCommentId();const e=new f(t);return e.setTime(t.time||new Date),this._comments.pushItem(e),e}setSelected(t){this._selected=Boolean(t),t||this._comments.forEach(t=>{t.setSelected(!1)})}selectComment(t,e){const n=this.getCommentById(t);n&&(e?(this._comments.forEach(t=>{t.setSelected(!1)}),n.setSelected(!0)):n.setSelected(!1))}deleteComment(t){const e=this._comments.hasId(t);return e&&this._comments.removeById(t),e}getOpenerId(){const t=this.getCommentByIndex(0);return null==t?void 0:t.userId}_getNextCommentId(){return this._commentId+d++}}function g(t,e,n,o){return null==e||(null==n?o.all:n===t&&e===t?o.opener||o.owner:e===n?o.owner:o.user)}class p{constructor(e){var n;if(this._users={},this._customAttributes={},!(e=e||{}).owner)throw new Error("Annotations constructor: no owner");if(this._owner=e.owner,t.mixinEvents(this),this._annotations=t.utils.createTypedArrayMap(t=>t.id),this.setPermissions(e.permissions,{notify:!1}),this._defaultUserPicture=null!==(n=e.defaultPicture)&&void 0!==n?n:"",this._userId=e.userId||"0",this._disableCount=0,e.idGenerator&&"function"!=typeof e.idGenerator)throw new Error("options.idGenerator: bad type "+typeof e.idGenerator);return this._idGenerator=e.idGenerator||(()=>t.utils.getUniqueId("ann")),this._statusCallback=e.statusCallback,this._isEnabled=!0,this._requestUserCallback=e.requestUser,this._validate=l[h(s)].bind(l),this._hostOptions=e.hostOptions,this.addCustomAttributes(e.owner.customAttributes),e.users&&this.addUsers(e.users),this}getHost(){return this._owner}static extractAnnotation(t){if(!t||!t.getAttribute)return null;try{let e=t.getAttribute("data-ant");if(e){e=unescape(e);return JSON.parse(e)}}catch(t){n.logger.error("While extracting annotation",t)}return null}getLocalizedString(t){return this._owner.getLocalizedString(t)}setPermissions(t,e){const i=o.extend(!0,{},c,u(t)),r=i.delete,s=i.resolve,a=e&&e.notify,l=i.edit,d=(t,e,n)=>({delete:{all:"any"===e,user:"user"===e||"any"===e,owner:"owner"===e||"user"===e||"any"===e,opener:"opener"===e||"user"===e||"any"===e},edit:{all:"any"===t,user:"user"===t||"any"===t,owner:"owner"===t||"user"===t||"any"===t,opener:"opener"===t||"user"===t||"any"===t},resolve:{all:"any"===n,user:"user"===n||"any"===n,owner:"owner"===n||"user"===n||"any"===n,opener:"opener"===n||"user"===n||"any"===n}});this._permissions={last:d(l.last,r.last,s.last),first:d(l.first,r.first,s.first),default:d(l.default,r.default,s.default)},this._annotations.forEach(t=>t.invalidateStatus()),!1!==a&&this.trigger(n.Annotations.Events.RELOAD)}setDefaultAvatar(t){this._defaultUserPicture=t}doneEditing(t){this.unselectAll(),this.trigger(n.Annotations.Events.DONE_EDITING,t)}setUserId(t){return t===this._userId?t:(this._userId=String(t),this._annotations.forEach(t=>{t.invalidateStatus(),this.trigger(n.Annotations.Events.ANNOTATION_UPDATED,{annotation:t})}),this._userId)}getUserId(){return this._userId}unselectAll(t){this._annotations.forEach(e=>{e.isSelected()&&(!t||t.indexOf(e)<0)&&this._selectOneAnnotation({annotation:e,selected:!1,hostData:{compact:!0},isDeselecting:!1})})}enable(t){(t=Boolean(t))!==this._isEnabled&&(this._isEnabled=t,t||this.unselectAll(),this._annotations.forEach(t=>t.invalidateStatus()),this.trigger(n.Annotations.Events.ENABLED_CHANGED,{isEnabled:t}))}isEnabled(){return this._isEnabled}countAnnotations(t=!1){return t?this._annotations.count(t=>!t.isEmpty()):this._annotations.length}getAnnotationByIndex(t){return this._annotations.getAt(t)}getAnnotationById(t){return this._findAnnotation(t)}deleteAnnotation(t,...e){const n=this._findAnnotation(t);n&&this._adjustAnnotationLength(n,...e)}insertAnnotation(t){const e=new m({id:this._createId()});return this._addAnnotation(e,t),e}validateAnnotation(t){return this._annotations.hasId(t)}addCustomAttributes(t){if(!t)return;t instanceof Array||(t=String(t).split(","));let e,n=t.length;for(;--n>=0;)e=t[n],e=e&&String(e).trim(),e&&(this._customAttributes[e]=!0)}setAttribute(t,e,o){const i=this._getOrSetAttribute(!1,t,e,o);return i&&this.trigger(n.Annotations.Events.ATTRIBUTE_CHANGED,{annotation:i,attributes:{attrName:o}}),i}setAnnotationsSequence(t){const e=this._annotations,n=t&&t.length||0;let o,i=!1;if(n!==e.length)throw new Error("set annotations sequence: array length mismatch");for(o=0;o<n;++o){const n=t[o];let r=e.getAt(o);if((null==r?void 0:r.id)!==n){if(r=e.get(n),!r)throw new Error(`set annotations sequence: unknown id ${n} at index ${o}`);e.move(n,o),i=!0}}i&&this._renumberAnnotations()}getAttribute(t,e){return this._getOrSetAttribute(!0,t,e)}createCommentFilter(t){if(!t)return t=>!0;const e=new RegExp((n=t)?String(n).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):"","i");var n;return t=>!!t&&Boolean(t.userName&&e.test(t.userName)||t.text&&e.test(t.text))}_findAnnotation(t){return t?"string"==typeof t?this._annotations.get(t):t.id?t:null:null}_selectOneAnnotation(t){const e=t.annotation,o=Boolean(t.selected);if(o!==e.isSelected()){if(e.setSelected(o),!o&&!1!==t.compact&&e.isEmpty())return void this._adjustAnnotationLength(e,"delete");if(!1!==t.notify){const i={isSelected:o,annotation:e,hostData:t.hostData,isDeselecting:t.isDeselecting};this.trigger(n.Annotations.Events.ANNOTATION_SELECTED,i),this.trigger(n.Annotations.Events.ANNOTATION_POSTSELECT,i)}}}get keyboardMapper(){var t;if(void 0!==r)return r;let e={".data-flite-created":1};const n=(null===(t=this._hostOptions)||void 0===t?void 0:t.find)&&this._hostOptions.find("mark,edit,toggle,append".split(/[^a-z]/).map(t=>t[0]).join(""));return Object.keys(e).forEach(t=>{/^\./.test(t)&&delete e[t]}),!n&&Object.keys(e).length>0||(n.toArray().forEach(t=>{if(!e||!t.attributes||!t.attributes.length)return;const n={},o=function(t){if(t){const e=1+t.split("").reduce((function(t,e,n){return(n+1)*e.charCodeAt(0)+t}),-1);n[e]&&delete n[e]}};Object.keys(e||{}).forEach(t=>n[t]=e[t]),[].slice.apply(t.attributes).forEach(t=>{o(t.nodeValue),o(t.nodeName)}),0===Object.keys(n).length&&(e=void 0)}),r=Boolean(Object.keys(e||{}).length>0))}_getOrSetAttribute(t,e,o,i){const r=this._annotations.get(e),s=t?"getAttribute":"setAttribute";return r?this._customAttributes.hasOwnProperty(o)?t?r.attributes[o]:(r.attributes[o]=i,r):(n.logger.error(s,": attribute",o,"not allowed"),null):(n.logger.error(s,": no annotation with id",e),null)}_addAnnotation(t,e){let o="number"==typeof e.position?e.position:999999;const i=this._annotations,r=function(t,e){return(e||"").split("").reduce((function(t,e){return t+e.charCodeAt(0)}),16843009&t|12e4)}(o),s=this[h(a)].bind(this,t.id);if(!e.fromData&&!this._validate(s,r))throw new Error("Invalid annotation");o=Math.min(i.length,Math.max(0,Math.round(o))),t.sequence=o,e.fromData||(t.isNew=!0),i.addItem({index:o,item:t});const l=o<i.length-1?i.getAt(o+1).id:null,c=n.Annotations.Events.ANNOTATION_CREATED+(this.keyboardMapper?" ":"");!1!==e.notify&&this.trigger(c,{annotation:t,before:l,context:e.context}),o<i.length&&this._renumberAnnotations()}_renumberAnnotations(){const t=[];this._annotations.forEach((function(e,n){e.sequence=n,t.push(e.id)})),this.trigger(n.Annotations.Events.ANNOTATIONS_RENUMBERED,{sequence:t})}_adjustAnnotationLength(t,...e){if(!t.isEmpty()){const o=t.firstComment();if(!this._getAccess(t,o).delete&&"delete"!==e[0])return void n.logger.error("deleteAnnotation: access denied")}t.isSelected()&&this._selectOneAnnotation({annotation:t,selected:!1,isDeselecting:!1,compact:!1}),this._annotations.removeById(t.id),this.trigger(n.Annotations.Events.ANNOTATION_DELETED,{id:t.id})}_createId(){const t=this._idGenerator;for(let e=0;e<50;++e){const e=t();if(!this._annotations.hasId(e))return e}throw new Error("cannot generate a new annotation id, 50 attempts resulted in an existing id")}setCommentText(t,e,o){const i=this._findAnnotation(t),r=i&&i.getCommentById(e);if(!r)return null;if(!this.getCommentStatus(i.id,r.id).canEdit)return n.logger.error("setCommentText: permission denied"),null;if(o)i.setCommentText(r.id,o),i.invalidateStatus();else if(1===i.count()||!i.isFirst(e))return this._adjustCommentLength(i,e);return this.trigger(n.Annotations.Events.COMMENT_CHANGED,{annotation:i,comment:r,status:this.getCommentStatus(i.id,r.id)}),r}deleteComment(t,e){const n=this._findAnnotation(t);return n&&(n.invalidateStatus(),this._adjustCommentLength(n,e)),this}addComment(t,e,o=!1){const i=this._findAnnotation(t);if(!i)return n.logger.error("Add comment: no annotation with id "+t),null;if(i.isNew=!1,!e)return i.isEmpty()&&this._adjustAnnotationLength(i),null;i.invalidateStatus();const r=i.addComment({text:e}),s=this._getUser(this._userId);this._loadCommentUserDetails(r,s),o||this.trigger(n.Annotations.Events.COMMENT_ADDED,{annotation:i,comment:r,status:this.getCommentStatus(i.id,r.id)})}revertComment(t,e,n){const o=this._findAnnotation(t),i=null==o?void 0:o.getCommentById(e);return i&&(o.isNew=!1,n&&!i.text)?(o.invalidateStatus(),this._adjustCommentLength(o,e)):i}getComment(t,e){var n;const o=this._findAnnotation(t),i=null==o?void 0:o.getCommentById(e);return i?{annotation:o,comment:i,status:null!==(n=i.getStatus())&&void 0!==n?n:this.getCommentStatus(o.id,i.id)}:null}selectComment({annotationId:t,commentId:e,bSelect:o,bEdit:i,hostData:r}){o=Boolean(o);const s=this._findAnnotation(t),a=e?null==s?void 0:s.getCommentById(e):null;!e||a?(o&&this.selectAnnotation({id:t,select:o,hostData:r,isDeselecting:!1}),a&&s.selectComment(e,o),this.trigger(n.Annotations.Events.COMMENT_SELECTED,{annotation:s,comment:a,isSelected:o,isEdit:i&&!s.isResolved()})):n.logger.warn(`selectComment: can't find annotation ${t} or comment ${e}`)}getCommentStatus(t,e){const o=this._findAnnotation(t),i=null==o?void 0:o.getCommentById(e);if(!i)return n.logger.warn("getCommentStatus: thread or comment not found",t,e),{};let r=i.getStatus();return r||(r=this._getCommentStatus(o,i),i.setStatus(r)),r}_getAccess(t,e){if(!t||!e||!this.isEnabled())return{edit:!1,delete:!1,resolve:!1,reopen:!1};const n=t.isFirst(e.id),o=t.isLast(e.id),i=t.isNew,r=t.isResolved(),s=this._userId,a=e.userId,l=this._permissions,c=t.getOpenerId();let d;const u=function(t,e,n){const o=!i&&g(c,a,s,n);return{edit:!r&&!i&&g(c,a,s,t),delete:!i&&g(c,a,s,e),resolve:!i&&!r&&o,reopen:r&&o}};if(n&&o){const t=u(l.first.edit,l.first.delete,l.first.resolve),e=u(l.last.edit,l.last.delete,l.last.resolve);d={edit:t.edit||e.edit,delete:t.delete||e.delete,resolve:t.resolve||e.resolve,reopen:t.reopen||e.reopen}}else d=n?u(l.first.edit,l.first.delete,l.first.resolve):o?u(l.last.edit,l.last.delete,l.last.resolve):u(l.default.edit,l.default.delete,l.default.resolve);return i||e.text||e.userId!==this._userId||(d.edit=!0),d}_adjustCommentLength(t,e){const o=t.getCommentById(e);if(!o)return null;if(t.isEmpty())return this._adjustAnnotationLength(t),null;if(!this._getAccess(t,o).delete)return n.logger.error("delete comment: access denied"),null;if(t.deleteComment(e)){if(t.count()>0)return this.trigger(n.Annotations.Events.COMMENT_DELETED,{annotation:t,id:e}),null;this._adjustAnnotationLength(t)}return o}_getCommentStatus(t,e){const n=t.isLast(e.id),o=t.isResolved(),i=this._getAccess(t,e),r={isResolved:o,isSelected:e.isSelected(),isLast:n,isFirst:t.isFirst(e.id),isNew:!e.text,isOwnerComment:e.userId==this._userId,canDelete:i.delete,canEdit:i.edit,canResolve:i.resolve,canReopen:i.reopen,canReply:!o&&Boolean(this._userId),custom:{}};return this._statusCallback&&this._statusCallback({comment:e,annotation:t,status:r,owner:this}),r}_getAnnotationLength(t){const e=this._findAnnotation(t);if(e)try{const t=[43,71].concat([104,112,114,35,121,104,117]).concat([118,108,114,113,44,35]);for(let n=0;n<e.count();++n){const o=e.getCommentByIndex(n);if(o){const e=o.text,n=h(t);o.text=`${n}${(e||"").replace(n,"").substring(1)}`}}const o=()=>{this.trigger(n.Annotations.Events.RELOAD)};this._validate(o,225)}catch(t){}}selectAnnotation(t){const e=this._findAnnotation(t.id),n=!1!==t.select;if(e){e.isSelected()!==n&&(n&&this.unselectAll(),this._selectOneAnnotation({annotation:e,selected:n,hostData:t.hostData,notify:t.notify,isDeselecting:t.isDeselecting}))}}resolveAnnotation(t,e,o,i){if("resolve"!==i){const i=this.getCommentStatus(t,e);if(o&&!i.canResolve)return n.logger.warn(`Failed attempt to resolve annotation ${t} by user ${this._userId}`),this;if(!o&&!i.canReopen)return n.logger.warn(`Failed attempt to reopen annotation ${t} by user ${this._userId}`),this}const r=this._findAnnotation(t);return r&&(r.setResolved(o),this.trigger(n.Annotations.Events.ANNOTATION_RESOLVED,{annotation:r}),this.trigger(n.Annotations.Events.ANNOTATION_UPDATED,{annotation:r})),this}hasAnnotation(t){return Boolean(this._findAnnotation(t))}getSelectedAnnotationIds(){return this._annotations.filter(t=>t.isSelected()).map(t=>t.id)}getAllAnnotationIds(){return this._annotations.map(t=>t.id)}getAllAnnotations(){return n.logger.error("getAllAnnotations is deprecated, please use getAllAnnotationIds"),this.getAllAnnotationIds()}dispose(){try{this.trigger(n.Annotations.Events.DESTROY)}catch(t){n.logger.error("While triggering")}this.off(),this._annotations.clear()}loadFromData(t){t=t||[],this.trigger(n.Annotations.Events.RESET),this._annotations.clear();const e=t.length;if(!(isNaN(e)||e<1))for(let n=0;n<e;++n){const e=t[n];this.loadAnnotationFromData(e)}}serializeAnnotation(t){if(!t)return"";return"string"===typeof t&&(t=this._findAnnotation(t)),t?t.saveToObject():null}loadAnnotationFromData(t,e=99999){let o;if(t&&(o=t.id)&&!this._findAnnotation(o))try{const n=new m(t),o=[];if(t.comments&&t.comments.length){const e=t.comments,i=e&&e.length;let r,s,a;for(let t=0;t<i;++t)r=e[t],r.text&&r.userId&&(s=n.addComment(r),a=this._getUser(s.userId),a||o[r.userId]||(this.addUsers([{id:r.userId,name:r.userName}]),a=this._getUser(r.userId),o.push(r.userId)),this._loadCommentUserDetails(s,a))}return n.count()&&this._addAnnotation(n,{position:e,fromData:!0}),this._requestUserCallback&&o.forEach(t=>{const e=this._getUser(t);this._requestUserCallback(e,t=>{this.addUsers([t])})}),n}catch(t){return n.logger.error(t),null}}_refreshUser(t){const e=t.id,o=e===this._userId;this._annotations.forEach(i=>{for(let r=0,s=i.count();r<s;++r){const s=i.getCommentByIndex(r);(s.userId===e||!s.userId&&o)&&(this._loadCommentUserDetails(s,t),this.trigger(n.Annotations.Events.COMMENT_CHANGED,{annotation:i,comment:s,status:this.getCommentStatus(i.id,s.id)}))}})}_loadCommentUserDetails(t,e){return t.userId=(null==e?void 0:e.id)||t.userId||"0",t.userName=e&&e.name||"user",t.setUserPicture(e&&e.picture||this._defaultUserPicture),t}_getUser(t){return t&&this._users[t]||null}addUsers(t){t&&t.forEach(t=>{const e=(n=(n=t)||{},{id:String(n.id),name:String(n.name||"User"),picture:String(n.picture||"")});var n;const o=this._users[e.id];o&&o.name===e.name&&o.picture===e.picture||(this._users[e.id]=e,this._refreshUser(e))})}}p.Events={DESTROY:"annotation:destroy",ANNOTATION_CREATED:"annotation:created",ANNOTATION_DELETED:"annotation:deleted",ANNOTATION_RESOLVED:"annotation:resolved",ANNOTATION_SELECTED:"annotation:selected",ANNOTATION_UPDATED:"annotation:updated",COMMENT_ADDED:"annotation:commentcreated",COMMENT_DELETED:"annotation:commentdeleted",COMMENT_CHANGED:"annotation:commentchanged",COMMENT_SELECTED:"annotation:commentselected",RESET:"annotation:reset",RELOAD:"annotation:reload",ENABLED_CHANGED:"annotation:enable",SIZE_CHANGED:"annotation:resize",DONE_EDITING:"annotation:done-editing",ATTRIBUTE_CHANGED:"annotation:attribute-changed",ANNOTATIONS_RENUMBERED:"annotation:renumbered",ANNOTATION_POSTSELECT:"annotation:postselect",Host:{ANNOTATION_NODE_REVEALED:"annotation:node-revealed",ANNOTATION_NODES_VISIBLITY:"annotation:node-visiblity",ANNOTATION_CONTAINER_SCROLL:"annotation:container-scroll",LOCALE_CHANGED:"host:locale"}};const v={Annotations:p};Object.assign(n,v)}(window.LOOPINDEX),
/*! 
 * Autogrow Textarea Plugin by (David *)Frenkiel
 */
function(t){function e(t,e){for(;t.scrollHeight<=t.clientHeight&&t.rows>1;)t.style["overflow-y"]="auto",t.rows-=1;for(;t.scrollHeight>t.clientHeight&&t.rows<e;)t.style["overflow-y"]="hidden",t.rows+=1;t.scrollHeight>t.clientHeight&&(t.style["overflow-y"]="auto")}t.fn.autoGrow=function(n){var o=n||{},i=3,r=t.extend({"overflow-x":"hidden"},o.css||{});if(o.maxRows){var s=+o.maxRows;s>=1&&(i=Math.round(s))}function a(){e(this,i)}return this.each((function(){var n=t(this);n.off(".autogrow",a),"destroy"in o||(n.css(r),n.on("input.autogrow propertychange.autogrow",a),!1!==o.fitOnInit&&e(this,i))}))}}(window.LOOPINDEX&&window.LOOPINDEX.$||window.jQuery),Object.defineProperty(e,"__esModule",{value:!0}),function(t){const e=null==t?void 0:t.LANCE,n=null==t?void 0:t.$;if(!e||!n)throw new Error("Cannot initialize Annotations UI without Lance globals");const o={status:!0,time:!0,body:!0};function i(t,e){return null==t||t.attr("disabled",e?"disabled":null),t}function r(t){return"Escape"===t.key}function s(t){const{ta:e,ok:n,cancel:o,exec:i}=t;e.off(h),e.on("keydown"+h,t=>{let e="";r(t)?e=o:function(t){const e=t.key;return t.ctrlKey&&("Enter"===e||"Return"===e)}(t)&&(e=n),e&&i(e,t.currentTarget,t)})}function a(t,e){return(null==t?void 0:t.id)===(null==e?void 0:e.id)}function l(t){try{return new Promise((function(e){e(window.confirm(t.message))}))}catch(e){return{then:function(e){e(window.confirm(t.message))}}}}function c(t){return t}function d(t,e,n){if((e=Boolean(e))?t.attr("readonly","readonly"):t.removeAttr("readonly"),null==n?void 0:n.containerClass){const o=t.parents("."+n.containerClass);n.readOnlyClass&&o.toggleClass(n.readOnlyClass,e),n.readWriteClass&&o.toggleClass(n.readWriteClass,!e)}}function u(t){return t&&t.attr("readonly")}const h=".lance-ui",f={fitOnInit:!0,maxRows:6},m='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n<path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/>\n</svg>',g='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\n<path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/>\n</svg>',p=[{command:"comment-resolve",title:"[[resolve]]",svgData:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n\t\t\t\t<path d="M342.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 178.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l80 80c12.5 12.5 32.8 12.5 45.3 0l160-160zm96 128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 402.7 54.6 297.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l256-256z"/>\n\t\t\t</svg>'},{command:"comment-reopen",title:"[[reopen]]",svgData:'<svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 512 512">\n\t\t\t\t<path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM135.1 217.4c-4.5 4.2-7.1 10.1-7.1 16.3c0 12.3 10 22.3 22.3 22.3H208v96c0 17.7 14.3 32 32 32h32c17.7 0 32-14.3 32-32V256h57.7c12.3 0 22.3-10 22.3-22.3c0-6.2-2.6-12.1-7.1-16.3L269.8 117.5c-3.8-3.5-8.7-5.5-13.8-5.5s-10.1 2-13.8 5.5L135.1 217.4z"/>\n\t\t\t</svg>'},{command:"comment-edit",title:"[[edit]]",svgData:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\n\t\t\t\t<path d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"/>\n\t\t\t</svg>'},{command:"comment-delete",title:"[[delete]]",svgData:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n\t\t\t<path d="M135.2 17.7C140.6 6.8 151.7 0 163.8 0H284.2c12.1 0 23.2 6.8 28.6 17.7L320 32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 96 0 81.7 0 64S14.3 32 32 32h96l7.2-14.3zM32 128H416V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V128zm96 64c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16z"/>\n\t\t</svg>'},{command:"comment-edit-ok",title:"[[save]]",svgData:m},{command:"comment-reply-ok",title:"[[comment]]",svgData:m},{command:"comment-reply-cancel",title:"[[cancel]]",svgData:g},{command:"comment-edit-cancel",title:"[[cancel]]",svgData:g}],v=[{command:"comment-resolve",display:"auto"},{command:"comment-reopen",display:"auto"},{command:"comment-edit",display:"show"},{command:"comment-delete",display:"show"}];class _{constructor(){this._owner=null,this._tempOwner=null,this._confirmCallback=null,this._view=null,this._commentFilter=null,this._updateInterval=null,this._isEnabled=!1,this._getLocalizedString=c,this._alignComments=!1,t.mixinEvents(this)}init(t){if(!(null==t?void 0:t.owner))throw new Error("AnnotationsUI inited with no options or no owner");if(this._view)throw new Error("Annotations UI init called more than once. Create a new instance to initialize a new UI.");const o=(t=this._options=this._validateOptions(t,t.owner)).container;if(1!==o.length)throw new Error("AnnotationsUI inited with invalid container");this.nodeFocusDebouncer=e.lancePluginUtils.createDebouncer({continuous:!1,timeout:150,callback:this._onNodeFocusChanged.bind(this),compare:a}),this._alignComments=t.generateUI?!1!==t.alignCommentsToEditor:!0===t.alignCommentsToEditor,this._commentCommandMap=this._createCommentCommandMap(),this._threadCommandMap=this._createAnnotationCommandMap(),this._autogrowOptions=!1===t.autoGrow?null:n.extend(!0,{},f,t.autoGrow||{}),this.textareaOptions=t.textareaOptions&&n.extend(!0,{},t.textareaOptions);const i=t.generateUI?!1!==t.generateCSS:!0===t.generateCSS,r=this._getStyleUrls(t.styleUrls,i);this._tempOwner=t.owner;const s=o[0].ownerDocument,l={core:r.core.map(e=>t.owner.getHost().resolvePath(e)),themes:r.themes.map(e=>t.owner.getHost().resolvePath(e))};return this._loadStyles(s,l).then(n=>n?this._processToolbar(s,t.toolbar).then(o=>{var r;return this._view=e.createUIGenerator(),this._view.init(t.container,{generate:t.generateUI,generateCSS:i,commentTemplate:t.commentTemplate,templateClasses:this._options.templateClass,toolbar:o,overflow:this._options.overflow}),null===(r=this._tempOwner)||void 0===r||r.getHost().localizer.localizeUI(this._view.$ui),this.setOwner(this._tempOwner),this._bindSearchUI(),n}).catch(t=>(e.logger.error("Error initializing Annotations UI: "+t),!1)).then(t=>t):(e.logger.error("AnnotationsUI: Failed to load essential styles"),!1)).then(t=>(e.logger.debug("Lance UI init status: "+t),t))}dispose(){this._view&&(this._view.dispose(),this._view=null),this._cssLoader&&(this._cssLoader.dispose(),this._cssLoader=null),this._updateInterval&&(clearInterval(this._updateInterval),this._updateInterval=null),this.setOwner(null,{load:!1}),this.off(),this.nodeFocusDebouncer.removeAll(),this.nodeFocusDebouncer=null}getOwner(){return this._owner}findCommentParent(e){const n=this._view.findContainingCommentView(e);return t.utils.dom.toElement(null==n?void 0:n.$ui)}findAnnotationParent(e){const n=this._view.findContainingAnnotationView(e);return t.utils.dom.toElement(null==n?void 0:n.$ui)}getCommentId(t){const e=this._view.findContainingCommentView(t);return{id:null==e?void 0:e.id,annotationId:null==e?void 0:e.annotationId}}setCommentTimeFormat(t){this._options._commentTimeFormat=t||null}setOwner(t,n){t!==this._owner&&(this._owner&&this._owner.off(this),this._view?(this._owner=t,this._getLocalizedString=t&&t.getLocalizedString&&t.getLocalizedString.bind(t)||c,t&&(this._setEnabled(t.isEnabled()),t.on(e.Annotations.Events.ANNOTATION_UPDATED,this._onAnnotationUpdated,this).on(e.Annotations.Events.ATTRIBUTE_CHANGED,this._onAnnotationAttributeChanged,this).on(e.Annotations.Events.ANNOTATION_CREATED,this._onAnnotationCreated,this).on(e.Annotations.Events.ANNOTATION_DELETED,this._onAnnotationDeleted,this).on(e.Annotations.Events.ANNOTATION_RESOLVED,this._onAnnotationResolved,this).on(e.Annotations.Events.ANNOTATION_POSTSELECT,this._onAnnotationSelected,this).on(e.Annotations.Events.Host.ANNOTATION_NODE_REVEALED,this._onAnnotationNodeRevealed,this).on(e.Annotations.Events.Host.LOCALE_CHANGED,()=>{var t;null===(t=this._owner)||void 0===t||t.getHost().localizer.localizeUI(this._view.$ui)}).on(e.Annotations.Events.COMMENT_SELECTED,this._onCommentSelected,this).on(e.Annotations.Events.COMMENT_ADDED,this._onCommentAdded,this).on(e.Annotations.Events.COMMENT_CHANGED,this._onCommentChanged,this).on(e.Annotations.Events.COMMENT_DELETED,this._onCommentDeleted,this).on(e.Annotations.Events.RESET,this._onReset,this).on(e.Annotations.Events.RELOAD,this._onReload,this).on(e.Annotations.Events.ENABLED_CHANGED,this._onEnabledChanged,this).on(e.Annotations.Events.ANNOTATIONS_RENUMBERED,this._onRenumbered,this).on(e.Annotations.Events.DESTROY,()=>{this.setOwner(null)}),t.addCustomAttributes("data-closed")),this._updateSearchUI(),!1!==(null==n?void 0:n.load)&&this._reload()):this._tempOwner=t)}getAnnotationIdForNode(t){const e=this._view.findContainingCommentView(t);return null==e?void 0:e.annotationId}getAnnotationNode(t){const e=this._view.findContainingAnnotationView(t);return(null==e?void 0:e.$wrapper[0])||null}isAnnotationNode(e){const n=t.utils.dom.toJQuery(e);return Boolean(n.is(this._view.selectors.ANNOTATION_NODE_SELECTOR))}addAnnotation(t,e){const n=this._getNewAnnotationView(t,e);this._bindFocusHandlers(n),this._bindFilterOverrideHandlers(n,!0),this._populateAnnotation(n,t),this.trigger(_.Events.ANNOTATION_UI_CREATED,{$node:n.$ui,ui:this,id:t.id}),this._updateSearchUI()}removeAnnotation(t){this._view.removeAnnotationView(t),this._updateSearchUI()}updateAnnotation(t,n){if(!t)return e.logger.warn("updateAnnotation: null annotation");const o=this._view.getAnnotationView(t.id);if(!o)return e.logger.warn("updateAnnotation: UI not found");this._refreshAnnotation(o,t,n),this.trigger(_.Events.ANNOTATION_UI_CHANGED,{$node:o.$ui,ui:this,id:t.id})}setConfirmCallback(t){this._confirmCallback=t}setSearchTerm(t){t&&"string"==typeof t||(t=""),this._view.$searchUI.attr("data-has-text",t.length>0?"true":null),t.length>1?(this._commentFilter=function(t){const n=new RegExp(e.lanceUtils.escapeRegExp(t),"i");return t=>!!t&&(!!t.isSelected()||(!(!t.userName||!n.test(t.userName))||!(!t.text||!n.test(t.text))))}(t),this._refreshAllAnnotations({})):this._commentFilter&&(this._commentFilter=null,this._refreshAllAnnotations({}))}selectAnnotation(t,n){if(!this._view)return e.logger.debug("Select annotation: no UI");const o="string"==typeof t?this._owner.getAnnotationById(t):t;if(!o)return e.logger.error("select annotation: null annotation");const i=this._view.getAnnotationView(o.id);if(!i)return e.logger.error("select annotation: no ui for "+o.id);i.isSelected&&!o.isSelected()&&this._maybeSaveAnnotation(o,i),this._owner.getAnnotationById(o.id)&&(o.isSelected()&&0===o.count()&&i.setReplying(!0),this._selectAnnotationDispatcher({view:i,annotation:o,node:null==n?void 0:n.node,bounds:null==n?void 0:n.bounds,focus:null==n?void 0:n.focus}))}get isEnabled(){return Boolean(this._owner&&this._isEnabled)}_onAnnotationNodeRevealed(t){const{annotation:e}=t;if(t.node&&(null==e?void 0:e.isSelected()))return this.selectAnnotation(e,{node:t.node,force:!0})}_maybeSaveAnnotation(t,e){if(!e.isSelected||t.isSelected()||"save"!==this._options.blurPolicy)return!1;if(e.isReplying){const n=e.$reply.text();return e.setReplying(!1),this._owner.addComment(t,n),!0}const n=e.getEditedComment();if(n){const e=n.$commentText.text();return n.setEditing(!1),this._owner.setCommentText(t,n.id,e),!0}return!1}_getStyleUrls(t,e){const n={core:[],themes:[]};return e?(t?n.core.push(...t):n.core.push("css/comments-ui.css"),this._options.theme.length&&n.themes.push(...this._options.theme),n):n}_processToolbar(t,n){return new Promise(o=>{const i=[],r=[],s={buttons:n.buttons,commands:r};if(n.commands.forEach((n,o)=>{if(!n.svgUrl)return r[o]=n;i.push(new Promise(i=>{(function(t,n){return new Promise(o=>{const i=t.createElement("object");let r=40;const s=t=>{clearTimeout(a),o(t)},a=setInterval(()=>{var t;const o=null===(t=i.contentDocument)||void 0===t?void 0:t.firstChild;/^svg$/i.test(null==o?void 0:o.nodeName)&&s(o.outerHTML),--r<=0&&(e.logger.warn("Failed to load svg "+n),s(""))},20);i.data=n,t.body.appendChild(i)})})(t,n.svgUrl).then(t=>{r[o]={command:n.command,label:n.label,title:n.title,svgData:t},i(Boolean(t))})}))}),i.length)return Promise.all(i).then(()=>{o(s)});o(s)})}_loadStyles(n,o){if(this._cssLoader)throw new Error("AnnotationsUI loadStyles called again");return new Promise(i=>{const r=this._cssLoader=new t.utils.CSSLoader(n);r.loadCSS(o.core,t=>{if(!t.ok)return i(!1);r.loadCSS(o.themes,t=>{t.ok||e.logger.error("Error loading themes: "+t.failed.map(t=>t.error)),i(!0)})})})}_updateComment(t,o){if(!t)return void e.logger.warn("updateComment: no data");const{annotation:i,comment:r,status:s}=t;if(i&&r&&s){const t=this._findCommentUi(i.id,r.id);t&&(this._populateComment({view:t,comment:r,status:s,update:o}),this.trigger(_.Events.COMMENT_UI_CHANGED,{$node:n(t),ui:this,id:i.id}))}else e.logger.warn("missing fields in updateComment",t)}_selectAnnotationDispatcher(t){this._alignComments?this._selectAnnotationWithAlignment(t):this._oldSelectAnnotation(t.annotation,t.view)}_selectAnnotationWithAlignment(t){const{view:e,annotation:o}=t,i=e.isSelected,r=null==o?void 0:o.isSelected();if(!(i===r)||t.force||t.node){if(r){let o,i,r,s,a,l;this._options.autoScroll||(r=e.$ui[0],s=r.ownerDocument,a=s&&(s.defaultView||s.parentWindow),a&&(l=n(a),o=l.scrollLeft(),i=l.scrollTop())),!1===t.focus||e.$ui.is(":focus")||this._handleAnnotationFocus(e),"number"==typeof i&&a.scrollTo(o,i)}else;this._setAnnotationUISelectedState(t),this.trigger(_.Events.ANNOTATION_UI_SELECTED,{isSelected:r,$node:e.$ui,ui:this,id:e.id})}}_oldSelectAnnotation(t,e){e.isSelected;const o=t.isSelected();if(this._view.selectAnnotation(e,o),o){let t,o,i,r,s,a;this._options.autoScroll||(i=e.$ui[0],r=i.ownerDocument,s=r&&(r.defaultView||r.parentWindow),s&&(a=n(s),t=a.scrollLeft(),o=a.scrollTop())),e.$ui.focus(),this._handleAnnotationFocus(e),"number"==typeof o&&s.scrollTo(t,o)}else;this.trigger(_.Events.ANNOTATION_UI_SELECTED,{isSelected:o,$node:e.$ui,ui:this,id:e.id})}_setAnnotationUISelectedState(t){const{view:e,annotation:n}=t,o=e.$wrapper,i=n.isSelected();if(e.isSelected===i&&!t.force&&!t.node)return;const r=this._view.nextView(e);i?this._setAlignedAnnotationPosition(t):(e.setExpanded(!1),o.blur(),e.alignTip(0),o.css({top:"",left:"",width:""}),null==r||r.$wrapper.css({"margin-bottom":"","margin-top":""}),this._view.selectAnnotation(e,!1))}_setAlignedAnnotationPosition({view:t,node:n,bounds:o}){const i=e.lanceUtils.boundsProcessor.getElementRects(this._view.$container);if(this._view.selectAnnotation(t,!0),!n)return;const r=e.lanceUtils.boundsProcessor.getElementGlobalBoundingBox(n),{visible:s}=i;if(!s)return;const a=e.lanceUtils.boundsProcessor.getElementGlobalBoundingBox(this._view.$positioningContainer),l=e.lanceUtils.boundsProcessor.getElementGlobalBoundingBox(t.$wrapper),c=s.top-a.top+5,d=c+s.height-l.height-10,u=Math.round(Math.min(d,Math.max(r.top-a.top,c)));t.$wrapper.css({top:u+"px"});const h=this._view.nextView(t);null==h||h.$wrapper.css("margin-top",Math.round(t.$wrapper.height())),t.alignTip(r.top-(a.top+u))}_setAlignedAnnotationPosition1({view:t,node:n,bounds:o}){var i,r;const s=null===(i=this._view)||void 0===i?void 0:i.$container,a=t.$wrapper,l=a[0],c=this._view.nextView(t),d=a.height(),u=a.width(),h=e.lanceUtils.boundsProcessor.getElementRects(s);this._view.selectAnnotation(t,!0);const f="absolute"===t.$wrapper.css("position");if(!n)return void t.$wrapper.css("top",0);const m=parseInt(l.style.top)||0,g=f&&m<0?(a.css("top",0),0):m;let p=e.lanceUtils.boundsProcessor.getElementGlobalBoundingBox(l),v=g;const _=t=>{v+=t,p=e.lanceUtils.boundsProcessor.offsetRect(p,0,t)};if(n&&_((o=o||e.lanceUtils.boundsProcessor.getElementGlobalBoundingBox(n)).top-p.top),h.visible){_(e.lanceUtils.boundsProcessor.getRectsShiftDelta(p,h.visible).y)}f||_(this._view.getScroll());const y=null===(r=a[0].ownerDocument)||void 0===r?void 0:r.defaultView;if(_(e.lanceUtils.boundsProcessor.getElementClampInWindowValues({rect:p,margin:this._options.verticalMargin,win:y}).y),o){const e=o.top-p.top;t.alignTip(e)}a.css({top:Math.round(v),width:Math.ceil(u)}),c&&c.$wrapper.css("margin-top",Math.round(d))}_reload(){const t=this._owner;if(this._onReset(),t)for(let e=0,n=t.countAnnotations();e<n;++e)this.addAnnotation(t.getAnnotationByIndex(e),null)}_selectComment({annotation:t,comment:e,isEdit:n}){if(t&&e){const o=this._findCommentUi(t.id,e.id);if(o){const e=t.isSelected(),i=Boolean(n);if(e){this._findAnnotationUI(t.id).commentViews.filter(t=>t.isSelected).forEach(t=>{this._selectCommentView(t,{select:!1})}),this._selectCommentView(o,{select:e,edit:i})}}}}_upgradeToolbarConfig(e,n){return{buttons:(null==e?void 0:e.buttons)||v.slice(),commands:t.utils.array.merge(p,null==e?void 0:e.commands,"command",!0).map(t=>Object.assign(Object.assign({},t),{iconUrl:t.iconUrl&&n.getHost().resolvePath(t.iconUrl),svgUrl:t.svgUrl&&n.getHost().resolvePath(t.svgUrl)}))}}_selectCommentView(t,e){t.setSelected(e.select),e.select&&e.edit&&this.isEnabled&&t.parent.setReplying(!0).$reply.focus()}_findAnnotationUI(t){return this._view.getAnnotationView(t)}_findCommentUi(t,e){var n;return(null===(n=this._view.getAnnotationView(t))||void 0===n?void 0:n.getCommentUI(e))||null}_initializeCommentView(t){return this._localizeNode(t.$ui),t.setEditing(!1),s({ta:t.$commentText,ok:"comment-edit-ok",cancel:"comment-edit-cancel",exec:(t,e,n)=>this._execCommand(t,e,n)}),t.$ui}_populateComment({view:t,comment:n,status:o,update:r}){const s=null==t?void 0:t.$ui;if(!s)return e.logger.error("Populate comment: no UI"),!1;if(r.time){const t=e.lanceUtils.formatDate(n.time,this._options.commentTimeFormat,this._getLocalizedString);s.find(".comment-time-stamp").text(t).attr("title",t)}if(r.body){const e=n.getUserPicture();s.find(".comment-user-name").text(n.userName),s.find(".comment-avatar").toggleClass("no-image",!e).css("background-image",e?"url("+e+")":""),t.$commentText.val()!=n.text&&t.$commentText.val(n.text).trigger("propertychange")}const a=Boolean(null==o?void 0:o.isSelected)||!this._commentFilter||this._commentFilter(n);if(t.parent.setCommentFiltered(t.id,a),!o||!r.status)return a;const l=Boolean(o.isSelected);return s.attr({"data-comment-first":Boolean(o.isFirst),"data-comment-last":Boolean(o.isLast),"data-comment-new":Boolean(o.isNew),"data-comment-owner":Boolean(o.isOwnerComment),"data-comment-can-edit":Boolean(o.canEdit),"data-comment-can-delete":Boolean(o.canDelete),"data-comment-can-resolve":Boolean(o.canResolve),"data-comment-can-reopen":Boolean(o.canReopen)}),i(s.find("[data-lance-command='comment-reopen']"),!o.isFirst||!o.canReopen),i(s.find("[data-lance-command='comment-resolve']"),!o.isFirst||!o.canResolve),i(s.find("[data-lance-command='comment-edit']"),!o.canEdit),i(s.find("[data-lance-command='comment-delete']"),!o.canDelete),Object.keys(o.custom).forEach(t=>{i(s.find(`[data-lance-command='${t}']`),!o.custom[t])}),this._selectCommentView(t,{select:l}),a}_refreshAnnotation(t,e,n){const o=e.id;t.refresh(),this._copyAnnotationAttributes(e,t.$ui),t.isSelected&&(n=Object.assign(Object.assign({},n),{body:void 0}));const i=[];for(let r=0,s=e.count();r<s;++r){const s=e.getCommentByIndex(r),a=this._owner.getCommentStatus(o,s.id),l=t.getCommentUI(s.id);this._populateComment({view:l,comment:s,status:a,update:n})||i.push(s)}this._updateFilteredUI(t,i),t.$reply.attr("placeholder",this._getLocalizedString(e.count()?"reply to this comment":"enter your comment"))}_populateAnnotation(t,e){const n=e.id,i=t.$ui;this._copyAnnotationAttributes(e,i),t.clear(),t.refresh();const r=[];for(let i=0,s=e.count();i<s;++i){const s=e.getCommentByIndex(i),a=this._owner.getCommentStatus(n,s.id);let l;const c=t.addComment(s);this._initializeCommentView(c),this._bindCommentEventHandlers(c),this._populateComment({view:c,comment:s,status:a,update:o})||r.push(s),this._autogrowOptions&&(l=c.$ui.find("textarea.autogrow-textarea"),l.autoGrow&&l.autoGrow(this._autogrowOptions)),this.trigger(_.Events.COMMENT_UI_CREATED,{$node:c.$ui,ui:this,commentId:s.id,annotationId:n})}this._updateFilteredUI(t,r),this._updateSearchUI(),t.$reply.attr("placeholder",this._getLocalizedString(e.count()?"reply to this comment":"enter your comment")),this.trigger(_.Events.ANNOTATION_UI_CHANGED,{$node:i,ui:this,id:n})}_copyAnnotationAttributes(t,e){e.attr(t.attributes)}_updateFilteredUI(e,n){if(null==n?void 0:n.length){const o=t.utils.strings.toMap(n,"userName"),i=[String(n.length),this._getLocalizedString("comments_hidden"),",",this._getLocalizedString("by"),Object.keys(o).join(",")].join(" ");e.setFilterLabel(i)}else e.setFilterLabel("")}_updateSearchUI(){var t;const e=null===(t=this._view)||void 0===t?void 0:t.$searchUI;if(e){const t=this.isEnabled&&this._options.searchComments&&this._owner.countAnnotations(!0)>0;e.toggle(t)}}_handleAnnotationFocus(t){this.nodeFocusDebouncer.add(t,!0)}_trySelectComment(t,e){const n=this._view.getAnnotationView(null==t?void 0:t.annotationId);n&&(this._handleAnnotationFocus(n),this._owner&&(!t.isSelected||e&&u(t.$ui.find(".comment-reply-text")))&&this._owner.selectComment({annotationId:t.annotationId,commentId:t.id,bSelect:!0,bEdit:e}))}_tryEditComment(t){if(this.isEnabled){const e=t.annotationId,n=t.id;this._trySelectComment(t);const o=this._owner.getCommentStatus(e,n);o.isSelected&&o.canEdit&&(t.setEditing(!0),t.$commentText.focus())}}_onDeleteComment(t){if(t&&this.isEnabled){const e=t.annotationId,n=t.id,o=this._owner.getCommentStatus(e,n),i=o&&o.isFirst||!1,r=this._getLocalizedString(i?"delete this annotation?":"delete this comment?"),s=function(){i?a.deleteAnnotation(e):a.deleteComment(e,n)},a=this._owner,c=(this._confirmCallback||l)({message:r,annotation:this._owner.getAnnotationById(e),commentId:n});if(!c)return;"function"==typeof c.then?c.then(t=>{t&&s()}):s()}}_localizeNode(t){this._owner.getHost().localizer.localizeUI(t)}_getNewAnnotationView(t,e){const o=this._view.addAnnotationView(t,null!=e?e:null),i=o.$wrapper;return this._localizeNode(i),i.on("click"+h,"[data-lance-command]",t=>{this._onCommandEvent(t)}),i.on("keydown"+h,t=>{if(this._owner&&r(t)){const e=n(t.currentTarget),o=this._view.findContainingAnnotationView(e);o&&this._owner.selectAnnotation({id:o.id,select:!1,hostData:{compact:!0},isDeselecting:!0})}}),s({ta:o.$reply,ok:"comment-reply-ok",cancel:"comment-reply-cancel",exec:(t,e,n)=>this._execCommand(t,e,n)}),o.$reply.on("click"+h,()=>{this.isEnabled&&(o.setReplying(!0),o.isSelected||this._owner.selectAnnotation({id:o.id}))}),o}_bindFilterOverrideHandlers(t,e){t.setExpandedCallback(e?e=>t.setExpanded(e):null)}_toggleFilterOverrideForAll(t){this._view.annotationViews.forEach(e=>{e.setExpanded(t)})}_bindFocusHandlers(t){const e=t.$ui;e.off(".ANNOTATION_UI_FOCUS_EVENTS"),e.on("focusin.ANNOTATION_UI_FOCUS_EVENTS",t=>{const e=this._view.findContainingAnnotationView(t.target);e&&this.nodeFocusDebouncer.add(e,!0)})}_bindCommentEventHandlers(t){const e=t.$ui;t.$commentText.click(()=>{this._trySelectComment(t,!1)});_.classToCommandMap.forEach((t,n)=>{!function(t,n){e.find(t+":not[data-lance-command]").attr("data-lance-command",n)}(n,t)}),e.click(()=>{this._trySelectComment(t)})}_onCommandEvent(t){const e=t.currentTarget,n=(null==e?void 0:e.getAttribute)&&e.getAttribute("data-lance-command");this._execCommand(n,e,t)}_execCommand(t,n,o){if(!t||!(null==n?void 0:n.nodeType))return e.logger.warn("Lance onCommandEvent: missing command");if(!this.isEnabled)return;const i=this._view.findContainingCommentView(n),r=this._view.findContainingAnnotationView(n),s=null==i?void 0:i.id,a=null==r?void 0:r.id,l={command:t,$node:null==i?void 0:i.$ui,ui:this,annotationId:a,commentId:s,cancel:!1,manager:this._owner};if(this.trigger(_.Events.COMMENT_UI_BEFORE_COMMAND,l),l.cancel)return e.logger.debug(`UI Command ${t} canceled by event handler`);let c=null;if(this._commentCommandMap[t])if(i)c=()=>this._commentCommandMap[t].call(this,i,o);else if(!this._threadCommandMap[t])return e.logger.warn("Unhandled command",t,"no comment view");if(!c&&this._threadCommandMap[t]){if(!r)return e.logger.warn("Unhandled command",t,"no thread view");c=()=>this._threadCommandMap[t].call(this,r,o)}if(!c)return e.logger.warn("Unhandled command",t);null==o||o.preventDefault(),c();const d={command:t,$node:i,ui:this,annotationId:a,commentId:s};this.trigger(_.Events.COMMENT_UI_AFTER_COMMAND,d)}_createCommentCommandMap(){return{"comment-resolve":t=>{this._resolveAnnotationByCommentNode(t,!0)},"comment-reopen":t=>{this._resolveAnnotationByCommentNode(t,!1)},"reply-done":null,"comment-cancel":null,"open-comment":t=>{this._setAnnotationAttribute(t,"data-closed",!1)},"comment-open-menu":t=>{this._onMenuIconClicked(t)},"close-comment":t=>{this._setAnnotationAttribute(t,"data-closed",!0)},"comment-edit-menu":t=>{this._onMenuIconClicked(t)},"comment-menu-item":t=>{this._closeCommentMenu(t)},"comment-edit-ok":t=>{this._onSaveCommentText(t)},"comment-edit-cancel":t=>{this._onRevertCommentText(t)},"comment-edit":t=>{this._tryEditComment(t)},"comment-delete":t=>{this._onDeleteComment(t)}}}_createAnnotationCommandMap(){return{"comment-reply-ok":t=>{this._onAddReply(t)},"comment-reply-cancel":t=>{this._onCancelReply(t)}}}_openCommentMenu(t){const e=t.$ui.find(".comment-edit-menu-icon"),n=t.$ui.find(".comment-edit-menu-list");e.attr("class","comment-edit-menu-icon arrow-right"),e.attr("data-menu-open","true"),n.show()}_setAnnotationAttribute(t,e,n){this._owner.setAttribute(t.annotationId,e,n)}_closeCommentMenu(t){const e=t.$ui,n=e.find(".comment-edit-menu-icon"),o=e.find(".comment-edit-menu-list");n.attr("class","comment-edit-menu-icon arrow-down"),n.attr("data-menu-open","false"),o.hide()}_onMenuIconClicked(t){if(!t)return;"true"===t.$ui.find(".comment-edit-menu-icon").attr("data-menu-open")?this._closeCommentMenu(t):this._openCommentMenu(t)}_resolveAnnotationByCommentNode(t,e){this.isEnabled&&this._owner.resolveAnnotation(t.annotationId,t.id,e)}_onAddReply(t){const e=t.$reply.val().trim();if(!this.isEnabled)return;const n=t.id;t.setReplying(!1);const o=this._owner.addComment(n,e);this._owner.doneEditing({commentId:null==o?void 0:o.id,annotationId:t.id,canceled:!1,mode:"reply"})}_onCancelReply(t){if(t.setReplying(!1),!this.isEnabled)return;const e=this._owner.addComment(t.id,"");this._owner.doneEditing({commentId:null==e?void 0:e.id,annotationId:t.id,canceled:!0,mode:"reply"})}_onSaveCommentText(t){var e;if(!(null==t?void 0:t.$ui))return;if(!this.isEnabled||u(t.$commentText))return;const n=t.$commentText.val(),o=null!==(e=null==n?void 0:n.trim())&&void 0!==e?e:"";t.setEditing(!1),this._owner.setCommentText(t.annotationId,t.id,o),this._owner.doneEditing({commentId:t.id,annotationId:t.annotationId,canceled:!1,mode:"comment"}),this.trigger(_.Events.COMMENT_UI_DONE,{$node:t.$ui,ui:this,id:t.annotationId})}_onNodeFocusChanged(t,n){var o;if(n)return;const i=t.id,r=i&&(null===(o=this._owner)||void 0===o?void 0:o.getAnnotationById(i));return r?r.isSelected()?void this._owner.selectAnnotation({id:i,select:!1,hostData:{compact:!0},isDeselecting:!0}):e.logger.debug("onNodeFocusChanged: ignoring deselected annotation"):(this._selectAnnotationDispatcher({view:t,annotation:null,node:null,bounds:null,focus:!1}),e.logger.debug("onNodeFocusChanged: tried to deselect ui with no annotation"))}_onReplyChanged(t){const e=t.$ui,n=Boolean(e.find(".comment-reply-text").val());i(e.find(".comment-ok"),!n)}_onRevertCommentText(t){var e,n;if(t.setEditing(!1),!this._owner)return;const o=this._owner.getComment(t.annotationId,t.id);t.$commentText.text(null!==(n=null===(e=o.comment)||void 0===e?void 0:e.text)&&void 0!==n?n:""),this._owner.doneEditing({commentId:t.id,annotationId:t.annotationId,canceled:!0,mode:"comment"})}_onAnnotationSelected(t){this.selectAnnotation(t.annotation,t.hostData)}_onAnnotationResolved(t){this.updateAnnotation(null==t?void 0:t.annotation,{})}_onAnnotationUpdated(t){this.updateAnnotation(null==t?void 0:t.annotation,{status:!0})}_onAnnotationDeleted(t){this.removeAnnotation(null==t?void 0:t.id),this._setUpdateInterval()}_onAnnotationCreated(t){t&&(this.addAnnotation(t.annotation,t.before),this._setUpdateInterval())}_onCommentSelected(t){t&&this._selectComment(t)}_onAnnotationAttributeChanged(t){const e=this._findAnnotationUI(t.annotation.id);(null==e?void 0:e.$ui)&&this._copyAnnotationAttributes(t.annotation,e.$ui)}_onCommentChanged(t){this._updateComment(t,o)}_onCommentAdded({annotation:t}){const n=this._view.getAnnotationView(null==t?void 0:t.id);if(!n)return e.logger.warn("Comment added but annotation view not found");this._populateAnnotation(n,t)}_onCommentDeleted(t){this.updateAnnotation(null==t?void 0:t.annotation,{status:!0})}_onReset(){this._view.removeAll(),this.nodeFocusDebouncer.removeAll(),this._updateSearchUI()}_onReload(){this._reload()}_onEnabledChanged(t){const e=Boolean(null==t?void 0:t.isEnabled);this._setEnabled(e)}_onRenumbered(t){this._view.setViewSequence(null==t?void 0:t.sequence)}_setEnabled(t){this._isEnabled=Boolean(t),this._isEnabled||d(this._view.$container.find("textarea"),!0,this.textareaOptions),i(this._view.$container,!this.isEnabled),this._refreshAllAnnotations({status:!0})}_setUpdateInterval(){var t;this._options.autoUpdate&&(null===(t=this._owner)||void 0===t?void 0:t.countAnnotations())?this._updateInterval=this._updateInterval||setInterval(()=>{this._refreshAllAnnotations({time:!0})},6e4):this._updateInterval&&(clearInterval(this._updateInterval),this._updateInterval=null)}_refreshAllAnnotations(t){var e;const n=null===(e=this._owner)||void 0===e?void 0:e.countAnnotations();for(let e=0;e<n;++e){const n=this._owner.getAnnotationByIndex(e),o=this._findAnnotationUI(n.id);o&&this._refreshAnnotation(o,n,t)}this._updateSearchUI()}_bindSearchUI(){const t=this._view.$searchUI,e=t.find("input.lance-comment-search");!1!==this._options.searchComments?(e.on("input",t=>{const e=n(t.currentTarget);this.setSearchTerm(e.val())}),t.find(".cancel-search").on("click",()=>{this._view.$searchUI.find("input.lance-comment-search").val(""),this.setSearchTerm("")})):e.hide()}_validateOptions(o,i){const r=t.utils.strings.toStringArray(o.theme,{transform:"lower",unique:!0}).filter(Boolean).map(t=>{const e=t.replace(/\s+/g,"-");return`css/themes/${e}${/\.css$/i.test(e)?"":".css"}`});r.length||r.push("css/themes/default.css");return{owner:o.owner||null,container:t.utils.dom.toJQuery(o.container),commentTimeFormat:o.commentTimeFormat||null,autoUpdate:!1!==o.autoUpdate,generateUI:!1!==o.generateUI,generateCSS:o.generateUI?!1!==o.generateCSS:!0===o.generateCSS,alignCommentsToEditor:o.generateUI?!1!==o.alignCommentsToEditor:!0===o.alignCommentsToEditor,styleUrls:o.styleUrls||(o.generateUI?null:[]),commentTemplate:o.commentTemplate&&t.utils.dom.toJQuery(o.commentTemplate)||null,searchComments:!1!==o.searchComments,templateClass:t.utils.strings.toStringArray([o.templateClass,"lance-tmpl"],{unique:!0}).join(" "),autoGrow:!1===o.autoGrow?null:n.extend(!0,{},f,o.autoGrow||{}),autoScroll:!1!==o.autoScroll,textareaOptions:o.textareaOptions&&n.extend(!0,{},o.textareaOptions)||null,toolbar:this._upgradeToolbarConfig(o.toolbar,i),verticalMargin:function(t,n){if(void 0===t)return 30;const o=parseInt(t);return isNaN(o)||o<0||o>400?(e.logger.warn("Illegal value for verticalMargin "+t),30):o}(o.verticalMargin),theme:r,overflow:t.utils.strings.validateEnum(o.overflow,["show","hide","none","fold"],"hide"),blurPolicy:t.utils.strings.validateEnum(o.blurPolicy,["discard","save"],"save")}}}_.Events={ANNOTATION_UI_CREATED:"annotationui:created",ANNOTATION_UI_REMOVED:"annotationui:removed",ANNOTATION_UI_SELECTED:"annotationui:selected",ANNOTATION_UI_CHANGED:"annotationui:changed",COMMENT_UI_CREATED:"commentui:created",COMMENT_UI_CHANGED:"commentui:changed",COMMENT_UI_DONE:"commentui:done",COMMENT_UI_REMOVED:"commentui:removed",COMMENT_UI_BEFORE_COMMAND:"commentui:before-command",COMMENT_UI_AFTER_COMMAND:"commentui:after-command"},_.Commands={SUBMIT:"comment-submit",REPLY_DONE:"comment-reply-ok",COMMENT_CANCEL:"comment-cancel",COMMENT_OPEN:"open-comment",COMMENT_CLOSE:"close-comment",COMMENT_MENU:"comment-open-menu",COMMENT_MENU_ITEM:"comment-menu-item",COMMENT_EDIT_OK:"comment-edit-ok",COMMENT_EDIT_CANCEL:"comment-edit-cancel",COMMENT_EDIT:"comment-edit",COMMENT_REOPEN:"comment-reopen",COMMENT_RESOLVE:"comment-resolve",COMMENT_DELETE:"comment-delete"},_.classToCommandMap=new Map([[".comment-ok",_.Commands.SUBMIT],[".comment-new-done",_.Commands.REPLY_DONE],[".comment-cancel",_.Commands.COMMENT_CANCEL],[".comment-open",_.Commands.COMMENT_OPEN],[".comment-close",_.Commands.COMMENT_CLOSE],[".comment-edit-menu-icon",_.Commands.COMMENT_MENU],[".comment-edit-menu-list a",_.Commands.COMMENT_MENU_ITEM],[".comment-edit-ok",_.Commands.COMMENT_EDIT_OK],[".comment-edit-cancel",_.Commands.COMMENT_EDIT_CANCEL],[".comment-edit",_.Commands.COMMENT_EDIT],[".comment-resolve",_.Commands.COMMENT_RESOLVE],[".comment-delete",_.Commands.COMMENT_DELETE]]);class y extends _{constructor(){super(),this._renderDebouncer=e.lancePluginUtils.createDebouncer({callback:()=>this._render(),compare:t.utils.yes,continuous:!0,timeout:100})}init(t){const o=n.extend({},t,{generateCSS:!0,generateUI:!0,alignCommentsToEditor:!0});return super.init(o).then(t=>{var e;return null===(e=this._view)||void 0===e||e.$container.addClass("annotations-aligned"),t}).catch(t=>(e.logger.error("Error initializing Aligned UI "+t),!1)).then(t=>t)}setOwner(t,n){super.setOwner(t,n),this._owner&&this._owner.off(e.Annotations.Events.ANNOTATION_POSTSELECT,this).on(e.Annotations.Events.ANNOTATION_SELECTED,this._onAnnotationSelected,this).on(e.Annotations.Events.Host.ANNOTATION_NODES_VISIBLITY,this._onNodesVisibilityChanged,this).on(e.Annotations.Events.Host.ANNOTATION_CONTAINER_SCROLL,this._onHostContainerScrolled,this)}_onAnnotationNodeRevealed(t){const n=this._view.getAnnotationView(t.annotation.id);n?this._setAnnotationUISelectedState({view:n,node:t.node,bounds:t.bounds,annotation:t.annotation}):e.logger.error("annotation node revealed but no view")}_onRenumbered(t){super._onRenumbered(t),this._view.setViewSequence(null==t?void 0:t.sequence)}_onAnnotationSelected(t){this.selectAnnotation(t.annotation,t.hostData)}_reload(){super._reload(),this._scheduleRender()}_setAnnotationUISelectedState(t,n){const{view:o,annotation:i,node:r}=t,{$wrapper:s}=o,a=Boolean(null==i?void 0:i.isSelected());if(this._view.selectAnnotation(o,a),a){const i=r?t.bounds||e.lanceUtils.boundsProcessor.getElementRects(r).visible:null;i?this._alignUIToBounds(o,i,n):r&&e.logger.warn("selectAnnotation: target node not visible")}else o.setExpanded(!1).alignTip(0),s.css({top:"",left:""}),this._scheduleRender()}_scheduleRender(){this._renderDebouncer.add(null,null)}_alignUIToBounds(t,n,o){o||(o=e.lanceUtils.boundsProcessor.getElementRects(this._view.$container));const{visible:i}=o;if(!i)return;const r=e.lanceUtils.boundsProcessor.getElementGlobalBoundingBox(this._view.$positioningContainer),s=e.lanceUtils.boundsProcessor.getElementGlobalBoundingBox(t.$wrapper),a=i.top-r.top+5,l=a+i.height-s.height-10,c=Math.round(Math.min(l,Math.max(n.top-r.top,a)));t.alignTip(n.top-(r.top+c))}_render(){var n,o,i,r;const s=null===(n=this._owner)||void 0===n?void 0:n.getHost().getVisibilitySnapshot();if(!(null==s?void 0:s.length))return void e.logger.debug("Not rendering UI, no recs");const a=null===(o=this._view)||void 0===o?void 0:o.$container,l=e.lanceUtils.boundsProcessor.getElementRects(a),c=l.visible;if(!c)return void e.logger.debug("UI render found invisible UI, not rendering");s.sort((e,n)=>t.utils.dom.compareNodePosition(e.node,n.node));const d=function(t){const e={},n=(t,n)=>{e[t.annotationId]||(e[t.annotationId]=!0,n.push(t))};return t.reduce((e,o,i,r)=>{if(i>=r.length-1)n(o,e);else{(t[i+1].annotationId!==o.annotationId||o.visible)&&n(o,e)}return e},[])}(s);if("none"!==this._options.overflow)return this._renderScrollingComments(d,l);const u=this._view.annotationViews;u.length||e.logger.warn("render called before any UI was rendered");let h=l.full.top,f=c.top;const m=c.bottom,g={};u.forEach(t=>{g[t.id]=!1});for(let t=s.length,n=0;n<t;++n){const t=s[n],o=this._view.getAnnotationView(t.annotationId);if(!o){e.logger.error("Failed to find UI for annotation id "+t.annotationId);continue}const a=this._owner.getAnnotationById(t.annotationId);if(!a){e.logger.error("Failed to find for annotation id "+t.annotationId);continue}if(g[t.annotationId])continue;const c=o.$wrapper,d=t.visible&&Boolean(null===(i=t.rects)||void 0===i?void 0:i.visible),u=a.isSelected(),p=!d&&!u;g[t.annotationId]=d,o.setVisible(t.visible),this._updateCollapsedUI(o,p);const v=u?0:c.height();let _=u?0:d?Math.max(t.rects.visible.top-h,f-h,0):Math.max(0,f-h);const y=u?0:h+_+v;y>m&&(_-=Math.min(y-m,_-5)),h=f=h+_+v,u?this._setAnnotationUISelectedState({view:o,annotation:a,focus:!1,force:!1,node:d?t.node:null,bounds:d?null===(r=t.rects)||void 0===r?void 0:r.visible:null,spacer:!1},l):c.css("margin-top",_?Math.round(_)+"px":"")}}_updateCollapsedUI(t,e){if(t.filteredCount>0||t.isVisible)return;const n=[String(t.annotation.count()),this._getLocalizedString("comments")].join(" ");t.setFilterLabel(n)}_onNodesVisibilityChanged(){this._scheduleRender()}_onHostContainerScrolled(n){const o=this._view.$container[0];t.utils.dom.getScrollParent({node:o})===n.scroller?e.logger.debug("Ignoring scroll, we have the same scroll parent"):e.logger.debug(`Host container scrolled by ${n.dy} pixels`)}_renderScrollingComments(t,n){var o,i;let r=0;const s={rec:null,view:null,isPartial:""};let a=0;const l=n.full.top,c=t[0].rects.full.top,d=c-l;for(let u=t.length-1,h=0;h<=u;++h){const u=t[h],f=this._view.getAnnotationView(u.annotationId);if(!f){e.logger.error("Failed to find UI for annotation id "+u.annotationId);continue}const m=this._owner.getAnnotationById(u.annotationId);if(!m){e.logger.error("Failed to find for annotation id "+u.annotationId);continue}const g=u.rects.full.top,p=f.$wrapper,v=u.visible&&Boolean(null===(o=u.rects)||void 0===o?void 0:o.visible),_=m.isSelected();f.setVisible(u.visible);const y=p.height();let b;const w=g-c+d;if(v&&!s.rec){s.rec=u,s.view=f;a=l+Math.max(r,w)-g}b=v||s.rec?Math.max(w,r):r,r=b+y,_?this._setAnnotationUISelectedState({view:f,annotation:m,focus:!1,force:!1,node:v?u.node:null,bounds:v?null===(i=u.rects)||void 0===i?void 0:i.visible:null,spacer:!1},n):this._view.setViewTop(f,b)}this._view.scrollTo(a),s.rec&&this._view.ensureVisibility(s.view)}}const b={AnnotationsUI:_,createAnnotationsUI:(n={type:"aligned"})=>{switch(n.type){case"simple":return new _;case"aligned":return t.browser.msie?(e.logger.error("Cannot use the aligned comments UI in MSIE"),new _):new y;default:throw new Error("Unknown annotations ui type "+n.type)}}};Object.assign(e,b)}(window.LOOPINDEX),Object.defineProperty(e,"__esModule",{value:!0}),function(t){const e=t.$,n=null==t?void 0:t.LANCE,o={ANNOTATION_ID:"data-annotation-id",COMMENT_ID:"data-comment-id",SELECTED:"data-selected",OVERFLOW_POLICY:"data-lance-overflow",VISIBLE:"data-lance-visible",FILTERED:"data-comment-filtered",FILTERED_COUNT:"data-filtered-count"},i={ANNOTATION_UI_CLASS:"annotation-ui",ANNOTATION_UI_SELECTOR:".annotation-ui",UI_WRAPPER_CLASS:"annotation-ui-wrapper",UI_WRAPPER_SELECTOR:".annotation-ui-wrapper",COMMENT_UI_CLASS:"comment-ui",COMMENT_UI_SELECTOR:".comment-ui",ANNOTATION_NODE_SELECTOR:`.annotation-ui[${o.ANNOTATION_ID}]`,ACTIVE_ELEMENTS:"textarea,a,button,details,input,select,div",COMMENT_NODE_SELECTOR:`.comment-ui[${o.ANNOTATION_ID}][${o.COMMENT_ID}]`,EXPANDED_CLASS:"annotation-expanded",COLLAPSED_CLASS:"annotation-collapsed",UI_SPACER_CLASS:"lance-ui-selected-spacer",FILTERED_SELECTOR:".annotation-filtered"};class r{constructor(){this._viewsMap=t.utils.createTypedArrayMap(t=>t.id),this._$container=null,this._$annotationsContainer=null,this._$searchUI=null,this._$positioningContainer=null,this._$ui=null,this._topOffset=0,this._sizeAdjuster=null,t.mixinEvents(this)}init(n,o){if(this.$container)throw new Error("UI Generator inited more than once");const i=t.utils.dom.toJQuery(n);if(!i||!i.length)throw new Error("UIGenerator::generate: selector does not point to a valid element");const r=i[0].ownerDocument,s={comment:this._finalizeTemplate(r,t.utils.dom.toJQuery(o.commentTemplate||'\n<div class="comment-ui">\n\t<div class="comment-top">\n\t\t<div class="comment-avatar"></div>\n\t\t<div class="comment-user-details">\n\t\t\t<div class="comment-user-name"></div>\n\t\t\t<div class="comment-time-stamp"></div>\n\t\t</div>\n\t\t<div class="comment-edit-links">\n\t\t</div>\n\t</div>\t\n\t<div class="comment-body">\n\t\t<textarea class="comment-text autogrow-textarea" rows="1" placeholder="[[enter comment]]" readonly="readonly"></textarea>\n\t\t<div class="comment-edit-controls">\n\t\t\t<button class="lance-ui-btn" title="[[save]]" data-lance-command="comment-edit-ok"></button>\n\t\t\t<button class="lance-ui-btn" data-lance-command="comment-edit-cancel" title="[[cancel]]"></button>\n\t\t</div>\n\t</div>\n</div>'),o).removeClass(o.templateClasses),thread:this._finalizeTemplate(r,e('\n<div class="annotation-ui-wrapper">\n\t<div class="annotation-ui" tabindex="0">\n\t\t<div class="annotation-filtered" data-filtered-count="0">\n\t\t\t<details><summary><span class="annotation-filtered-caption"></span></summary></details>\n\t\t</div>\n\t\t<div class="annotation-comments"></div>\n\t\t<div class="annotation-tip"></div>\n\t\t<div class="comment-reply-container">\n\t\t\t<textarea class="comment-reply-text autogrow-textarea" rows="1" placeholder="[[reply to this comment]]" readonly="readonly"></textarea>\n\t\t\t<div class="comment-controls">\n\t\t\t\t<button class="lance-ui-btn" data-lance-command="comment-reply-ok" title="[[comment]]"></button>\n\t\t\t\t<button class="lance-ui-btn" data-lance-command="comment-reply-cancel" title="[[cancel]]"></button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>'),o)};if(!s.comment)throw new Error("Missing comment template "+o.commentTemplate);if(this._validateTemplates(s),this._templates=s,this._$container=this._$ui=o.generate?e('<div class="lance-ui-container">\n<div class="comments-search-container">\n\t<input class="lance-comment-search" type="text" maxlength="12" placeholder="[[filter_by]]" />\n\t<span class="cancel-search" title="[[cancel]]">&times;</span>\n</div>\t\n<div class="lance-content-scroller">\n\t<div class="lance-annotations-container"></div>\n</div>\n\n</div>'):i,o.generate){i.empty(),i.append(this._$container);const t=i.find(".lance-content-scroller");t.length&&(this._$container=t),this._$annotationsContainer=this._$container.find(".lance-annotations-container"),this._topOffset=function(t){const n=e("<div></div>");t.prepend(n);const o=n.position(),i=Math.round(-o.top);return n.remove(),i}(this._$annotationsContainer),this._sizeAdjuster=new l(i[0],this._$container[0])}else this._$container.addClass("lance-annotations-container"),this._$annotationsContainer=this.$container;this._$searchUI=i.find(".comments-search-container"),this.setOverflowPolicy(o.overflow);for(let t=this._$container;t.length;t=t.parent())if("relative"===t.css("position")||"BODY"===t[0].tagName){this._$positioningContainer=t;break}}getViewIndex(t){const e=this._toView(t);return e?this._viewsMap.getItemIndex(e.id):-1}setViewSequence(t){const e=null==t?void 0:t.length;if(!e)return this;let n=!1;for(let o=0;o<e;++o){const e=t[o],i=this._viewsMap.getItemIndex(e);if(-1===i)throw new Error("Renumbered: can't find view for id "+e);if(i!==o){const t=this._viewsMap.getAt(i),e=this._viewsMap.getAt(o);this._viewsMap.moveBefore(t.id,e.id),t.$wrapper.insertBefore(e.$wrapper),n=!0}}return n&&this._viewsMap.forEach((t,e)=>{t.setSequence(e)}),this}scrollTo(t){return this._scrollTo(t,0)}getScroll(){return this.$container.scrollTop()}ensureVisibility(t){const e=this._toView(t),o=this._$container[0],i=o.getBoundingClientRect(),r=null==e?void 0:e.$wrapper[0].getBoundingClientRect();if(!r)return n.logger.error("Ensure visibility called for non existent view"),this;const s=i.top+o.clientHeight,a=r.bottom-s,l=r.top-i.top;if(l>=-10&&a<=10)return n.logger.debug("annotation view visible"),this;const c=this.getViewTop(e);if(l<0)n.logger.debug("view obscured at top");else{let t=a,i=0,r=0,s=this.getScroll();const l=this.prevView(e);if((null==l?void 0:l.isVisible)||(r=o.scrollHeight-o.clientHeight-s,r>0&&(i=Math.min(r,t),this.scrollTo(Math.max(s+r)),t-=i)),t>10){if(r=c-((l?this.getViewTop(l):0)+((null==l?void 0:l.$wrapper.height())||0))-10,r>0){i=Math.min(r,t);const n=parseInt(e.$wrapper.css("top"))||0;e.$wrapper.css("top",n-i+"px"),t-=i}t>10&&(s=this.getScroll(),r=o.scrollHeight-o.clientHeight-s,r>0&&this.scrollTo(Math.max(0,s+Math.min(t,r-t))))}n.logger.debug("view obscured at bottom")}return this}setViewTop(t,e){const o=this._toView(t);if(!o)return n.logger.warn("setViewTop: no view"),this;e>=0||(n.logger.error("setViewTop received invalid top "+e),e=0),e=Math.round(e);const i=o.$wrapper;i.css("top","");const r=Math.round(e-i[0].offsetTop-this._topOffset);return i.css("top",Math.max(r,0)),this}getViewTop(t){const e=this._toView(t);if(!e)return n.logger.error("setViewTop: no view"),0;return e.$wrapper.position().top+this._topOffset}dispose(){var t;const e=this.annotationViews;this._viewsMap.clear(),e.forEach(t=>t.dispose()),this.$container.find(i.ACTIVE_ELEMENTS).off(),null===(t=this._sizeAdjuster)||void 0===t||t.dispose()}setOverflowPolicy(t){return this._$annotationsContainer.attr(o.OVERFLOW_POLICY,t),this}get topOffset(){return this._topOffset}get annotationViews(){return this._viewsMap.items}get selectors(){return i}get attributes(){return o}get templates(){return this._templates}getAnnotationView(t){return t&&this._viewsMap.get(t)||null}addAnnotationView(t,e){if(!(null==t?void 0:t.id))throw new Error("null or invalid annotation for view");if(this.getAnnotationView(t.id))throw new Error(`View for ${t.id} already exists`);const n=this._templates.thread.clone(),o=new a({annotation:t,$ui:n,$commentTemplate:this._templates.comment.clone(!1)});let i,r=null;if(e){if(r=this._toView(e),!r)throw new Error("before id specified but no matching view");i=this._viewsMap.getItemIndex(r.id)}else i=this._viewsMap.length;return this._addAnnotationNode(o.$wrapper,null==r?void 0:r.$wrapper),this._viewsMap.addItem({item:o,index:i}),o}removeAnnotationView(t){const e=this.getAnnotationView(t);if(e)try{this._viewsMap.removeItem(e),e.dispose()}catch(t){n.logger.error("While removing annotationview "+t)}return this}removeAll(){return this.annotationViews.forEach(t=>this.removeAnnotationView(t.id)),this}forAllviews(t){return this._viewsMap.forEach(t),this}findContainingAnnotationView(e){if(!e)return null;const n=t.utils.dom.toJQuery(e);if(!n.length)return null;const r=n.closest(i.ANNOTATION_NODE_SELECTOR);return r.length?this.getAnnotationView(r.attr(o.ANNOTATION_ID)):null}findContainingCommentView(e){const n=t.utils.dom.toJQuery(e);if(!(null==n?void 0:n.length))return null;const r=n.closest(i.COMMENT_NODE_SELECTOR);if(!r.length)return null;const s=r.attr(o.ANNOTATION_ID),a=this.getAnnotationView(s);return a?a.getCommentUI(r.attr(o.COMMENT_ID)):null}get $positioningContainer(){return this._$positioningContainer}get $ui(){return this._$ui}get $searchUI(){return this._$searchUI}get $container(){return this._$container}nextView(t){const e=null==t?void 0:t.$wrapper;if(!e)return null;const n=e.next(i.UI_WRAPPER_SELECTOR).attr(o.ANNOTATION_ID);return this.getAnnotationView(n)}prevView(t){const e=null==t?void 0:t.$wrapper;if(!e)return null;const n=e.prev(i.UI_WRAPPER_SELECTOR).attr(o.ANNOTATION_ID);return this.getAnnotationView(n)}lastView(){const t=this._$annotationsContainer.find(i.UI_WRAPPER_SELECTOR);return t.length?this._$uiToView(t.eq(-1)):null}selectAnnotation(t,e){const o=this._toView(t);return o?(o.isSelected!==e&&(o.setSelected(e),this._updateSelectedState(e)),o):(n.logger.warn("Select annotation: bad view "+t),null)}_updateSelectedState(t){return t||this.forAllviews(e=>{e.isSelected&&(t=!0)}),this._$container.toggleClass("has-selection",t),this}_scrollTo(t,e){if(!(e>=0&&e<3))return this;t=Math.round(Math.max(0,t||0)),this.$container.scrollTop(t);if(t-this._$container.scrollTop()>5){const n=this.lastView();if(!n)return this;const o=parseInt(n.$wrapper.css("marginBottom"))||0;return n.$wrapper.css("marginBottom",o+"px"),this._scrollTo(t,e+1)}return this}_addAnnotationNode(t,e){return e?t.insertBefore(e):this._$annotationsContainer.append(t),t}_$uiToView(t){const e=t.attr(o.ANNOTATION_ID);return this.getAnnotationView(e)}_lastView(){const t=this._$annotationsContainer.find(i.UI_WRAPPER_SELECTOR+":last-of-type");return t.length?this._$uiToView(t):null}_toView(t){return"string"==typeof t?this.getAnnotationView(t):t}_finalizeTemplate(o,i,r){const s=i.clone(),a=s.find(".comment-edit-links");r.toolbar.buttons.forEach(e=>{const n=t.$(o.createElement("button"));n.addClass("lance-ui-btn").attr({"data-lance-show":e.display||"show","data-lance-command":e.command}),a.append(n)});const l=t.utils.strings.toMap(r.toolbar.commands,"command","*");return s.find(".lance-ui-btn[data-lance-command]").each((i,r)=>{const s=e(r),a=s.attr("data-lance-command"),c=a&&l[a];if(!c)return n.logger.warn("no configuration for lance toolbar button",a);if(this._setupButton(o,s,c),c.label){t.utils.dom.forAllTextChildren(r,t=>e(t).remove());const n=o.createElement("label");n.innerText=c.label,s.append(n)}c.title&&s.attr({title:c.title,"data-title":c.title})}),s}_setupButton(e,n,o){let i;if(o.iconUrl){if(o.svgData||o.svgUrl)throw new Error("iconUrl requires empty svgData and svgUrl");i=t.$(e.createElement("span")).addClass("icon").css("background-image",`url(${o.iconUrl})`)}else if(o.svgData){if(o.svgUrl||o.iconUrl)throw new Error("iconUrl requires empty svgData and svgUrl");i=t.$(e.createElement("span")).addClass("icon").html(o.svgData)}else if(o.svgUrl)throw new Error("All svgUrl values should have been converted to svgData");return i&&n.append(i),n}_validateTemplates(t){var e,n;if(!(null===(e=t.thread)||void 0===e?void 0:e.length))throw new Error("UIGenerator: Bad or missing thread template");if(!(null===(n=t.comment)||void 0===n?void 0:n.length))throw new Error("UIGenerator: Bad or missing comment template")}}r.EVENT_CSS_LOADED="css-loaded";class s{constructor({comment:t,$ui:e,annotationId:n,parent:r}){this._isFiltered=!1,this._$ui=e,this.$commentText=e.find(".comment-text"),this._parentView=r,this._annotationId=n,this._comment=t,e.attr(o.COMMENT_ID,t.id).attr(o.ANNOTATION_ID,n).addClass(i.COMMENT_UI_CLASS),this.refresh()}dispose(){this._$ui&&(this._$ui.off().find(i.ACTIVE_ELEMENTS).off(),this._$ui.remove()),Object.assign(this,{_parentView:null})}setEditing(t){return this.$ui.attr("data-comment-edit",String(t)),this.$commentText.attr("readonly",t?null:"readonly"),this}get isEditing(){return"true"===this._$ui.attr("data-comment-edit")&&!n.lanceUtils.isReadonly(this.$commentText)}get isSelected(){return"true"===this._$ui.attr(o.SELECTED)}hasEditedComment(){return Boolean(this.$commentText.text().trim())}setSelected(t){return this.$ui.attr(o.SELECTED,String(t)),this}get parent(){return this._parentView}refresh(){return this.setSelected(this._comment.isSelected()),this}get annotationId(){return this._annotationId}get id(){return this._comment.id}get $ui(){return this._$ui}setFiltered(t){return this._$ui.attr(o.FILTERED,String(this._isFiltered=t)),this}get isFiltered(){return this._isFiltered}}class a{constructor({annotation:e,$ui:n,$commentTemplate:r}){this._isVisible=!0,this._$wrapper=n.closest(i.UI_WRAPPER_SELECTOR),this._comments=t.utils.createTypedArrayMap(t=>null==t?void 0:t.id),this._$ui=this.$wrapper.find(i.ANNOTATION_UI_SELECTOR),this._annotation=e,this.$reply=this._$ui.find(".comment-reply-text"),this._$tip=this._$ui.find(".annotation-tip"),this._$commentTemplate=r,this._$ui.attr(o.ANNOTATION_ID,e.id),this._$wrapper.attr(o.ANNOTATION_ID,e.id),this._$filter=this._$ui.find(i.FILTERED_SELECTOR),this.refresh()}dispose(){try{this.clear(),this.setSpacer(!1),this._$wrapper.off().find(i.ACTIVE_ELEMENTS).off(),this._$wrapper.remove()}catch(t){n.logger.error("While disposing annotation ui "+t)}}get isSelected(){return"true"===this._$wrapper.attr(o.SELECTED)}get isVisible(){return this._isVisible}setSequence(t){return this._$ui.attr(n.lancePluginUtils.pluginAttributes.annotationSequence,t),this._$wrapper.attr(n.lancePluginUtils.pluginAttributes.annotationSequence,t),this}setSelected(t){return String(t)!==this._$ui.attr(o.SELECTED)&&(this._$ui.attr(o.SELECTED,String(t)),this._$wrapper.attr(o.SELECTED,String(t)),t||this._comments.forEach(t=>{t.setSelected(!1)})),this}setCommentFiltered(t,e){return this.getCommentUI(t).setFiltered(e),this._updateFilteredState(),this}clear(){const t=this.commentViews;this._comments.clear();try{t.forEach(t=>t.dispose())}catch(t){n.logger.error("While clearning annotation view "+t)}return this}get id(){return this._annotation.id}get $ui(){return this._$ui}get annotation(){return this._annotation}get commentViews(){return this._comments.items}get $wrapper(){return this._$wrapper}get isReplying(){return"true"===this.$ui.attr("data-comment-insert")&&"string"!=typeof this.$reply.attr("readonly")}getEditedComment(){return this._comments.first(t=>t.isEditing)}setReplying(t){return this.$ui.attr("data-comment-insert",String(t)),this.$reply.attr("readonly",t?null:"readonly"),t?setTimeout(()=>this.$reply.focus(),10):this.$reply.val("").trigger("propertychange"),this}setExpandedCallback(t){const n=this._$filter.find("details");return n.off(".anv"),t&&n.on("toggle.anv",n=>{const o=e(n.currentTarget).attr("open");t(null!=o)}),this}refresh(){return this.setSelected(this.annotation.isSelected()),this.setResolved(this.annotation.isResolved()),this.commentViews.forEach(t=>t.refresh()),this}get isExpanded(){return this._$ui.hasClass(i.EXPANDED_CLASS)}get isCollapsed(){return this._$ui.hasClass(i.COLLAPSED_CLASS)}setFilterLabel(t){return this._$filter.find(".annotation-filtered-caption").text(t||""),this}setExpanded(t){this._$ui.toggleClass(i.EXPANDED_CLASS,t);const e=this._$filter.find("details");return"string"==typeof e.attr("open")!==t&&e.attr("open",t?"open":null),this}setCollapsed(t){return this._$ui.toggleClass(i.COLLAPSED_CLASS,t),t||0!==this.filteredCount||this.setExpanded(!1),this}setVisible(t){return this._$ui.attr(o.VISIBLE,String(this._isVisible=Boolean(t))),t||0!==this.filteredCount||this.setExpanded(!1),this}setResolved(t){return this._$ui.attr("data-annotation-resolved",this.annotation.isResolved()?"true":null),this}addComment(t){if(!t||this.getCommentUI(t.id))throw new Error("Comment null or already in view");const e=this._$commentTemplate.clone(!1).removeClass("lance-tmpl"),n=new s({comment:t,$ui:e,annotationId:this.id,parent:this});return this._comments.pushItem(n),this._$ui.find(".annotation-comments").append(n.$ui),n}getCommentUI(t){return this._comments.get(t)}setSpacer(t){const n=this._$wrapper,o=n.next("div."+i.UI_SPACER_CLASS);if(t!==Boolean(o.length))if(t){const t=n[0].ownerDocument.createElement("div");e(t).css({height:n.height()+"px",backgroundColor:"transparent"}).addClass(i.UI_SPACER_CLASS),n.after(t)}else o.remove();return this}get filteredCount(){return this._comments.count(t=>!t.isFiltered)}alignTip(t){const e=this._$tip;if(!e.length)return;const n=this._$ui.height(),o=e.height()||parseInt(e.css("height")),i=this._comments.length?50:15,r=Math.max(n-o-3,0),s=Math.min(r,i),a=Math.max(s,Math.min(r,t));e.css("top",a+"px")}_updateFilteredState(){const t=this.filteredCount;this._$filter.attr(o.FILTERED_COUNT,String(t)),t||this.isCollapsed||this.setExpanded(!1)}}class l{constructor(t,e){this.target=e,this._firstObserve=!0,this._observer=new ResizeObserver(t=>{if(this._firstObserve)this._firstObserve=!1;else{const e=t[t.length-1];this._adjust(e.contentRect),n.logger.debug("Size of container changed")}}),this._adjust(t.getBoundingClientRect()),this._observer.observe(t)}dispose(){var t;null===(t=this._observer)||void 0===t||t.disconnect(),delete this._observer}_adjust(t){this.target.style.maxHeight=t.height-this.target.offsetTop-1+"px"}}const c={createUIGenerator:()=>new r};Object.assign(n,c)}(window.LOOPINDEX),Object.defineProperty(e,"__esModule",{value:!0}),function(t){const e=null==t?void 0:t.LANCE,n=null==t?void 0:t.$;if(!e||!n)throw new Error("Cannot initialize tinymce plugin without Lance globals");const o=t.browser,i=10*parseInt(tinymce.majorVersion)+.1*parseInt(tinymce.minorVersion);function r(t,e){return t.options&&(t.options.get,1)?t.options.get(e):t.settings?t.settings[e]:t.getParam?t.getParam(e):void 0}function s(t,n,o){if(t.options&&(t.options.set,1))t.options.set(n,o);else{if(t.settings)return t.settings[n]=o;e.logger.warn("no way to change editor setting "+n)}}tinymce.PluginManager.add("lance",(function(t,e){!function(t){if(i<60)return;t.options.register("lance",{processor:()=>!0,default:{}})}(t);const n=new a(t,e);return n.initPlugin(t,r(t,"lance")),n}));class a{constructor(t,e){this._editor=t,this.path=e,this.nodeSynchronizer=null,this._removeBindings=[],this._mayBeginDrag=!1,this._isInited=!1,this._isEditorLoaded=!1,this.version="1.8.02",this._propertyMap={},this._buttons={},this._useXML=Boolean("xhtml"===r(t,"element_format"))}initPlugin(o,a){this._editor=o,a=a||{},i>=60&&(a.tagName&&"annotation"!==a.tagName||(a.tagName="lance-annotation",e.logger.warn("Changing comment tag name from annotation (reserved in tinymce 6) to "+a.tagName))),e.lancePluginUtils.initLancePlugin({plugin:this,config:a,locale:tinymce.util.I18n.getCode()}),this._setPluginFeatures(o,this.customAttributes),this._onDragCancel=this._onDragCancel.bind(this);const l=!1===a.useTextSelection?new c(this):new d(this);let u;this._editorNodeHandler=new e.NodesHandler(l);const h=this._editorNodeHandler.getTagName(),f=new RegExp(h+"$","i");this._editorNodeHandler.usesCommentMarkers?(u=(r(o,"extended_valid_elements")||"").split(",").map(t=>t&&t.trim()).filter(t=>t&&!f.test(t)),u.push(h),s(o,"extended_valid_elements",u.join(","))):(u=(r(o,"custom_elements")||"").split(",").map(t=>t&&t.trim()).filter(t=>t&&!f.test(t)),u.push("~"+h),s(o,"custom_elements",u.join(",")));const m=/^he.d/i;n(window.document).find("html>*").filter((t,e)=>m.test(e.nodeName||""))[0];o.once("init",n=>{var r;if(e.lancePluginUtils.addLanceButtonsStyle(null===(r=o.getContainer())||void 0===r?void 0:r.ownerDocument),i>=50){const e=this._editor.getContainer();if(e&&e.ownerDocument){new t.utils.CSSLoader(e.ownerDocument).loadCSS([this.resolvePath("css/editor.css")])}}const s=tinymce.util.I18n.getCode();this.setLanguage(s).then(t=>{this._isEditorLoaded=!0,this._maybeFireInit()})}),this._bindToOwner(this._manager,!0)}bindAnnotationEvents(t){this._bindToOwner(this._manager,t)}fireEditorEvent(t,e){var n;null===(n=this._editor)||void 0===n||n.fire(t,e)}init(t,n){e.lancePluginUtils.validateApiKey()&&(this._initUI(t),this._addEventBinding("BeforeSetContent",this._onBeforeDomLoaded)._addEventBinding("SetContent",this._onDomLoaded)._addEventBinding("mouseup",this._onDocumentClick)._addEventBinding("GetContent",this._onGetContent)._addEventBinding("SwitchMode",this._onSwitchMode)),t.on("remove",()=>{this.removeEventBindings(!0),this.dispose(),this._editorNodeHandler=null}),this._isInited=!0,this._maybeFireInit()}_uninit(){this.dispose(),this._bindToOwner(this._manager,!1)}logEditorCommands(t){this._config.logCommands=!0}logEditorEvents(e){t.utils.pluginUtils.logEditorEvents({plugin:this,editor:this._editor,exclude:["keydown","focus","blur","scroll","mouse","GetSelectionRange","NodeChange","VisualAid","execcommand","beforeexeccommand","dirty","mousemove"],method:i>=60?"dispatch":"fire",log:e})}get $(){return t.$}get nodesHandler(){return this._editorNodeHandler}get customAttributes(){return this._config.customAttributes.slice()}get tagName(){return this._config.tagName}get editor(){return this._editor}getDocument(){return this._editor&&this._editor.getDoc()}get nodeVisibilityObserver(){return this._visibilityObserver}isInline(){return Boolean(this._editor&&this._editor.inline)}setUserId(t){return this._manager?this._manager.setUserId(t):null}getUserId(){return this._manager&&this._manager.getUserId()||null}getBody(){return this._editor&&this._editor.getBody()}getInsertPosition(){return e.lancePluginUtils.getAnnotationNodePosition(this._getAnnotationNodes(),this._getSelectedNode())}getAnnotationNodeForId(t){return this.nodesHandler.findAnnotationNodesForId(t)[0]||null}getAllAnnotationNodesForId(t){return this.nodesHandler.findAnnotationNodesForId(t).toArray()}isDummyElement(t){return t&&t.className&&t.className.indexOf("mce-offscreen-selection")>=0}transactUndo(t){this._editor.undoManager.transact(t)}getProperty(t,e){return this._propertyMap.hasOwnProperty(t)?this._propertyMap[t]:e}setProperty(t,e){void 0===e?delete this._propertyMap[t]:this._propertyMap[t]=e}onSelectionChanged(){if(this.isSelecting)return;const e=this._updateCommandState();this._maybeSelectAnnotationNode(e.state===t.CommandStates.DISABLED?e.annotationNodes[0]:null)}onLocaleChanged(){}get isActive(){return Boolean(this._editor&&!this._editor.readonly)}_getUIButtonRecord(t){var e;return null!==(e=this._buttons[t])&&void 0!==e?e:this._buttons[t]={active:void 0,button:void 0,command:t,enabled:void 0}}_initUI(n){i>=60?(this._disableButton=(t,e)=>{t.setEnabled(!e)},this._activateButton=(t,e)=>{t&&t.setActive&&t.setActive(e)}):i>=50?(this._disableButton=(t,e)=>{t.setDisabled(e)},this._activateButton=(t,e)=>{t&&t.setActive&&t.setActive(e)}):(this._disableButton=(t,e)=>{t.disabled(e)},this._activateButton=(t,e)=>{t&&t.active&&t.active(e)});const o=i>=50?(e,o)=>{const i=n;if(i.addCommand(e.cmd,e.callback,this),!o)return;const r=e.iconName;i.ui.registry.addIcon(r,this._config.svgIcon||e.svg);const s={tooltip:this.getLocalizedString(e.tooltip),disabled:!1,icon:r,onAction:()=>{this._editor.execCommand(e.cmd,null)},onSetup:n=>{const o=this._getUIButtonRecord(e.cmd);o.button=n.control||n,this._setCommandsState(e.cmd,o.active?t.CommandStates.ON:o.enabled?t.CommandStates.OFF:t.CommandStates.DISABLED)}};i.ui.registry.addToggleButton(e.name||e.cmd,s)}:(e,o)=>{if(n.addCommand(e.cmd,e.callback,this),!o)return;const i=e.cmd.replace(/[^a-z]/gi,""),r={tooltip:this.getLocalizedString(e.tooltip),image:t.utils.joinPath(this.path,e.iconPath||`icons/${i}.png`),cmd:e.cmd,onPostRender:n=>{const o=this._getUIButtonRecord(e.cmd);o.button=n.control,this._setCommandsState(e.cmd,o.active?t.CommandStates.ON:o.enabled?t.CommandStates.OFF:t.CommandStates.DISABLED)}};n.addButton(e.name||e.cmd,r)};[{name:"lance",iconName:"lance",callback:this._onAnnotate,cmd:"annotate",tooltip:"insert comment",iconPath:"icons/add-comment_tiny.png",svg:'<?xml version="1.0" encoding="UTF-8"?>\n\t<svg class="lance-button" width="20px" height="18px" viewBox="0 0 20 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t<g id="add-comment_1-svg" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n\t\t\t<path class="loopindex-svg-icon" d="M20,0 L20,14 L10,14 L6,18 L2,14 L0,14 L0,0 L20,0 Z M18.6,1.4 L1.4,1.4 L1.4,12.6 L2.57989899,12.6 L6,16.021 L9.42010101,12.6 L18.6,12.6 L18.6,1.4 Z" id="Rectangle-4" fill="#C2C2C2" fill-rule="nonzero"></path>\n\t\t\t<path class="loopindex-svg-icon" d="M11,3 L11,6 L14,6 L14,8 L11,8 L11,11 L9,11 L9,8 L6,8 L6,6 L9,6 L9,3 L11,3 Z" id="Rectangle-2" fill="#13C203"></path>\n\t\t</g>\n\t</svg>'}].forEach(t=>o(t,!0));const a=r(n,"toolbar"),l=typeof a;a&&"boolean"!==l&&(/\blance\b/.test(String(a))||("string"===l?s(n,"toolbar",a+" lance"):"function"==typeof a.push?a.push("lance"):e.logger.error("Lance not found in the toolbar, no idea how to add it")))}_maybeFireInit(){this._isInited&&this._isEditorLoaded&&(this._isEditorLoaded=!1,this._editor.fire("lance::init",{lance:this},!1))}_onBeforeDomLoaded(t){var n;if(!t||t.selection||t.paste)return;const o=t.target,i=this._editor.getDoc();try{this._loadCSS(i)}catch(t){e.logger.error(t)}if(this._setPluginFeatures(o,this.customAttributes),null===(n=this.nodeSynchronizer)||void 0===n||n.stop(),t.content&&"string"==typeof t.content){const e=this.nodesHandler.processDOM(t.content);e&&(t.content=e)}}_onDomLoaded(t){var o;if(t&&(t.selection||t.paste))return;const i=this._editor.getBody();n(i).off(".lance").on("drop.lance",this._onDrop.bind(this)).on("keyup.lance",t=>{this.onKeyUp(t)}).on("mouseup.lance",t=>{this.onSelectionChanged()}),null===(o=this.nodeSynchronizer)||void 0===o||o.stop(),this.nodeSynchronizer=e.lancePluginUtils.attachMutationObserver(this,this._editorNodeHandler.getSelector()),this._visibilityObserver=e.lancePluginUtils.attachNodeVisibilityObserver(this),e.lancePluginUtils.validateKey(),e.lancePluginUtils.loadAnnotationsFromDOM(this,!0),this.nodeSynchronizer.start()}_updateCommandState(){var e;const n=(null===(e=this._manager)||void 0===e?void 0:e.isEnabled())?this._editorNodeHandler.getCommandState():{state:t.CommandStates.DISABLED,annotationNodes:[]};return this._setCommandsState("annotate",n.state),n}_setCommandsState(e,n){e=t.utils.strings.toStringArray(e);const o=n!==t.CommandStates.DISABLED,i=n===t.CommandStates.ON,r="boolean"==typeof i;let s;for(let t=e.length-1;t>=0;--t){const n=this._getUIButtonRecord(e[t]);n.enabled=o,n.active=i,s=n.button,s&&(this._disableButton(s,!o),r&&this._activateButton(s,i))}}_bindToOwner(t,n){t&&(t.off(this),n&&(t.on(e.Annotations.Events.ANNOTATION_CREATED,this._onAnnotationCreated.bind(this),this),t.on(e.Annotations.Events.ANNOTATION_DELETED,this._onAnnotationDeleted.bind(this),this),t.on(e.Annotations.Events.ANNOTATION_SELECTED,this._onAnnotationSelected.bind(this),this),t.on(e.Annotations.Events.ANNOTATION_UPDATED,this._onAnnotationChanged.bind(this),this),t.on(e.Annotations.Events.ATTRIBUTE_CHANGED,this._onAnnotationAttributeChanged.bind(this),this),t.on(e.Annotations.Events.COMMENT_DELETED,this._onCommentDeleted.bind(this),this),t.on(e.Annotations.Events.COMMENT_CHANGED,this._onCommentChanged.bind(this),this),t.on(e.Annotations.Events.COMMENT_ADDED,this._onCommentAdded.bind(this),this),t.on(e.Annotations.Events.ENABLED_CHANGED,this._onAnnotationsEnabledChanged.bind(this),this),t.on(e.Annotations.Events.DONE_EDITING,this._onCommentEditingDone,this),t.on(e.Annotations.Events.ANNOTATIONS_RENUMBERED,this._onAnnotationsRenumbered,this),t.on(e.Annotations.Events.ANNOTATION_RESOLVED,this.onAnnotationResolved,this)))}_onAnnotationCreated(t){const o=t.annotation;if(!o||!this._editor)return void e.logger.error("Annotation created with no editor or annotation");if(this.getAnnotationNodeForId(o.id))return;const i=this.isSelecting;this.isSelecting=!0;try{if(this._editorNodeHandler.usesCommentMarkers){const t=this.nodeSynchronizer.stop();try{const i=this._editor.selection,r=this.nodesHandler.createAnnotationNode();e.lancePluginUtils.populateAnnotationNode({plugin:this,node:r,annotation:o,saveFullContent:!0,titleTemplate:this._config.tooltipFormat}),i&&!i.isCollapsed()&&i.collapse(!1),this._editor.focus(!1),this._editor.insertContent(r.outerHTML);const s=this.nodesHandler.findFirstNodeForAnnotation(o.id);s&&n(s).find("object").remove()}catch(t){throw e.logger.error("Lance: Failed to create annotation node",t),t}finally{t()}}else{const n=this._editorNodeHandler.insertAnnotationNodes();if(!n||!n.length)return e.logger.error("Lance: Failed to create annotation nodes");n.forEach((t,n)=>{e.lancePluginUtils.populateAnnotationNode({plugin:this,node:t,annotation:o,saveFullContent:0===n,titleTemplate:this._config.tooltipFormat})}),e.lancePluginUtils.isInteractiveAnnotation(t.context)&&this._monitorCommentEditing(o.id)}}catch(t){e.logger.error("onAnnotationCreated:",t)}finally{setTimeout(()=>this.isSelecting=i,25)}}_monitorCommentEditing(t){const n=o=>{if(e.logger.debug("comment editing done handler"),o.annotationId===t){this.editor.focus(!1),this._manager.off(e.Annotations.Events.DONE_EDITING,n);const i=!o.canceled&&this.getAllAnnotationNodesForId(t);i&&i.length&&setTimeout(()=>{e.logger.debug("setting caret after comment editing"),this.nodesHandler.collapseAfterNode(i[i.length-1])},10)}};this._manager.on(e.Annotations.Events.DONE_EDITING,n,this)}_onAnnotationDeleted(t){const e=t&&t.id,n=this._editor.selection.getBookmark();this.nodesHandler.uncommentAnnotation(e),n&&this._editor.selection.moveToBookmark(n)}_onAnnotationChanged(t){const n=t&&t.annotation;if(n){this.nodesHandler.findAnnotationNodesForId(n.id).each((t,o)=>e.lancePluginUtils.populateAnnotationNode({plugin:this,node:o,annotation:n,saveFullContent:0===t,titleTemplate:this._config.tooltipFormat}))}}_onAnnotationAttributeChanged(t){return this._onAnnotationChanged(t)}_onAnnotationSelected(t){var n;const o=null==t?void 0:t.annotation;if(o){const i=this.nodesHandler.findAnnotationNodesForId(o.id);if(null==i?void 0:i.length){const r=this._config.autoScroll&&!(null===(n=t.hostData)||void 0===n?void 0:n.node);e.lancePluginUtils.selectAnnotationNodes({$nodes:i,annotation:o,reveal:r,plugin:this})}}}_onCommentDeleted(t){this._onAnnotationChanged(t)}_onCommentChanged(t){this._onAnnotationChanged(t)}_onCommentAdded(t){this._onAnnotationChanged(t)}_onCommentEditingDone(t){(t.canceled||"reply"===t.mode)&&(this.isSelecting=!0,setTimeout(()=>this.isSelecting=!1,5),this._editor.focus(!1))}_onAnnotationsEnabledChanged(){}_onAnnotate(t){this._editorNodeHandler.canAnnotate().can&&e.lancePluginUtils.annotate(this)}_onSwitchMode(t){this.setEnabled("design"===t.mode)}_onDocumentClick(e){var n;if(!(null===(n=this._manager)||void 0===n?void 0:n.isEnabled()))return;const o=e.target,i=this.getBody();t.utils.dom.isDescendantOf(o,i)||this.onSelectionChanged()}_onGetContent(n){const o=null==n?void 0:n.content;if("string"==typeof o)try{n.content=t.utils.dom.elementToHtml({el:e.lancePluginUtils.removeLanceArtifacts(this,o),xml:this._useXML,withRoot:!1})}catch(t){e.logger.error("processing get content: "+t)}}_onDragCancel(t){const n=t.data;let i,r=!1;if(o.msie)r=this._mayBeginDrag;else{if(!n)return;if(i=n.dataTransfer?n.dataTransfer.$:n.$&&n.$.dataTransfer,!i||!i.getData)return;const t=i.getData(o.msie?"text":"text/html");r=t&&t.indexOf(e.lancePluginUtils.pluginAttributes.annotationId)>0&&t.indexOf(e.lancePluginUtils.pluginAttributes.annotationData)>0}if(r)return t.cancel(),n.preventDefault&&n.preventDefault(),!1}_onDrop(e){if(!e||!this._editorNodeHandler.usesCommentMarkers)return;const o=(e=e.originalEvent||e)&&e.dataTransfer,i=o&&o.items;if(i&&i.length)for(let o=i.length-1;o>=0;--o){const r=i[o];if(!r||"text/html"!==r.type)continue;const s=e.target.ownerDocument;r.getAsString(e=>{const o=n(e),i=o&&o[0];if(i.id&&n(i).is(this.nodesHandler.getSelector())){const e=i.id;setTimeout((function(){const n=s.getElementById(e);t.utils.dom.clearNodeBackgroundImage(n)}),10)}});break}}_getSelectedNode(){const t=this._editor.selection.getRng(!0)||this._editor.selection.getRng(!1);if(!t||!t.endContainer)return null;const e=t.endContainer;if(3===e.nodeType||0===t.endOffset)return e;return e.childNodes&&e.childNodes[t.endOffset-1]||e}_getAnnotationNodes(){return this._editorNodeHandler.findAnnotationNodes()}_setPluginFeatures(t,n){if(i>=60){const o=t;if(!o.schema)return;const i=Object.keys(e.lancePluginUtils.pluginAttributes).map(t=>e.lancePluginUtils.pluginAttributes[t]).concat(n||[]).filter(Boolean).join("|"),r=`${this.tagName}[class|id|title|${i}]`;o.schema.addValidElements(r)}}_addEventBinding(t,e,n=!0,o){const i=n?e.bind(this):e;return this._removeBindings.push({event:t,context:this._editor.on(t,i,o),callback:i}),this}removeEventBindings(t){var o;const i=this.getBody();i&&n(i).off(".lance"),null===(o=this.nodeSynchronizer)||void 0===o||o.stop();const r=this._removeBindings.filter(Boolean);let s;this._removeBindings.length=0;for(let t=r.length-1;t>=0;--t){s=r[t];try{s.context.off(s.event,s.callback)}catch(t){e.logger.error("release event bindings",t)}}}}class l{constructor(t){this._plugin=t,this.selector=t.tagName}get plugin(){return this._plugin}get document(){const t=this.documentBody;return t&&t.ownerDocument}get documentBody(){return this._plugin.getBody()}getSelectedRange(){const t=this._plugin.editor.selection;return t&&t.getRng(!0)}getNativeSelection(){const t=this._plugin.editor.selection,e=t&&t.getSel();if(e)return e;const n=document,o=n&&n.defaultView;return o&&o.getSelection&&o.getSelection()||n&&n.selection}}class c extends l{constructor(t){super(t)}createOverrides(){return{uncomment:t=>{n(t).remove()},canAnnotate:t=>{if(!(null==t?void 0:t.collapsed))return{can:!1,annotationNodes:[]};const e=this._plugin.nodesHandler.findAnnotationNodeAtCaret(t);return{can:!e,annotationNodes:e?[e]:[]}},createAnnotationNode:()=>{const t=this._plugin.editor.getDoc(),e=t.createElement("annotation");return e.appendChild(t.createElement("object")),e},getCommandState:e=>{const n=this._plugin.nodesHandler.canAnnotate(e);return{state:n.can?t.CommandStates.OFF:t.CommandStates.DISABLED,annotationNodes:n.annotationNodes}},processDOM:t=>t,findAnnotationNode:t=>{if(!t){const e=this._plugin.editor.selection;t=(null==e?void 0:e.isCollapsed())&&e.getNode()}return e.lancePluginUtils.getNodeAnnotationId(t)?t:null},findAnnotationNodes:t=>{const n=this.document;if(!n)return[];const o=[],i=n.getElementsByTagName(this.selector);let r,s;for(let t=0,n=i.length;t<n;++t)r=i[t],s=e.lancePluginUtils.getNodeAnnotationId(r),s&&!this._plugin.isDummyElement(r.parentNode)&&o.push(r);return!1!==t?o:e.lancePluginUtils.toUniqueAnnotationNodes(o)}}}get usesFakeElement(){return!0}canAnnotate(){return!0}}class d extends l{constructor(t){super(t)}createOverrides(){return{}}get usesFakeElement(){return!1}}}(window.LOOPINDEX)}()}]);